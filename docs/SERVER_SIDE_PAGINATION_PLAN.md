# ã‚µãƒ¼ãƒãƒ¼å´ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…è¨ˆç”»

## ğŸ“Œ æ¦‚è¦

å…¨ãƒšãƒ¼ã‚¸ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ã‚µãƒ¼ãƒãƒ¼å´ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã«å¤‰æ›´ã™ã‚‹ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã§ã‚‚å®‰å®šã—ãŸãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å®Ÿç¾ã™ã‚‹ã€‚

---

## ğŸ¯ ç›®çš„

- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: å°è¦æ¨¡ä¼æ¥­ã‹ã‚‰å¤§è¦æ¨¡ä¼æ¥­ã¾ã§å¯¾å¿œ
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ãƒ‡ãƒ¼ã‚¿é‡ã«é–¢ã‚ã‚‰ãšä¸€å®šã®é€Ÿåº¦ã‚’ç¶­æŒ
- **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡**: ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’å‰Šæ¸›
- **SaaSå¯¾å¿œ**: æ§˜ã€…ãªä¼æ¥­è¦æ¨¡ã«å¯¾å¿œã§ãã‚‹ä»•çµ„ã¿

---

## ğŸ“‹ å¤‰æ›´å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ï¼ˆå…¨24ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

### ãƒ•ã‚§ãƒ¼ã‚º1: è¦‹ç©æ›¸ä¸€è¦§ï¼ˆã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…ï¼‰

#### ã‚µãƒ¼ãƒãƒ¼å´
1. `/app/api/estimates/route.ts` - ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³APIè¿½åŠ 

#### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´
2. `/components/estimates/EstimateListClient.tsx` - å¤§å¹…å¤‰æ›´
3. `/app/(authenticated)/estimates/page.tsx` - å¤‰æ›´

---

### ãƒ•ã‚§ãƒ¼ã‚º2: ä»–ã®7ãƒšãƒ¼ã‚¸ï¼ˆåŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨ï¼‰

#### ã‚µãƒ¼ãƒãƒ¼å´APIå¤‰æ›´ï¼ˆ7ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
4. `/app/api/invoices/route.ts`
5. `/app/api/purchase-orders/route.ts`
6. `/app/api/payments/route.ts`
7. `/app/api/clients/route.ts` (æ–°è¦ä½œæˆã®å¯èƒ½æ€§)
8. `/app/api/projects/route.ts` (æ–°è¦ä½œæˆã®å¯èƒ½æ€§)
9. `/app/api/suppliers/route.ts`
10. `/app/api/staff/route.ts` (æ—¢å­˜ã‚’ç¢ºèª)

#### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´å¤‰æ›´ï¼ˆ7ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
11. `/components/invoices/InvoiceListClient.tsx`
12. `/app/(authenticated)/purchase-orders/PurchaseOrderListClient.tsx`
13. `/components/payments/PaymentListClient.tsx`
14. `/app/(authenticated)/clients/ClientTabs.tsx`
15. `/components/projects/ProjectListClient.tsx`
16. `/app/(authenticated)/suppliers/SupplierListClient.tsx`
17. `/app/(authenticated)/staff/StaffListClient.tsx`

#### ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå¤‰æ›´ï¼ˆ7ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
18. `/app/(authenticated)/invoices/page.tsx`
19. `/app/(authenticated)/purchase-orders/page.tsx`
20. `/app/(authenticated)/payments/page.tsx`
21. `/app/(authenticated)/clients/page.tsx`
22. `/app/(authenticated)/projects/page.tsx`
23. `/app/(authenticated)/suppliers/page.tsx`
24. `/app/(authenticated)/staff/page.tsx`

---

## ğŸ”§ æŠ€è¡“ä»•æ§˜

### 1. APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä»•æ§˜ï¼ˆå…±é€šï¼‰

#### ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹
```
GET /api/estimates?page=1&limit=20&search=ç”°ä¸­&status=draft&sortField=estimate_date&sortOrder=desc
```

#### ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
```typescript
interface PaginationParams {
  page: number          // ãƒšãƒ¼ã‚¸ç•ªå·ï¼ˆ1å§‹ã¾ã‚Šï¼‰
  limit: number         // 1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ä»¶æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ20ï¼‰
  search?: string       // æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
  // å„ãƒšãƒ¼ã‚¸å›ºæœ‰ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
  status?: string
  creator?: string
  sortField?: string
  sortOrder?: 'asc' | 'desc'
}
```

#### ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼
```typescript
interface PaginationResponse<T> {
  data: T[]            // è©²å½“ãƒšãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿
  total: number        // å…¨ãƒ‡ãƒ¼ã‚¿ä»¶æ•°
  page: number         // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸
  limit: number        // 1ãƒšãƒ¼ã‚¸ã®ä»¶æ•°
  totalPages: number   // å…¨ãƒšãƒ¼ã‚¸æ•°
}
```

#### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹
```json
{
  "data": [...],
  "total": 600,
  "page": 1,
  "limit": 20,
  "totalPages": 30
}
```

---

### 2. ã‚µãƒ¼ãƒãƒ¼å´å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

#### `/app/api/estimates/route.ts` ã®å®Ÿè£…ä¾‹

```typescript
import { NextRequest, NextResponse } from 'next/server'
import { createClient } from '@/lib/supabase/server'
import { requireAuth } from '@/lib/auth/page-auth'

export async function GET(request: NextRequest) {
  const { searchParams } = new URL(request.url)

  // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å–å¾—
  const page = parseInt(searchParams.get('page') || '1')
  const limit = parseInt(searchParams.get('limit') || '20')
  const search = searchParams.get('search') || ''
  const status = searchParams.get('status') || 'all'
  const creator = searchParams.get('creator') || ''
  const sortField = searchParams.get('sortField') || 'estimate_date'
  const sortOrder = searchParams.get('sortOrder') || 'desc'

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼
  const { userId, organizationId, supabase } = await requireAuth()

  // 1. ä»¶æ•°å–å¾—ç”¨ã‚¯ã‚¨ãƒª
  let countQuery = supabase
    .from('estimates')
    .select('*', { count: 'exact', head: true })
    .eq('organization_id', organizationId)
    .is('deleted_at', null)

  // 2. ãƒ‡ãƒ¼ã‚¿å–å¾—ç”¨ã‚¯ã‚¨ãƒª
  let dataQuery = supabase
    .from('estimates')
    .select(`
      *,
      client:clients(name),
      project:projects(project_name),
      created_by_user:users!estimates_created_by_fkey(id, name)
    `)
    .eq('organization_id', organizationId)
    .is('deleted_at', null)

  // 3. æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆä¸¡æ–¹ã®ã‚¯ã‚¨ãƒªã«é©ç”¨ï¼‰
  if (search) {
    const searchFilter = `estimate_number.ilike.%${search}%,client.name.ilike.%${search}%`
    countQuery = countQuery.or(searchFilter)
    dataQuery = dataQuery.or(searchFilter)
  }

  // 4. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
  if (status !== 'all') {
    countQuery = countQuery.eq('status', status)
    dataQuery = dataQuery.eq('status', status)
  }

  // 5. ä½œæˆè€…ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
  if (creator) {
    countQuery = countQuery.eq('created_by', creator)
    dataQuery = dataQuery.eq('created_by', creator)
  }

  // 6. ã‚½ãƒ¼ãƒˆ
  dataQuery = dataQuery.order(sortField, { ascending: sortOrder === 'asc' })

  // 7. ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
  const from = (page - 1) * limit
  const to = from + limit - 1
  dataQuery = dataQuery.range(from, to)

  // 8. ã‚¯ã‚¨ãƒªå®Ÿè¡Œï¼ˆä¸¦åˆ—ï¼‰
  const [{ count }, { data, error }] = await Promise.all([
    countQuery,
    dataQuery
  ])

  if (error) {
    console.error('[Estimates API] Error:', error)
    return NextResponse.json({ error: error.message }, { status: 500 })
  }

  return NextResponse.json({
    data: data || [],
    total: count || 0,
    page,
    limit,
    totalPages: Math.ceil((count || 0) / limit)
  })
}
```

---

### 3. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

#### `/components/estimates/EstimateListClient.tsx` ã®å¤‰æ›´å†…å®¹

##### å¤‰æ›´å‰ï¼ˆç¾åœ¨ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

```typescript
interface EstimateListClientProps {
  estimates: Estimate[]  // â† propsã§å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹
  userRole: string
  staffList: Staff[]
}

export function EstimateListClient({ estimates: initialEstimates, userRole, staffList }: EstimateListClientProps) {
  const [estimates, setEstimates] = useState(initialEstimates)
  const [currentPage, setCurrentPage] = useState(1)
  const itemsPerPage = 20

  // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
  const filteredAndSortedEstimates = useMemo(() => {
    return estimates.filter((estimate) => {
      // æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å‡¦ç†
      const matchesSearch = !searchQuery || estimate.estimate_number.includes(searchQuery)
      const matchesStatus = statusFilter === 'all' || estimate.status === statusFilter
      return matchesSearch && matchesStatus
    }).sort((a, b) => {
      // ã‚½ãƒ¼ãƒˆå‡¦ç†
      return sortOrder === 'asc' ? a.estimate_date > b.estimate_date : a.estimate_date < b.estimate_date
    })
  }, [estimates, searchQuery, statusFilter, sortField, sortOrder])

  // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
  const paginatedEstimates = useMemo(() => {
    const startIndex = (currentPage - 1) * itemsPerPage
    return filteredAndSortedEstimates.slice(startIndex, startIndex + itemsPerPage)
  }, [filteredAndSortedEstimates, currentPage])

  return (
    <>
      {paginatedEstimates.map((estimate) => (
        <div key={estimate.id}>...</div>
      ))}
    </>
  )
}
```

##### å¤‰æ›´å¾Œï¼ˆã‚µãƒ¼ãƒãƒ¼å´ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

```typescript
interface EstimateListClientProps {
  // propsã‹ã‚‰estimatesã‚’å‰Šé™¤
  userRole: string
  staffList: Staff[]
}

export function EstimateListClient({ userRole, staffList }: EstimateListClientProps) {
  // ãƒ‡ãƒ¼ã‚¿ã¯stateã§ç®¡ç†
  const [estimates, setEstimates] = useState<Estimate[]>([])
  const [loading, setLoading] = useState(true)
  const [total, setTotal] = useState(0)
  const [currentPage, setCurrentPage] = useState(1)
  const [totalPages, setTotalPages] = useState(1)

  // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»ã‚½ãƒ¼ãƒˆæ¡ä»¶
  const [searchQuery, setSearchQuery] = useState('')
  const [statusFilter, setStatusFilter] = useState('all')
  const [creatorFilter, setCreatorFilter] = useState('')
  const [sortField, setSortField] = useState<'estimate_date' | 'valid_until' | 'total_amount'>('estimate_date')
  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc')

  // APIå‘¼ã³å‡ºã—é–¢æ•°
  const fetchEstimates = async () => {
    try {
      setLoading(true)

      const params = new URLSearchParams({
        page: currentPage.toString(),
        limit: '20',
        search: searchQuery,
        status: statusFilter,
        creator: creatorFilter,
        sortField,
        sortOrder
      })

      const response = await fetch(`/api/estimates?${params}`)
      if (!response.ok) {
        throw new Error('Failed to fetch estimates')
      }

      const result = await response.json()

      setEstimates(result.data)
      setTotal(result.total)
      setTotalPages(result.totalPages)
    } catch (error) {
      console.error('Failed to fetch estimates:', error)
      alert('è¦‹ç©æ›¸ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ')
    } finally {
      setLoading(false)
    }
  }

  // åˆå›èª­ã¿è¾¼ã¿ + ãƒšãƒ¼ã‚¸ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å¤‰æ›´æ™‚
  useEffect(() => {
    fetchEstimates()
  }, [currentPage, searchQuery, statusFilter, creatorFilter, sortField, sortOrder])

  // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»ã‚½ãƒ¼ãƒˆæ¡ä»¶å¤‰æ›´æ™‚ã¯1ãƒšãƒ¼ã‚¸ç›®ã«æˆ»ã™
  useEffect(() => {
    if (currentPage !== 1) {
      setCurrentPage(1)
    }
  }, [searchQuery, statusFilter, creatorFilter, sortField, sortOrder])

  // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
  if (loading) {
    return (
      <div className="flex items-center justify-center py-12">
        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
        <span className="ml-3 text-gray-600">èª­ã¿è¾¼ã¿ä¸­...</span>
      </div>
    )
  }

  return (
    <>
      {/* æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ */}
      <input
        type="text"
        value={searchQuery}
        onChange={(e) => setSearchQuery(e.target.value)}
        placeholder="æ¤œç´¢..."
      />

      {/* ä»¶æ•°è¡¨ç¤º */}
      <div className="text-sm text-gray-700">
        å…¨ {total} ä»¶ä¸­ {estimates.length} ä»¶ã‚’è¡¨ç¤ºï¼ˆ{currentPage}/{totalPages} ãƒšãƒ¼ã‚¸ï¼‰
      </div>

      {/* ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º */}
      {estimates.map((estimate) => (
        <div key={estimate.id}>...</div>
      ))}

      {/* ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ */}
      {totalPages > 1 && (
        <div className="mt-6 flex items-center justify-between">
          <button
            onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}
            disabled={currentPage === 1 || loading}
            className="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed"
          >
            å‰ã¸
          </button>
          <span className="text-sm text-gray-700">
            {currentPage} / {totalPages} ãƒšãƒ¼ã‚¸
          </span>
          <button
            onClick={() => setCurrentPage(Math.min(totalPages, currentPage + 1))}
            disabled={currentPage === totalPages || loading}
            className="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed"
          >
            æ¬¡ã¸
          </button>
        </div>
      )}
    </>
  )
}
```

---

### 4. ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå¤‰æ›´

#### `/app/(authenticated)/estimates/page.tsx`

##### å¤‰æ›´å‰ï¼ˆServer Componentã§å…¨ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼‰

```typescript
export default async function EstimatesPage() {
  const { userId, organizationId, userRole, supabase } = await requireAuth()

  // å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æ¸¡ã™
  const { data: estimates } = await supabase
    .from('estimates')
    .select(`
      *,
      client:clients(name),
      project:projects(project_name)
    `)
    .eq('organization_id', organizationId)
    .is('deleted_at', null)
    .order('created_at', { ascending: false })

  const { data: staff } = await supabase
    .from('users')
    .select('id, name')
    .eq('organization_id', organizationId)

  return <EstimateListClient estimates={estimates || []} staffList={staff || []} />
}
```

##### å¤‰æ›´å¾Œï¼ˆè»½é‡ãªãƒ‡ãƒ¼ã‚¿ã®ã¿å–å¾—ï¼‰

```typescript
export default async function EstimatesPage() {
  const { userId, organizationId, userRole, supabase } = await requireAuth()

  // ã‚¹ã‚¿ãƒƒãƒ•ãƒªã‚¹ãƒˆã ã‘å–å¾—ï¼ˆè»½é‡ï¼‰
  const { data: staff } = await supabase
    .from('users')
    .select('id, name')
    .eq('organization_id', organizationId)
    .eq('is_active', true)

  // è¦‹ç©ãƒ‡ãƒ¼ã‚¿ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§APIã‹ã‚‰å–å¾—
  return (
    <div className="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
      <EstimateListClient
        userRole={userRole || 'staff'}
        staffList={staff || []}
      />
    </div>
  )
}
```

---

## ğŸ“Š å„ãƒšãƒ¼ã‚¸å›ºæœ‰ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ä»•æ§˜

### 1. è¦‹ç©æ›¸ä¸€è¦§ (`/api/estimates`)
```typescript
interface EstimateFilters {
  search: string         // è¦‹ç©ç•ªå·ã€å–å¼•å…ˆåã€å·¥äº‹å
  status: string         // draft, submitted, sent, accepted, rejected, expired
  creator: string        // ä½œæˆè€…ID
  sortField: string      // estimate_date, valid_until, total_amount
  sortOrder: string      // asc, desc
}
```

### 2. è«‹æ±‚æ›¸ä¸€è¦§ (`/api/invoices`)
```typescript
interface InvoiceFilters {
  search: string         // è«‹æ±‚ç•ªå·ã€å–å¼•å…ˆåã€å·¥äº‹å
  status: string         // draft, submitted, approved, sent, paid
  paymentFilter: string  // all, paid, partial, unpaid
  staffFilter: string    // ä½œæˆã‚¹ã‚¿ãƒƒãƒ•å
  sortField: string      // invoice_date, due_date, total_amount
  sortOrder: string      // asc, desc
}
```

### 3. ç™ºæ³¨æ›¸ä¸€è¦§ (`/api/purchase-orders`)
```typescript
interface PurchaseOrderFilters {
  search: string         // ç™ºæ³¨ç•ªå·ã€ä»•å…¥å…ˆåã€å·¥äº‹å
  status: string         // draft, submitted, approved, rejected, ordered, received, paid
  creator: string        // ä½œæˆè€…ID
}
```

### 4. å…¥é‡‘ç®¡ç† (`/api/payments`)
```typescript
interface PaymentFilters {
  search: string              // å–å¼•å…ˆåã€è«‹æ±‚ç•ªå·
  year: number                // å¹´
  month: number               // æœˆ
  startDate: string           // é–‹å§‹æ—¥
  endDate: string             // çµ‚äº†æ—¥
  paymentType: string         // all, receipt, payment
  paymentMethod: string       // all, cash, bank_transfer, credit_card, etc.
  useMonthFilter: boolean     // æœˆå˜ä½ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã‹
}
```

### 5. å–å¼•å…ˆä¸€è¦§ (`/api/clients`)
```typescript
interface ClientFilters {
  search: string         // åå‰ã€ã‚«ãƒŠã€ã‚³ãƒ¼ãƒ‰ã€ä½æ‰€ã€é›»è©±ç•ªå·
  clientType: string     // all, customer, supplier, partner, both
}
```

### 6. æ¡ˆä»¶ä¸€è¦§ (`/api/projects`)
```typescript
interface ProjectFilters {
  search: string         // æ¡ˆä»¶ã‚³ãƒ¼ãƒ‰ã€æ¡ˆä»¶åã€å–å¼•å…ˆå
  status: string         // all, planning, in_progress, completed, suspended
  sortField: string      // start_date, end_date, contract_amount
  sortOrder: string      // asc, desc
}
```

### 7. ä»•å…¥å…ˆä¸€è¦§ (`/api/suppliers`)
```typescript
interface SupplierFilters {
  search: string         // åå‰ã€ã‚«ãƒŠã€ã‚³ãƒ¼ãƒ‰ã€ä½æ‰€ã€é›»è©±ç•ªå·
}
```

### 8. ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§ (`/api/staff`)
```typescript
interface StaffFilters {
  search: string         // åå‰ã€ãƒ¡ãƒ¼ãƒ«ã€ç¤¾å“¡ç•ªå·
  department: string     // éƒ¨ç½²
  role: string           // staff, leader, manager, admin, super_admin
  status: string         // all, active, inactive
}
```

---

## âš™ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–

### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ç¢ºèªãƒ»è¿½åŠ 

å„ãƒ†ãƒ¼ãƒ–ãƒ«ã§ä»¥ä¸‹ã®ã‚«ãƒ©ãƒ ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒå¿…è¦:

#### estimates ãƒ†ãƒ¼ãƒ–ãƒ«
```sql
CREATE INDEX IF NOT EXISTS idx_estimates_organization_deleted
  ON estimates(organization_id, deleted_at);

CREATE INDEX IF NOT EXISTS idx_estimates_status
  ON estimates(status);

CREATE INDEX IF NOT EXISTS idx_estimates_created_by
  ON estimates(created_by);

CREATE INDEX IF NOT EXISTS idx_estimates_estimate_date
  ON estimates(estimate_date DESC);
```

#### invoices ãƒ†ãƒ¼ãƒ–ãƒ«
```sql
CREATE INDEX IF NOT EXISTS idx_invoices_organization_deleted
  ON billing_invoices(organization_id, deleted_at);

CREATE INDEX IF NOT EXISTS idx_invoices_status
  ON billing_invoices(status);

CREATE INDEX IF NOT EXISTS idx_invoices_invoice_date
  ON billing_invoices(invoice_date DESC);
```

#### purchase_orders ãƒ†ãƒ¼ãƒ–ãƒ«
```sql
CREATE INDEX IF NOT EXISTS idx_purchase_orders_organization
  ON purchase_orders(organization_id);

CREATE INDEX IF NOT EXISTS idx_purchase_orders_status
  ON purchase_orders(status);
```

#### payments ãƒ†ãƒ¼ãƒ–ãƒ«
```sql
CREATE INDEX IF NOT EXISTS idx_payments_organization
  ON payments(organization_id);

CREATE INDEX IF NOT EXISTS idx_payments_date
  ON payments(payment_date DESC);

CREATE INDEX IF NOT EXISTS idx_payments_type
  ON payments(payment_type);
```

#### clients ãƒ†ãƒ¼ãƒ–ãƒ«
```sql
CREATE INDEX IF NOT EXISTS idx_clients_organization_active
  ON clients(organization_id, is_active, deleted_at);

CREATE INDEX IF NOT EXISTS idx_clients_type
  ON clients(client_type);
```

#### projects ãƒ†ãƒ¼ãƒ–ãƒ«
```sql
CREATE INDEX IF NOT EXISTS idx_projects_organization
  ON projects(organization_id);

CREATE INDEX IF NOT EXISTS idx_projects_status
  ON projects(status);

CREATE INDEX IF NOT EXISTS idx_projects_start_date
  ON projects(start_date DESC);
```

---

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒ

### å¤‰æ›´å‰ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

| ãƒ‡ãƒ¼ã‚¿ä»¶æ•° | åˆå›èª­ã¿è¾¼ã¿ | ãƒšãƒ¼ã‚¸åˆ‡ã‚Šæ›¿ãˆ | æ¤œç´¢ | ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ |
|-----------|------------|--------------|------|------------|
| 100ä»¶ | 0.5ç§’ | å³åº§ | å³åº§ | 100KB |
| 1,000ä»¶ | 1.5ç§’ | å³åº§ | å³åº§ | 1MB |
| 10,000ä»¶ | 8ç§’ | å³åº§ | å³åº§ | 10MB |
| 100,000ä»¶ | 80ç§’ | å³åº§ | å³åº§ | 100MB âŒ |

### å¤‰æ›´å¾Œï¼ˆã‚µãƒ¼ãƒãƒ¼å´ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

| ãƒ‡ãƒ¼ã‚¿ä»¶æ•° | åˆå›èª­ã¿è¾¼ã¿ | ãƒšãƒ¼ã‚¸åˆ‡ã‚Šæ›¿ãˆ | æ¤œç´¢ | ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ |
|-----------|------------|--------------|------|------------|
| 100ä»¶ | 0.3ç§’ | 0.3ç§’ | 0.5ç§’ | 20KB |
| 1,000ä»¶ | 0.3ç§’ | 0.3ç§’ | 0.5ç§’ | 20KB |
| 10,000ä»¶ | 0.4ç§’ | 0.3ç§’ | 0.6ç§’ | 20KB |
| 100,000ä»¶ | 0.5ç§’ | 0.4ç§’ | 0.7ç§’ | 20KB âœ… |

---

## ğŸ¯ å®Ÿè£…æ‰‹é †

### ãƒ•ã‚§ãƒ¼ã‚º1: è¦‹ç©æ›¸ä¸€è¦§ã§å®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆï¼ˆ1æ—¥ï¼‰

1. âœ… `/app/api/estimates/route.ts` ã«ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…
2. âœ… `/components/estimates/EstimateListClient.tsx` å¤‰æ›´
3. âœ… `/app/(authenticated)/estimates/page.tsx` å¤‰æ›´
4. âœ… å‹•ä½œç¢ºèªãƒ»ãƒ‡ãƒãƒƒã‚°
5. âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

### ãƒ•ã‚§ãƒ¼ã‚º2: ä»–7ãƒšãƒ¼ã‚¸ã«å±•é–‹ï¼ˆ2æ—¥ï¼‰

6. âœ… è«‹æ±‚æ›¸ä¸€è¦§
7. âœ… ç™ºæ³¨æ›¸ä¸€è¦§
8. âœ… å…¥é‡‘ç®¡ç†
9. âœ… å–å¼•å…ˆä¸€è¦§
10. âœ… æ¡ˆä»¶ä¸€è¦§
11. âœ… ä»•å…¥å…ˆä¸€è¦§
12. âœ… ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§

### ãƒ•ã‚§ãƒ¼ã‚º3: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–ï¼ˆ0.5æ—¥ï¼‰

13. âœ… å„ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ 
14. âœ… ã‚¯ã‚¨ãƒªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š

### ãƒ•ã‚§ãƒ¼ã‚º4: çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ0.5æ—¥ï¼‰

15. âœ… å…¨ãƒšãƒ¼ã‚¸ã®å‹•ä½œç¢ºèª
16. âœ… å¤§é‡ãƒ‡ãƒ¼ã‚¿ã§ã®ãƒ†ã‚¹ãƒˆ
17. âœ… æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤

---

## ğŸ“ ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª

### 1. åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
- [ ] ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã‹
- [ ] æ¤œç´¢æ©Ÿèƒ½ãŒå…¨ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ¤œç´¢ã§ãã‚‹ã‹
- [ ] ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã‹
- [ ] ã‚½ãƒ¼ãƒˆãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã‹

### 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
- [ ] åˆå›èª­ã¿è¾¼ã¿ãŒ2ç§’ä»¥å†…ã‹
- [ ] ãƒšãƒ¼ã‚¸åˆ‡ã‚Šæ›¿ãˆãŒ1ç§’ä»¥å†…ã‹
- [ ] æ¤œç´¢ãŒ1ç§’ä»¥å†…ã‹

### 3. ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ‡ãƒ¼ã‚¿ãŒ0ä»¶ã®å ´åˆ
- [ ] ãƒ‡ãƒ¼ã‚¿ãŒ1ä»¶ã®å ´åˆ
- [ ] ãƒ‡ãƒ¼ã‚¿ãŒ10,000ä»¶ä»¥ä¸Šã®å ´åˆ
- [ ] æ¤œç´¢çµæœãŒ0ä»¶ã®å ´åˆ
- [ ] ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼æ™‚ã®æŒ™å‹•

### 4. UXãƒ†ã‚¹ãƒˆ
- [ ] ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºãŒé©åˆ‡ã‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé©åˆ‡ã‹
- [ ] ãƒšãƒ¼ã‚¸é·ç§»ãŒè‡ªç„¶ã‹

---

## ğŸš¨ ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

### ãƒªã‚¹ã‚¯1: ã‚µãƒ¼ãƒãƒ¼è² è·ã®å¢—åŠ 
**å¯¾ç­–:**
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æœ€é©åŒ–
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å°å…¥ï¼ˆRedisç­‰ï¼‰
- APIãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å®Ÿè£…

### ãƒªã‚¹ã‚¯2: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®ä½ä¸‹
**å¯¾ç­–:**
- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®æ˜ç¢ºãªè¡¨ç¤º
- æ¥½è¦³çš„UIæ›´æ–°ï¼ˆOptimistic Updateï¼‰
- ãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç†ã§ä¸è¦ãªAPIå‘¼ã³å‡ºã—ã‚’å‰Šæ¸›

### ãƒªã‚¹ã‚¯3: å®Ÿè£…ã®è¤‡é›‘åŒ–
**å¯¾ç­–:**
- å…±é€šåŒ–ã•ã‚ŒãŸAPIå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
- å†åˆ©ç”¨å¯èƒ½ãªãƒ•ãƒƒã‚¯ï¼ˆusePaginationï¼‰
- ååˆ†ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

---

## ğŸ“Š ä½œæ¥­é‡è¦‹ç©ã‚‚ã‚Š

| ãƒ•ã‚§ãƒ¼ã‚º | ä½œæ¥­å†…å®¹ | ãƒ•ã‚¡ã‚¤ãƒ«æ•° | æ‰€è¦æ™‚é–“ |
|---------|---------|-----------|---------|
| ãƒ•ã‚§ãƒ¼ã‚º1 | è¦‹ç©æ›¸ä¸€è¦§å®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆ | 3 | 1æ—¥ |
| ãƒ•ã‚§ãƒ¼ã‚º2 | ä»–7ãƒšãƒ¼ã‚¸å±•é–‹ | 21 | 2æ—¥ |
| ãƒ•ã‚§ãƒ¼ã‚º3 | ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ– | - | 0.5æ—¥ |
| ãƒ•ã‚§ãƒ¼ã‚º4 | çµ±åˆãƒ†ã‚¹ãƒˆ | - | 0.5æ—¥ |
| **åˆè¨ˆ** | | **24** | **4æ—¥** |

---

## âœ… å®Œäº†æ¡ä»¶

- [ ] å…¨8ãƒšãƒ¼ã‚¸ãŒã‚µãƒ¼ãƒãƒ¼å´ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã§å‹•ä½œ
- [ ] æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»ã‚½ãƒ¼ãƒˆãŒæ­£å¸¸å‹•ä½œ
- [ ] 10,000ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã§ã‚‚1ç§’ä»¥å†…ã«å¿œç­”
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒé©åˆ‡
- [ ] ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºãŒé©åˆ‡
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒè¨­å®šæ¸ˆã¿
- [ ] ãƒ†ã‚¹ãƒˆãŒå…¨ã¦é€šé
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæ›´æ–°æ¸ˆã¿

---

## ğŸ“š å‚è€ƒè³‡æ–™

- [Supabase Pagination Guide](https://supabase.com/docs/guides/api/pagination)
- [Next.js Data Fetching](https://nextjs.org/docs/app/building-your-application/data-fetching)
- [PostgreSQL Index Best Practices](https://www.postgresql.org/docs/current/indexes.html)

---

## æ›´æ–°å±¥æ­´

- 2026-01-23: åˆç‰ˆä½œæˆ
