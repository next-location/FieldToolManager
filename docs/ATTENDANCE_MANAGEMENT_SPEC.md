# å‡ºé€€å‹¤ç®¡ç†æ©Ÿèƒ½ å®Œå…¨ä»•æ§˜æ›¸

> **ä½œæˆæ—¥**: 2025-12-04
> **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
> **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Phase 1-3å®Ÿè£…äºˆå®šï¼ˆé¡”èªè¨¼ã¯Phase 4ä»¥é™ï¼‰

---

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [æ©Ÿèƒ½è¦ä»¶](#æ©Ÿèƒ½è¦ä»¶)
3. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
4. [APIè¨­è¨ˆ](#apiè¨­è¨ˆ)
5. [UI/UXè¨­è¨ˆ](#uiuxè¨­è¨ˆ)
6. [å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º](#å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º)
7. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶)
8. [ãƒ†ã‚¹ãƒˆè¨ˆç”»](#ãƒ†ã‚¹ãƒˆè¨ˆç”»)

---

## æ¦‚è¦

### ç›®çš„
ã‚¹ã‚¿ãƒƒãƒ•ã®å‡ºé€€å‹¤ã‚’è¨˜éŒ²ãƒ»ç®¡ç†ã—ã€å‹¤æ€ ãƒ‡ãƒ¼ã‚¿ã‚’å¯è¦–åŒ–ã™ã‚‹ã“ã¨ã§åŠ´å‹™ç®¡ç†ã‚’åŠ¹ç‡åŒ–ã™ã‚‹ã€‚

### å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼
- **å…¨ã‚¹ã‚¿ãƒƒãƒ•**: è‡ªåˆ†ã®å‡ºé€€å‹¤ã‚’æ‰“åˆ»
- **ç®¡ç†è€…/ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼**: å…¨ã‚¹ã‚¿ãƒƒãƒ•ã®å‹¤æ€ ç®¡ç†ãƒ»æœˆæ¬¡é›†è¨ˆãƒ»æ‰‹å‹•ä¿®æ­£

### ä¸»è¦æ©Ÿèƒ½
1. **å‡ºé€€å‹¤æ‰“åˆ»**: ä¼šç¤¾ãƒ»ç¾å ´ã§ã®å‡ºé€€å‹¤è¨˜éŒ²
2. **æ‰“åˆ»æ–¹æ³•**: æ‰‹å‹•ãƒ»QRã‚¹ã‚­ãƒ£ãƒ³ãƒ»QRå¸¸æ™‚è¡¨ç¤ºï¼ˆã‚¿ãƒ–ãƒ¬ãƒƒãƒˆï¼‰
3. **ä¼‘æ†©æ™‚é–“ç®¡ç†**: none/simple/detailed ã®3ãƒ¢ãƒ¼ãƒ‰
4. **å‹¤æ€ ä¸€è¦§**: æ—¥åˆ¥ãƒ»ã‚¹ã‚¿ãƒƒãƒ•åˆ¥ã®é–²è¦§
5. **æœˆæ¬¡é›†è¨ˆ**: å‹¤å‹™æ—¥æ•°ãƒ»æ™‚é–“ã®è‡ªå‹•è¨ˆç®—
6. **ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥**: å‡ºé€€å‹¤å¿˜ã‚Œãƒ»QRæœŸé™åˆ‡ã‚Œ
7. **æ‰‹å‹•ä¿®æ­£**: æ‰“åˆ»å¿˜ã‚Œã®ç®¡ç†è€…ã«ã‚ˆã‚‹ä¿®æ­£

---

## æ©Ÿèƒ½è¦ä»¶

### 1. çµ„ç¹”è¨­å®š

ä¼æ¥­ã”ã¨ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªè¨­å®š:

| è¨­å®šé …ç›® | é¸æŠè‚¢ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ |
|---------|--------|------------|
| **ä¼šç¤¾å‡ºå‹¤æ©Ÿèƒ½** | ä½¿ç”¨ã™ã‚‹ / ä½¿ç”¨ã—ãªã„ | ä½¿ç”¨ã™ã‚‹ |
| **ä¼šç¤¾æ‰“åˆ»æ–¹æ³•** | æ‰‹å‹• / QRã‚¹ã‚­ãƒ£ãƒ³ / QRå¸¸æ™‚è¡¨ç¤ºï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰ | æ‰‹å‹• + QRã‚¹ã‚­ãƒ£ãƒ³ |
| **ä¼šç¤¾QRæ›´æ–°é »åº¦** | 1æ—¥ / 3æ—¥ / 7æ—¥ / 30æ—¥ | 7æ—¥ |
| **ç¾å ´å‡ºå‹¤æ©Ÿèƒ½** | ä½¿ç”¨ã™ã‚‹ / ä½¿ç”¨ã—ãªã„ | ä½¿ç”¨ã™ã‚‹ |
| **ç¾å ´æ‰“åˆ»æ–¹æ³•** | æ‰‹å‹• / QRã‚¹ã‚­ãƒ£ãƒ³ / QRå¸¸æ™‚è¡¨ç¤ºï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰ | æ‰‹å‹• + QRã‚¹ã‚­ãƒ£ãƒ³ |
| **ç¾å ´QRã‚¿ã‚¤ãƒ—** | ãƒªãƒ¼ãƒ€ãƒ¼ç™ºè¡Œ / å›ºå®šQR / ä¸¡æ–¹ | ãƒªãƒ¼ãƒ€ãƒ¼ç™ºè¡Œ |
| **ä¼‘æ†©æ™‚é–“è¨˜éŒ²** | none / simple / detailed | simple |
| **è‡ªå‹•ä¼‘æ†©æ§é™¤** | æœ‰åŠ¹ / ç„¡åŠ¹ | ç„¡åŠ¹ |
| **æ§é™¤æ™‚é–“** | åˆ†å˜ä½ | 45åˆ† |
| **å‡ºå‹¤å¿˜ã‚Œé€šçŸ¥** | æœ‰åŠ¹ / ç„¡åŠ¹ | æœ‰åŠ¹ |
| **å‡ºå‹¤å¿˜ã‚Œé€šçŸ¥æ™‚åˆ»** | HH:MM | 10:00 |
| **é€€å‹¤å¿˜ã‚Œé€šçŸ¥** | æœ‰åŠ¹ / ç„¡åŠ¹ | æœ‰åŠ¹ |
| **é€€å‹¤å¿˜ã‚Œé€šçŸ¥æ™‚åˆ»** | HH:MM | 20:00 |
| **ç®¡ç†è€…æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ** | æœ‰åŠ¹ / ç„¡åŠ¹ | æœ‰åŠ¹ |
| **ãƒ¬ãƒãƒ¼ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡** | æœ‰åŠ¹ / ç„¡åŠ¹ | æœ‰åŠ¹ |
| **QRæœŸé™åˆ‡ã‚Œé€šçŸ¥** | æœ‰åŠ¹ / ç„¡åŠ¹ | æœ‰åŠ¹ |
| **é•·æ™‚é–“åŠ´åƒã‚¢ãƒ©ãƒ¼ãƒˆ** | æ™‚é–“æ•° | 12æ™‚é–“ |

### 2. å‡ºå‹¤æ‰“åˆ»ãƒ•ãƒ­ãƒ¼

#### A. ä¼šç¤¾å‡ºå‹¤ã®å ´åˆ

**ãƒ‘ã‚¿ãƒ¼ãƒ³1: æ‰‹å‹•æ‰“åˆ»**
```
1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã€Œä¼šç¤¾ã«å‡ºå‹¤ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
2. é€€å‹¤äºˆå®šå…ˆã‚’é¸æŠï¼ˆåŒã˜å ´æ‰€ / ç›´å¸° / ç¾å ´ï¼‰
3. ã€Œå‡ºå‹¤ã™ã‚‹ã€ç¢ºå®š
4. å®Œäº†ç”»é¢è¡¨ç¤º
```

**ãƒ‘ã‚¿ãƒ¼ãƒ³2: QRã‚¹ã‚­ãƒ£ãƒ³**
```
1. ä¼šç¤¾å…¥å£ã®QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³
2. è‡ªå‹•çš„ã«ä¼šç¤¾å‡ºå‹¤ã¨ã—ã¦è¨˜éŒ²
3. å®Œäº†ç”»é¢è¡¨ç¤º
```

**ãƒ‘ã‚¿ãƒ¼ãƒ³3: QRå¸¸æ™‚è¡¨ç¤ºï¼ˆã‚¿ãƒ–ãƒ¬ãƒƒãƒˆè¨­ç½®ï¼‰**
```
1. ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç”»é¢ã«QRã‚³ãƒ¼ãƒ‰ã‚’å¸¸æ™‚è¡¨ç¤º
2. ã‚¹ã‚¿ãƒƒãƒ•ãŒã‚¹ãƒãƒ›ã§QRã‚¹ã‚­ãƒ£ãƒ³
3. è‡ªå‹•è¨˜éŒ²
```

#### B. ç¾å ´ç›´è¡Œã®å ´åˆ

**ãƒ‘ã‚¿ãƒ¼ãƒ³1: æ‰‹å‹•æ‰“åˆ»**
```
1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã€Œç¾å ´ã«ç›´è¡Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
2. ç¾å ´ã‚’é¸æŠ
3. é€€å‹¤äºˆå®šå…ˆã‚’é¸æŠ
4. ã€Œå‡ºå‹¤ã™ã‚‹ã€ç¢ºå®š
```

**ãƒ‘ã‚¿ãƒ¼ãƒ³2: ãƒªãƒ¼ãƒ€ãƒ¼QRã‚¹ã‚­ãƒ£ãƒ³**
```
1. ãƒªãƒ¼ãƒ€ãƒ¼ãŒã‚¢ãƒ—ãƒªã§ã€Œç¾å ´QRã‚’è¡¨ç¤ºã€
2. ä»–ã®ã‚¹ã‚¿ãƒƒãƒ•ãŒãƒªãƒ¼ãƒ€ãƒ¼ã®QRã‚’ã‚¹ã‚­ãƒ£ãƒ³
3. è‡ªå‹•çš„ã«ãã®ç¾å ´ã¸ã®å‡ºå‹¤ã¨ã—ã¦è¨˜éŒ²
4. ãƒªãƒ¼ãƒ€ãƒ¼è‡ªèº«ã¯æ‰‹å‹•ã§å‡ºå‹¤æ‰“åˆ»
```

**ãƒ‘ã‚¿ãƒ¼ãƒ³3: å›ºå®šQRï¼ˆç¾å ´ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆï¼‰**
```
1. ç¾å ´ã«ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã‚’è¨­ç½®
2. ç¾å ´å°‚ç”¨QRã‚’å¸¸æ™‚è¡¨ç¤º
3. ã‚¹ã‚¿ãƒƒãƒ•ãŒã‚¹ã‚­ãƒ£ãƒ³ã—ã¦å‡ºå‹¤
```

### 3. é€€å‹¤æ‰“åˆ»ãƒ•ãƒ­ãƒ¼

```
1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã€Œé€€å‹¤ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
2. å‡ºå‹¤æ™‚ã®äºˆå®šã¨ç•°ãªã‚‹å ´åˆã¯å¤‰æ›´å¯èƒ½
3. ã€Œé€€å‹¤ã™ã‚‹ã€ç¢ºå®š
4. å®Œäº†ç”»é¢è¡¨ç¤º
```

### 4. ä¼‘æ†©æ™‚é–“ç®¡ç†

#### Mode 1: noneï¼ˆè¨˜éŒ²ã—ãªã„ï¼‰
- ä¼‘æ†©æ™‚é–“UIã‚’éè¡¨ç¤º
- 6æ™‚é–“è¶…éæ™‚ã«è‡ªå‹•æ§é™¤ï¼ˆè¨­å®šã«ã‚ˆã‚‹ï¼‰

#### Mode 2: simpleï¼ˆ1æ—¥1å›ï¼‰
```
ä¼‘æ†©é–‹å§‹: ã€Œä¼‘æ†©é–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
ä¼‘æ†©çµ‚äº†: ã€Œä¼‘æ†©çµ‚äº†ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
```

#### Mode 3: detailedï¼ˆè¤‡æ•°å›å¯èƒ½ï¼‰
```
è¤‡æ•°å›ã®ä¼‘æ†©ã‚’è¨˜éŒ²:
- 1å›ç›®: 12:00-12:45 (45åˆ†)
- 2å›ç›®: 15:00-15:15 (15åˆ†)
- åˆè¨ˆ: 1æ™‚é–“0åˆ†
```

### 5. å‹¤æ€ ä¸€è¦§ï¼ˆç®¡ç†è€…/ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ç”¨ï¼‰

#### ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½
- æ—¥ä»˜ç¯„å›²é¸æŠ
- ã‚¹ã‚¿ãƒƒãƒ•é¸æŠï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰
- å‡ºå‹¤å…ˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆä¼šç¤¾ / ç¾å ´åˆ¥ï¼‰
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆå‡ºå‹¤ä¸­ / é€€å‹¤æ¸ˆã¿ / æœªå‡ºå‹¤ï¼‰

#### è¡¨ç¤ºé …ç›®
| åˆ— | å†…å®¹ |
|----|------|
| æ—¥ä»˜ | YYYY/MM/DD |
| ã‚¹ã‚¿ãƒƒãƒ•å | åå‰ + éƒ¨ç½² |
| å‡ºå‹¤ | æ™‚åˆ» + å‡ºå‹¤å…ˆ |
| é€€å‹¤ | æ™‚åˆ» + é€€å‹¤å…ˆ |
| å‹¤å‹™æ™‚é–“ | HH:MM |
| ä¼‘æ†©æ™‚é–“ | HH:MM |
| å®ŸåŠ´åƒæ™‚é–“ | HH:MM |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ğŸŸ¢å‹¤å‹™ä¸­ / âœ…é€€å‹¤æ¸ˆã¿ |
| æ“ä½œ | ç·¨é›† / å‰Šé™¤ |

#### ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
- CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- æ‰‹å‹•è¿½åŠ ï¼ˆæ‰“åˆ»å¿˜ã‚Œå¯¾å¿œï¼‰
- ä¸€æ‹¬ç·¨é›†

### 6. æœˆæ¬¡é›†è¨ˆãƒ¬ãƒãƒ¼ãƒˆ

#### ã‚¹ã‚¿ãƒƒãƒ•åˆ¥é›†è¨ˆ
```
å±±ç”° å¤ªéƒ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å‡ºå‹¤æ—¥æ•°:        20æ—¥
æ¬ å‹¤æ—¥æ•°:        2æ—¥
é…åˆ»å›æ•°:        1å›
æ—©é€€å›æ•°:        0å›
ç·å‹¤å‹™æ™‚é–“:      160æ™‚é–“30åˆ†
å¹³å‡å‹¤å‹™æ™‚é–“:    8æ™‚é–“2åˆ†
æ®‹æ¥­æ™‚é–“:        10æ™‚é–“30åˆ†
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

#### ç¾å ´åˆ¥é›†è¨ˆ
```
Aç¾å ´ï¼ˆæ±äº¬éƒ½æ¸‹è°·åŒºâ—‹â—‹ãƒ“ãƒ«ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ç¨¼åƒæ—¥æ•°:        15æ—¥
å»¶ã¹äººæ•°:        45äºº
ç·ç¨¼åƒæ™‚é–“:      360æ™‚é–“
å¹³å‡äººæ•°:        3äºº/æ—¥
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

### 7. ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥

#### å‡ºå‹¤å¿˜ã‚Œã‚¢ãƒ©ãƒ¼ãƒˆ
```
å¯¾è±¡: æœ¬äºº
ã‚¿ã‚¤ãƒŸãƒ³ã‚°: 10:00æ™‚ç‚¹ã§æœªå‡ºå‹¤
é€šçŸ¥æ–¹æ³•: ã‚¢ãƒ—ãƒªå†…é€šçŸ¥
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ã€Œæœ¬æ—¥ã¾ã å‡ºå‹¤ã—ã¦ã„ã¾ã›ã‚“ã€‚æ‰“åˆ»ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚ã€
```

#### é€€å‹¤å¿˜ã‚Œã‚¢ãƒ©ãƒ¼ãƒˆ
```
å¯¾è±¡: æœ¬äºº
ã‚¿ã‚¤ãƒŸãƒ³ã‚°: 20:00æ™‚ç‚¹ã§æœªé€€å‹¤
é€šçŸ¥æ–¹æ³•: ã‚¢ãƒ—ãƒªå†…é€šçŸ¥
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ã€Œé€€å‹¤æ‰“åˆ»ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚ã€
```

#### æœªå‡ºå‹¤è€…ãƒ¬ãƒãƒ¼ãƒˆï¼ˆç®¡ç†è€…å‘ã‘ï¼‰
```
å¯¾è±¡: ç®¡ç†è€…/ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
ã‚¿ã‚¤ãƒŸãƒ³ã‚°: æ¯æœ10:00
é€šçŸ¥æ–¹æ³•: ã‚¢ãƒ—ãƒªå†…é€šçŸ¥ + ãƒ¡ãƒ¼ãƒ«
å†…å®¹: æœªå‡ºå‹¤ã‚¹ã‚¿ãƒƒãƒ•ã®ãƒªã‚¹ãƒˆ
```

#### QRæœŸé™åˆ‡ã‚Œé€šçŸ¥
```
å¯¾è±¡: ç®¡ç†è€…
ã‚¿ã‚¤ãƒŸãƒ³ã‚°: QRæ›´æ–°ã®1æ—¥å‰
é€šçŸ¥æ–¹æ³•: ã‚¢ãƒ—ãƒªå†…é€šçŸ¥ + ãƒ¡ãƒ¼ãƒ«
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ã€Œæ˜æ—¥ã€ä¼šç¤¾QRã‚³ãƒ¼ãƒ‰ãŒæ›´æ–°ã•ã‚Œã¾ã™ã€‚æ–°ã—ã„QRã‚’å°åˆ·ã—ã¦ãã ã•ã„ã€‚ã€
```

#### é•·æ™‚é–“åŠ´åƒã‚¢ãƒ©ãƒ¼ãƒˆ
```
å¯¾è±¡: ç®¡ç†è€…/ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
ã‚¿ã‚¤ãƒŸãƒ³ã‚°: 12æ™‚é–“è¶…éæ™‚
é€šçŸ¥æ–¹æ³•: ã‚¢ãƒ—ãƒªå†…é€šçŸ¥
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ã€Œå±±ç”°å¤ªéƒã•ã‚“ãŒ12æ™‚é–“ä»¥ä¸Šå‹¤å‹™ã—ã¦ã„ã¾ã™ã€‚ã€
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### 1. organization_attendance_settings

çµ„ç¹”ã”ã¨ã®å‡ºé€€å‹¤è¨­å®šã€‚

```sql
CREATE TABLE organization_attendance_settings (
  organization_id UUID PRIMARY KEY REFERENCES organizations(id),

  -- ä¼šç¤¾å‡ºå‹¤è¨­å®š
  office_attendance_enabled BOOLEAN DEFAULT true,
  office_clock_methods JSONB NOT NULL DEFAULT '{"manual":true,"qr_scan":false,"qr_display":false}',
  office_qr_rotation_days INTEGER DEFAULT 7 CHECK (office_qr_rotation_days IN (1, 3, 7, 30)),

  -- ç¾å ´å‡ºå‹¤è¨­å®š
  site_attendance_enabled BOOLEAN DEFAULT true,
  site_clock_methods JSONB NOT NULL DEFAULT '{"manual":true,"qr_scan":false,"qr_display":false}',
  site_qr_type TEXT DEFAULT 'leader' CHECK (site_qr_type IN ('leader', 'fixed', 'both')),

  -- ä¼‘æ†©æ™‚é–“è¨­å®š
  break_time_mode TEXT DEFAULT 'simple' CHECK (break_time_mode IN ('none', 'simple', 'detailed')),
  auto_break_deduction BOOLEAN DEFAULT false,
  auto_break_minutes INTEGER DEFAULT 45,

  -- é€šçŸ¥è¨­å®š
  checkin_reminder_enabled BOOLEAN DEFAULT true,
  checkin_reminder_time TIME DEFAULT '10:00',
  checkout_reminder_enabled BOOLEAN DEFAULT true,
  checkout_reminder_time TIME DEFAULT '20:00',
  admin_daily_report_enabled BOOLEAN DEFAULT true,
  admin_daily_report_time TIME DEFAULT '10:00',
  admin_daily_report_email BOOLEAN DEFAULT true,
  qr_expiry_alert_enabled BOOLEAN DEFAULT true,
  qr_expiry_alert_email BOOLEAN DEFAULT true,
  overtime_alert_enabled BOOLEAN DEFAULT false,
  overtime_alert_hours INTEGER DEFAULT 12,

  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- RLS
ALTER TABLE organization_attendance_settings ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Organizations can manage their own settings"
  ON organization_attendance_settings
  FOR ALL
  USING (
    organization_id IN (
      SELECT organization_id FROM users WHERE id = auth.uid()
    )
  );
```

### 2. site_attendance_settings

ç¾å ´ã”ã¨ã®å‡ºé€€å‹¤è¨­å®šï¼ˆsite_qr_type='both'ã®å ´åˆã®ã¿ä½¿ç”¨ï¼‰ã€‚

```sql
CREATE TABLE site_attendance_settings (
  site_id UUID PRIMARY KEY REFERENCES sites(id),
  organization_id UUID NOT NULL REFERENCES organizations(id),
  qr_mode TEXT NOT NULL DEFAULT 'leader' CHECK (qr_mode IN ('leader', 'fixed')),
  has_tablet BOOLEAN DEFAULT false,
  tablet_access_token TEXT UNIQUE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- RLS
ALTER TABLE site_attendance_settings ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view their organization's site settings"
  ON site_attendance_settings FOR SELECT
  USING (
    organization_id IN (
      SELECT organization_id FROM users WHERE id = auth.uid()
    )
  );

CREATE POLICY "Admins can manage site settings"
  ON site_attendance_settings FOR ALL
  USING (
    organization_id IN (
      SELECT organization_id FROM users
      WHERE id = auth.uid()
      AND role IN ('admin', 'manager')
    )
  );
```

### 3. office_qr_codes

ä¼šç¤¾å‡ºå‹¤ç”¨ã®QRã‚³ãƒ¼ãƒ‰ï¼ˆå®šæœŸæ›´æ–°å‹ï¼‰ã€‚

```sql
CREATE TABLE office_qr_codes (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  organization_id UUID NOT NULL REFERENCES organizations(id),
  qr_data TEXT NOT NULL UNIQUE,
  valid_from TIMESTAMPTZ NOT NULL,
  valid_until TIMESTAMPTZ NOT NULL,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW(),

  -- æœ‰åŠ¹æœŸé–“ã®é‡è¤‡é˜²æ­¢
  EXCLUDE USING gist (
    organization_id WITH =,
    tstzrange(valid_from, valid_until) WITH &&
  ) WHERE (is_active = true)
);

CREATE INDEX idx_office_qr_codes_org_active ON office_qr_codes(organization_id, is_active);
CREATE INDEX idx_office_qr_codes_qr_data ON office_qr_codes(qr_data);

-- RLS
ALTER TABLE office_qr_codes ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view their organization's QR codes"
  ON office_qr_codes FOR SELECT
  USING (
    organization_id IN (
      SELECT organization_id FROM users WHERE id = auth.uid()
    )
  );

CREATE POLICY "Admins can manage QR codes"
  ON office_qr_codes FOR ALL
  USING (
    organization_id IN (
      SELECT organization_id FROM users
      WHERE id = auth.uid()
      AND role IN ('admin', 'manager')
    )
  );
```

### 4. site_qr_codes

ç¾å ´å‡ºå‹¤ç”¨ã®QRã‚³ãƒ¼ãƒ‰ï¼ˆãƒªãƒ¼ãƒ€ãƒ¼ç™ºè¡Œå‹ or å›ºå®šå‹ï¼‰ã€‚

```sql
CREATE TABLE site_qr_codes (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  organization_id UUID NOT NULL REFERENCES organizations(id),
  site_id UUID NOT NULL REFERENCES sites(id),
  qr_type TEXT NOT NULL CHECK (qr_type IN ('leader', 'fixed')),

  -- ãƒªãƒ¼ãƒ€ãƒ¼å‹ã®å ´åˆ
  leader_user_id UUID REFERENCES users(id),
  generated_date DATE,

  -- å›ºå®šå‹ã®å ´åˆ
  qr_data TEXT,
  expires_at TIMESTAMPTZ,

  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW(),

  -- ãƒªãƒ¼ãƒ€ãƒ¼å‹ã¯1æ—¥1ãƒ¬ã‚³ãƒ¼ãƒ‰
  UNIQUE(site_id, leader_user_id, generated_date)
    WHERE (qr_type = 'leader'),

  -- å›ºå®šå‹ã¯ç¾å ´ã”ã¨ã«1ã¤
  UNIQUE(site_id)
    WHERE (qr_type = 'fixed' AND is_active = true)
);

CREATE INDEX idx_site_qr_codes_org ON site_qr_codes(organization_id);
CREATE INDEX idx_site_qr_codes_site ON site_qr_codes(site_id);
CREATE INDEX idx_site_qr_codes_leader ON site_qr_codes(leader_user_id, generated_date) WHERE qr_type = 'leader';

-- RLS
ALTER TABLE site_qr_codes ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view their organization's site QR codes"
  ON site_qr_codes FOR SELECT
  USING (
    organization_id IN (
      SELECT organization_id FROM users WHERE id = auth.uid()
    )
  );

CREATE POLICY "Leaders can generate their site QR codes"
  ON site_qr_codes FOR INSERT
  WITH CHECK (
    qr_type = 'leader'
    AND leader_user_id = auth.uid()
    AND organization_id IN (
      SELECT organization_id FROM users WHERE id = auth.uid()
    )
  );

CREATE POLICY "Admins can manage site QR codes"
  ON site_qr_codes FOR ALL
  USING (
    organization_id IN (
      SELECT organization_id FROM users
      WHERE id = auth.uid()
      AND role IN ('admin', 'manager')
    )
  );
```

### 5. attendance_records

å‡ºé€€å‹¤è¨˜éŒ²ã®ãƒ¡ã‚¤ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ã€‚

```sql
CREATE TABLE attendance_records (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  organization_id UUID NOT NULL REFERENCES organizations(id),
  user_id UUID NOT NULL REFERENCES users(id),
  date DATE NOT NULL,

  -- å‡ºå‹¤æƒ…å ±
  clock_in_time TIMESTAMPTZ NOT NULL,
  clock_in_location_type TEXT NOT NULL CHECK (clock_in_location_type IN ('office', 'site', 'remote')),
  clock_in_site_id UUID REFERENCES sites(id),
  clock_in_method TEXT NOT NULL CHECK (clock_in_method IN ('manual', 'qr')),
  clock_in_device_type TEXT CHECK (clock_in_device_type IN ('mobile', 'tablet', 'desktop')),

  -- é€€å‹¤äºˆå®š
  planned_checkout_location_type TEXT CHECK (planned_checkout_location_type IN ('office', 'site', 'remote', 'direct_home')),
  planned_checkout_site_id UUID REFERENCES sites(id),

  -- é€€å‹¤æƒ…å ±ï¼ˆå®Ÿç¸¾ï¼‰
  clock_out_time TIMESTAMPTZ,
  clock_out_location_type TEXT CHECK (clock_out_location_type IN ('office', 'site', 'remote', 'direct_home')),
  clock_out_site_id UUID REFERENCES sites(id),
  clock_out_method TEXT CHECK (clock_out_method IN ('manual', 'qr')),
  clock_out_device_type TEXT CHECK (clock_out_device_type IN ('mobile', 'tablet', 'desktop')),

  -- ä¼‘æ†©æ™‚é–“
  break_records JSONB DEFAULT '[]',
  -- ä¾‹: [{"start": "2025-12-04T12:00:00Z", "end": "2025-12-04T12:45:00Z"}]

  auto_break_deducted_minutes INTEGER DEFAULT 0,

  -- ãƒ¡ã‚¿æƒ…å ±
  notes TEXT,
  is_offline_sync BOOLEAN DEFAULT false,
  synced_at TIMESTAMPTZ,
  is_manually_edited BOOLEAN DEFAULT false,
  edited_by UUID REFERENCES users(id),
  edited_at TIMESTAMPTZ,
  edited_reason TEXT,

  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),

  -- 1æ—¥1ãƒ¬ã‚³ãƒ¼ãƒ‰åˆ¶ç´„
  UNIQUE(organization_id, user_id, date)
);

CREATE INDEX idx_attendance_records_org ON attendance_records(organization_id);
CREATE INDEX idx_attendance_records_user_date ON attendance_records(user_id, date DESC);
CREATE INDEX idx_attendance_records_date ON attendance_records(date DESC);
CREATE INDEX idx_attendance_records_org_date ON attendance_records(organization_id, date DESC);

-- RLS
ALTER TABLE attendance_records ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own attendance records"
  ON attendance_records FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can insert own attendance records"
  ON attendance_records FOR INSERT
  WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update own attendance records"
  ON attendance_records FOR UPDATE
  USING (auth.uid() = user_id AND is_manually_edited = false);

CREATE POLICY "Admins can view all attendance records"
  ON attendance_records FOR SELECT
  USING (
    organization_id IN (
      SELECT organization_id FROM users
      WHERE id = auth.uid()
      AND role IN ('admin', 'manager')
    )
  );

CREATE POLICY "Admins can manage all attendance records"
  ON attendance_records FOR ALL
  USING (
    organization_id IN (
      SELECT organization_id FROM users
      WHERE id = auth.uid()
      AND role IN ('admin', 'manager')
    )
  );
```

### 6. attendance_alerts

ã‚¢ãƒ©ãƒ¼ãƒˆå±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«ã€‚

```sql
CREATE TABLE attendance_alerts (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  organization_id UUID NOT NULL REFERENCES organizations(id),
  alert_type TEXT NOT NULL CHECK (alert_type IN ('missing_checkin', 'missing_checkout', 'qr_expiring', 'overtime')),
  target_user_id UUID REFERENCES users(id),
  target_date DATE,
  message TEXT NOT NULL,
  metadata JSONB,
  is_resolved BOOLEAN DEFAULT false,
  resolved_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_attendance_alerts_org ON attendance_alerts(organization_id);
CREATE INDEX idx_attendance_alerts_user ON attendance_alerts(target_user_id);
CREATE INDEX idx_attendance_alerts_date ON attendance_alerts(target_date DESC);
CREATE INDEX idx_attendance_alerts_resolved ON attendance_alerts(organization_id, is_resolved);

-- RLS
ALTER TABLE attendance_alerts ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own alerts"
  ON attendance_alerts FOR SELECT
  USING (auth.uid() = target_user_id);

CREATE POLICY "Admins can view all alerts"
  ON attendance_alerts FOR SELECT
  USING (
    organization_id IN (
      SELECT organization_id FROM users
      WHERE id = auth.uid()
      AND role IN ('admin', 'manager')
    )
  );

CREATE POLICY "System can insert alerts"
  ON attendance_alerts FOR INSERT
  WITH CHECK (true);
```

### 7. terminal_devices

ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç«¯æœ«ç®¡ç†ãƒ†ãƒ¼ãƒ–ãƒ«ã€‚

```sql
CREATE TABLE terminal_devices (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  organization_id UUID NOT NULL REFERENCES organizations(id),
  device_name TEXT NOT NULL,
  device_type TEXT NOT NULL CHECK (device_type IN ('office', 'site')),
  site_id UUID REFERENCES sites(id),
  access_token TEXT NOT NULL UNIQUE,
  last_accessed_at TIMESTAMPTZ,
  is_active BOOLEAN DEFAULT true,
  created_by UUID REFERENCES users(id),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_terminal_devices_org ON terminal_devices(organization_id);
CREATE INDEX idx_terminal_devices_token ON terminal_devices(access_token);

-- RLS
ALTER TABLE terminal_devices ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Admins can manage terminal devices"
  ON terminal_devices FOR ALL
  USING (
    organization_id IN (
      SELECT organization_id FROM users
      WHERE id = auth.uid()
      AND role IN ('admin', 'manager')
    )
  );
```

---

## APIè¨­è¨ˆ

### 1. çµ„ç¹”è¨­å®šAPI

#### GET /api/attendance/settings
çµ„ç¹”ã®å‡ºé€€å‹¤è¨­å®šã‚’å–å¾—ã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "organization_id": "uuid",
  "office_attendance_enabled": true,
  "office_clock_methods": {
    "manual": true,
    "qr_scan": true,
    "qr_display": false
  },
  "office_qr_rotation_days": 7,
  "site_attendance_enabled": true,
  "site_clock_methods": {
    "manual": true,
    "qr_scan": true,
    "qr_display": false
  },
  "site_qr_type": "leader",
  "break_time_mode": "simple",
  "auto_break_deduction": false,
  "auto_break_minutes": 45,
  "checkin_reminder_enabled": true,
  "checkin_reminder_time": "10:00",
  "checkout_reminder_enabled": true,
  "checkout_reminder_time": "20:00",
  "admin_daily_report_enabled": true,
  "admin_daily_report_email": true,
  "qr_expiry_alert_enabled": true,
  "overtime_alert_hours": 12
}
```

#### PUT /api/attendance/settings
çµ„ç¹”ã®å‡ºé€€å‹¤è¨­å®šã‚’æ›´æ–°ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "office_clock_methods": {
    "manual": true,
    "qr_scan": false,
    "qr_display": true
  },
  "break_time_mode": "detailed"
}
```

### 2. å‡ºé€€å‹¤æ‰“åˆ»API

#### POST /api/attendance/clock-in
å‡ºå‹¤æ‰“åˆ»ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "location_type": "office" | "site" | "remote",
  "site_id": "uuidï¼ˆç¾å ´ã®å ´åˆï¼‰",
  "method": "manual" | "qr",
  "qr_data": "stringï¼ˆQRã®å ´åˆï¼‰",
  "device_type": "mobile" | "tablet" | "desktop",
  "planned_checkout_location_type": "office" | "site" | "direct_home",
  "planned_checkout_site_id": "uuidï¼ˆç¾å ´ã®å ´åˆï¼‰"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "attendance_record": {
    "id": "uuid",
    "user_id": "uuid",
    "date": "2025-12-04",
    "clock_in_time": "2025-12-04T09:00:00Z",
    "clock_in_location_type": "office",
    "clock_in_method": "manual"
  }
}
```

#### POST /api/attendance/clock-out
é€€å‹¤æ‰“åˆ»ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "location_type": "office" | "site" | "direct_home",
  "site_id": "uuidï¼ˆç¾å ´ã®å ´åˆï¼‰",
  "method": "manual" | "qr",
  "qr_data": "stringï¼ˆQRã®å ´åˆï¼‰",
  "device_type": "mobile" | "tablet" | "desktop"
}
```

### 3. ä¼‘æ†©æ™‚é–“API

#### POST /api/attendance/break/start
ä¼‘æ†©é–‹å§‹ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "date": "2025-12-04"
}
```

#### POST /api/attendance/break/end
ä¼‘æ†©çµ‚äº†ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "date": "2025-12-04"
}
```

### 4. å‹¤æ€ ä¸€è¦§API

#### GET /api/attendance/records
å‹¤æ€ è¨˜éŒ²ã®ä¸€è¦§å–å¾—ã€‚

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `start_date`: é–‹å§‹æ—¥ï¼ˆYYYY-MM-DDï¼‰
- `end_date`: çµ‚äº†æ—¥ï¼ˆYYYY-MM-DDï¼‰
- `user_ids`: ã‚¹ã‚¿ãƒƒãƒ•IDï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰
- `location_type`: office | site | all
- `status`: clocked_in | clocked_out | missing
- `page`: ãƒšãƒ¼ã‚¸ç•ªå·
- `limit`: 1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ä»¶æ•°

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "records": [
    {
      "id": "uuid",
      "date": "2025-12-04",
      "user": {
        "id": "uuid",
        "name": "å±±ç”°å¤ªéƒ",
        "department": "ç¬¬ä¸€å–¶æ¥­éƒ¨"
      },
      "clock_in_time": "2025-12-04T09:00:00Z",
      "clock_in_location": "ä¼šç¤¾",
      "clock_out_time": "2025-12-04T18:00:00Z",
      "clock_out_location": "ä¼šç¤¾",
      "work_hours": "09:00",
      "break_minutes": 45,
      "actual_work_hours": "08:15",
      "status": "clocked_out",
      "is_manually_edited": false
    }
  ],
  "total": 100,
  "page": 1,
  "limit": 20
}
```

#### GET /api/attendance/records/[id]
ç‰¹å®šã®å‹¤æ€ è¨˜éŒ²ã‚’å–å¾—ã€‚

#### PUT /api/attendance/records/[id]
å‹¤æ€ è¨˜éŒ²ã‚’æ‰‹å‹•ä¿®æ­£ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "clock_in_time": "2025-12-04T09:00:00Z",
  "clock_out_time": "2025-12-04T18:00:00Z",
  "edited_reason": "æ‰“åˆ»å¿˜ã‚Œã®ãŸã‚ç®¡ç†è€…ãŒæ‰‹å‹•å…¥åŠ›"
}
```

#### DELETE /api/attendance/records/[id]
å‹¤æ€ è¨˜éŒ²ã‚’å‰Šé™¤ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰ã€‚

### 5. QRã‚³ãƒ¼ãƒ‰ç®¡ç†API

#### GET /api/attendance/qr/office/current
ç¾åœ¨æœ‰åŠ¹ãªä¼šç¤¾QRã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "id": "uuid",
  "qr_data": "ATT:ORG123:TOKEN456:2025-12-10",
  "valid_from": "2025-12-04T00:00:00Z",
  "valid_until": "2025-12-10T23:59:59Z",
  "days_remaining": 6
}
```

#### POST /api/attendance/qr/office/generate
ä¼šç¤¾QRã‚³ãƒ¼ãƒ‰ã‚’æ‰‹å‹•ç”Ÿæˆï¼ˆç®¡ç†è€…ã®ã¿ï¼‰ã€‚

#### GET /api/attendance/qr/site/[site_id]/leader
ãƒªãƒ¼ãƒ€ãƒ¼ç”¨ã®ç¾å ´QRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "id": "uuid",
  "qr_data": "SITE:SITE123:LEADER456:2025-12-04",
  "site_name": "æ±äº¬éƒ½æ¸‹è°·åŒºâ—‹â—‹ãƒ“ãƒ«",
  "generated_date": "2025-12-04",
  "expires_at": "2025-12-04T23:59:59Z"
}
```

#### GET /api/attendance/qr/site/[site_id]/fixed
ç¾å ´å›ºå®šQRã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰ã€‚

#### POST /api/attendance/qr/verify
QRã‚³ãƒ¼ãƒ‰ã®æ¤œè¨¼ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "qr_data": "ATT:ORG123:TOKEN456:2025-12-10"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "valid": true,
  "type": "office" | "site",
  "organization_id": "uuid",
  "site_id": "uuidï¼ˆç¾å ´ã®å ´åˆï¼‰"
}
```

### 6. æœˆæ¬¡é›†è¨ˆAPI

#### GET /api/attendance/monthly-report
æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆã‚’å–å¾—ã€‚

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `year`: å¹´ï¼ˆYYYYï¼‰
- `month`: æœˆï¼ˆ1-12ï¼‰
- `user_id`: ã‚¹ã‚¿ãƒƒãƒ•IDï¼ˆçœç•¥æ™‚ã¯å…¨å“¡ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "year": 2025,
  "month": 12,
  "users": [
    {
      "user_id": "uuid",
      "name": "å±±ç”°å¤ªéƒ",
      "department": "ç¬¬ä¸€å–¶æ¥­éƒ¨",
      "work_days": 20,
      "absent_days": 2,
      "late_count": 1,
      "early_leave_count": 0,
      "total_work_hours": "160:30",
      "average_work_hours": "08:02",
      "overtime_hours": "10:30"
    }
  ],
  "sites": [
    {
      "site_id": "uuid",
      "site_name": "Aç¾å ´",
      "work_days": 15,
      "total_staff_count": 45,
      "total_work_hours": "360:00",
      "average_staff_per_day": 3
    }
  ]
}
```

#### GET /api/attendance/export/csv
CSVå½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€‚

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `start_date`: é–‹å§‹æ—¥
- `end_date`: çµ‚äº†æ—¥
- `user_ids`: ã‚¹ã‚¿ãƒƒãƒ•IDï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰

### 7. ã‚¢ãƒ©ãƒ¼ãƒˆAPI

#### GET /api/attendance/alerts
ã‚¢ãƒ©ãƒ¼ãƒˆä¸€è¦§ã‚’å–å¾—ã€‚

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `resolved`: true | false | all
- `alert_type`: missing_checkin | missing_checkout | qr_expiring | overtime

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "alerts": [
    {
      "id": "uuid",
      "alert_type": "missing_checkin",
      "target_user": {
        "id": "uuid",
        "name": "å±±ç”°å¤ªéƒ"
      },
      "target_date": "2025-12-04",
      "message": "æœ¬æ—¥ã¾ã å‡ºå‹¤ã—ã¦ã„ã¾ã›ã‚“",
      "is_resolved": false,
      "created_at": "2025-12-04T10:00:00Z"
    }
  ]
}
```

#### PUT /api/attendance/alerts/[id]/resolve
ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è§£æ±ºæ¸ˆã¿ã«ã™ã‚‹ã€‚

### 8. ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆè¡¨ç¤ºAPI

#### GET /api/attendance/terminal/[token]
ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç”¨ã®QRè¡¨ç¤ºç”»é¢ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆèªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã§æ¤œè¨¼ï¼‰ã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "organization_name": "â—‹â—‹å»ºè¨­æ ªå¼ä¼šç¤¾",
  "device_type": "office" | "site",
  "site_name": "Aç¾å ´ï¼ˆç¾å ´ã®å ´åˆï¼‰",
  "current_qr": {
    "qr_data": "...",
    "valid_until": "2025-12-10T23:59:59Z"
  },
  "refresh_interval": 30
}
```

---

## UI/UXè¨­è¨ˆ

### 1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ

æ—¢å­˜ã®åœ¨åº«ã‚µãƒãƒªãƒ¼ã¨åŒã˜ã‚¹ã‚¿ã‚¤ãƒ«ã§è¿½åŠ ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“… æœ¬æ—¥ã®å‡ºé€€å‹¤                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ çŠ¶æ…‹: ğŸŸ¢ å‹¤å‹™ä¸­                     â”‚
â”‚ å‡ºå‹¤: 09:00 (ä¼šç¤¾)                 â”‚
â”‚ é€€å‹¤: --:--                        â”‚
â”‚ å‹¤å‹™æ™‚é–“: 3æ™‚é–“15åˆ†                 â”‚
â”‚ ä¼‘æ†©: é–‹å§‹ã—ã¦ã„ã¾ã›ã‚“              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ğŸ¢ ä¼šç¤¾ã«å‡ºå‹¤]  [ğŸ—ï¸ ç¾å ´ã«ç›´è¡Œ]    â”‚
â”‚          ã¾ãŸã¯                     â”‚
â”‚ [ğŸ“± QRã‚³ãƒ¼ãƒ‰ã§æ‰“åˆ»]                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [â˜• ä¼‘æ†©é–‹å§‹]  [ğŸšª é€€å‹¤ã™ã‚‹]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. å‡ºé€€å‹¤ç®¡ç†ãƒšãƒ¼ã‚¸ï¼ˆ/attendanceï¼‰

#### ã‚¿ãƒ–æ§‹æˆ
- **å‡ºé€€å‹¤ä¸€è¦§** - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤º
- **æœˆæ¬¡é›†è¨ˆ**
- **è¨­å®š**ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰

#### ãƒ„ãƒ¼ãƒ«ãƒãƒ¼
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ğŸ“… 2025/12/01 - 2025/12/31] [ğŸ” ã‚¹ã‚¿ãƒƒãƒ•é¸æŠ]â”‚
â”‚ [ğŸ¢ å‡ºå‹¤å…ˆ: ã™ã¹ã¦ â–¼]  [ğŸ“Š çŠ¶æ…‹: ã™ã¹ã¦ â–¼]   â”‚
â”‚                                              â”‚
â”‚ [+ æ‰‹å‹•è¿½åŠ ] [ğŸ“¥ CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚ æ—¥ä»˜ â”‚ã‚¹ã‚¿ãƒƒãƒ•â”‚å‡ºå‹¤  â”‚é€€å‹¤  â”‚å‹¤å‹™æ™‚é–“â”‚æ“ä½œ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚12/04 â”‚å±±ç”°  â”‚09:00 â”‚18:00 â”‚08:15 â”‚[ç·¨é›†]â”‚
â”‚      â”‚      â”‚ä¼šç¤¾  â”‚ä¼šç¤¾  â”‚      â”‚[å‰Šé™¤]â”‚
â”‚12/04 â”‚ä½è—¤  â”‚08:00 â”‚17:00 â”‚08:00 â”‚[ç·¨é›†]â”‚
â”‚      â”‚      â”‚Aç¾å ´ â”‚ç›´å¸°  â”‚      â”‚[å‰Šé™¤]â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
```

#### ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºï¼ˆãƒ¢ãƒã‚¤ãƒ«ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2025/12/04                     â”‚
â”‚ å±±ç”° å¤ªéƒï¼ˆç¬¬ä¸€å–¶æ¥­éƒ¨ï¼‰          â”‚
â”‚                                â”‚
â”‚ å‡ºå‹¤: 09:00 (ä¼šç¤¾)             â”‚
â”‚ é€€å‹¤: 18:00 (ä¼šç¤¾)             â”‚
â”‚ å‹¤å‹™: 8æ™‚é–“15åˆ†                â”‚
â”‚                                â”‚
â”‚ [ç·¨é›†] [å‰Šé™¤]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. æœˆæ¬¡é›†è¨ˆãƒšãƒ¼ã‚¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2025å¹´12æœˆ å‹¤æ€ é›†è¨ˆ                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ã‚¹ã‚¿ãƒƒãƒ•åˆ¥] [ç¾å ´åˆ¥]                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ å±±ç”° å¤ªéƒ                           â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”          â”‚
â”‚ å‡ºå‹¤æ—¥æ•°:        20æ—¥               â”‚
â”‚ æ¬ å‹¤æ—¥æ•°:        2æ—¥                â”‚
â”‚ é…åˆ»å›æ•°:        1å›                â”‚
â”‚ æ—©é€€å›æ•°:        0å›                â”‚
â”‚ ç·å‹¤å‹™æ™‚é–“:      160æ™‚é–“30åˆ†         â”‚
â”‚ å¹³å‡å‹¤å‹™æ™‚é–“:    8æ™‚é–“2åˆ†            â”‚
â”‚ æ®‹æ¥­æ™‚é–“:        10æ™‚é–“30åˆ†          â”‚
â”‚                                     â”‚
â”‚ [CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. è¨­å®šãƒšãƒ¼ã‚¸ï¼ˆ/attendance/settingsï¼‰

æ—¢å­˜ã®çµ„ç¹”è¨­å®šã¨åŒã˜ãƒ•ã‚©ãƒ¼ãƒ ã‚¹ã‚¿ã‚¤ãƒ«ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‡ºé€€å‹¤ç®¡ç†è¨­å®š                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ â”â”â”â” ä¼šç¤¾å‡ºå‹¤ã®è¨­å®š â”â”â”â”            â”‚
â”‚                                     â”‚
â”‚ â˜‘ ä¼šç¤¾å‡ºå‹¤æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹             â”‚
â”‚                                     â”‚
â”‚ â–  åˆ©ç”¨å¯èƒ½ãªæ‰“åˆ»æ–¹æ³•ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰    â”‚
â”‚ â˜‘ æ‰‹å‹•æ‰“åˆ»                          â”‚
â”‚ â˜‘ QRã‚¹ã‚­ãƒ£ãƒ³                        â”‚
â”‚ â˜ QRå¸¸æ™‚è¡¨ç¤ºï¼ˆã‚¿ãƒ–ãƒ¬ãƒƒãƒˆè¨­ç½®ï¼‰       â”‚
â”‚                                     â”‚
â”‚ â–  QRã‚³ãƒ¼ãƒ‰æ›´æ–°é »åº¦                  â”‚
â”‚ â—‹ æ¯æ—¥  â—‹ 3æ—¥  â— 7æ—¥  â—‹ 30æ—¥      â”‚
â”‚                                     â”‚
â”‚ [è¨­å®šã‚’ä¿å­˜]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. QRè¡¨ç¤ºå°‚ç”¨ãƒšãƒ¼ã‚¸ï¼ˆã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç”¨ï¼‰

#### ä¼šç¤¾ç”¨ (/attendance/office-terminal?token=xxx)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        â—‹â—‹å»ºè¨­æ ªå¼ä¼šç¤¾                â”‚
â”‚      å‡ºé€€å‹¤ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  ğŸ“… å‡ºé€€å‹¤ç”¨QRã‚³ãƒ¼ãƒ‰                 â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚                 â”‚               â”‚
â”‚  â”‚   [å¤§QRã‚³ãƒ¼ãƒ‰]   â”‚               â”‚
â”‚  â”‚                 â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                     â”‚
â”‚  æœ‰åŠ¹æœŸé™: 2025å¹´12æœˆ10æ—¥ 23:59ã¾ã§  â”‚
â”‚                                     â”‚
â”‚  ã“ã®QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦           â”‚
â”‚     å‡ºå‹¤ãƒ»é€€å‹¤ã—ã¦ãã ã•ã„            â”‚
â”‚                                     â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”            â”‚
â”‚  ç¾åœ¨æ™‚åˆ»: 2025/12/04 09:15:32      â”‚
â”‚  [30ç§’ã”ã¨ã«è‡ªå‹•æ›´æ–°]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç¾å ´ç”¨ (/attendance/site-terminal?token=xxx)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Aç¾å ´ å‡ºé€€å‹¤ç«¯æœ«                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¾å ´å: æ±äº¬éƒ½æ¸‹è°·åŒºâ—‹â—‹ãƒ“ãƒ«         â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   [å¤§QRã‚³ãƒ¼ãƒ‰]   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                     â”‚
â”‚  ç¾åœ¨æ™‚åˆ»: 2025/12/04 08:30:15      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6. ãƒªãƒ¼ãƒ€ãƒ¼ç”¨QRç™ºè¡Œç”»é¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ—ï¸ ç¾å ´å‡ºå‹¤ç”¨QRã‚³ãƒ¼ãƒ‰ç™ºè¡Œ           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¾å ´: Aç¾å ´                         â”‚
â”‚  ãƒªãƒ¼ãƒ€ãƒ¼: å±±ç”°å¤ªéƒ                  â”‚
â”‚  æœ‰åŠ¹æœŸé™: æœ¬æ—¥23:59ã¾ã§             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   [QRã‚³ãƒ¼ãƒ‰]     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                     â”‚
â”‚  ã‚¹ã‚¿ãƒƒãƒ•ã«èª­ã¿å–ã£ã¦                â”‚
â”‚  ã‚‚ã‚‰ã£ã¦ãã ã•ã„                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [QRã‚’æ›´æ–°] [é–‰ã˜ã‚‹]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

### Phase 1: åŸºæœ¬æ©Ÿèƒ½ï¼ˆ2-3é€±é–“ï¼‰

#### Week 1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ + è¨­å®š
- [x] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ âœ…
- [x] organization_attendance_settings ãƒ†ãƒ¼ãƒ–ãƒ« âœ…
- [x] attendance_records ãƒ†ãƒ¼ãƒ–ãƒ« âœ…
- [x] office_qr_codes ãƒ†ãƒ¼ãƒ–ãƒ« âœ…
- [x] site_attendance_settings ãƒ†ãƒ¼ãƒ–ãƒ« âœ…
- [x] çµ„ç¹”è¨­å®šAPIå®Ÿè£… âœ…
  - [x] GET /api/attendance/settingsï¼ˆå–å¾—ï¼‰
  - [x] PUT /api/attendance/settingsï¼ˆæ›´æ–°ï¼‰
  - [x] TypeScriptå‹å®šç¾©ï¼ˆtypes/attendance.tsï¼‰
- [x] è¨­å®šç”»é¢UIå®Ÿè£… âœ…
  - [x] /attendance/settings/page.tsxï¼ˆãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰
  - [x] AttendanceSettingsForm.tsxï¼ˆãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰
  - [x] Sidebarã«ã€Œå‡ºé€€å‹¤è¨­å®šã€ãƒªãƒ³ã‚¯è¿½åŠ 

#### Week 2: æ‰“åˆ»æ©Ÿèƒ½
- [x] å‡ºå‹¤æ‰“åˆ»APIï¼ˆæ‰‹å‹•ã®ã¿ï¼‰ âœ…
  - [x] POST /api/attendance/clock-in
  - [x] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆlocation_type, site_id, methodï¼‰
  - [x] æ—¢å­˜è¨˜éŒ²ãƒã‚§ãƒƒã‚¯ï¼ˆ1æ—¥1ãƒ¬ã‚³ãƒ¼ãƒ‰åˆ¶ç´„ï¼‰
  - [x] ç¾å ´IDæ¤œè¨¼
- [x] é€€å‹¤æ‰“åˆ»APIï¼ˆæ‰‹å‹•ã®ã¿ï¼‰ âœ…
  - [x] POST /api/attendance/clock-out
  - [x] å‡ºå‹¤è¨˜éŒ²å­˜åœ¨ãƒã‚§ãƒƒã‚¯
  - [x] å‡ºå‹¤æ™‚åˆ»ã¨ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯
- [x] ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ âœ…
  - [x] AttendanceWidget.tsx ä½œæˆ
  - [x] ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«é…ç½®
  - [x] å‡ºå‹¤/é€€å‹¤ãƒœã‚¿ãƒ³
  - [x] å‹¤å‹™æ™‚é–“è¡¨ç¤º
- [x] æ‰“åˆ»çŠ¶æ…‹ã®å–å¾—API âœ…
  - [x] GET /api/attendance/status
  - [x] ä»Šæ—¥ã®è¨˜éŒ²å–å¾—
  - [x] ç¾å ´åJOIN
- [x] é‡è¤‡æ‰“åˆ»é˜²æ­¢æ©Ÿèƒ½ âœ…
  - [x] 5åˆ†ä»¥å†…ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯
  - [x] åŒæ—¥é‡è¤‡ãƒã‚§ãƒƒã‚¯
- [x] ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å‡¦ç†ï¼ˆJSTçµ±ä¸€ï¼‰ âœ…

#### Week 3: ä¸€è¦§ãƒ»å±¥æ­´
- [x] å‹¤æ€ ä¸€è¦§APIï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ä»˜ãï¼‰ âœ…
  - [x] GET /api/attendance/records
  - [x] ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆuser_id, start_date, end_date, location_type, site_idï¼‰
  - [x] ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆpage, limitï¼‰
  - [x] ã‚½ãƒ¼ãƒˆï¼ˆæ—¥ä»˜é™é †ï¼‰
  - [x] æ¨©é™ãƒã‚§ãƒƒã‚¯ï¼ˆstaffã¯è‡ªåˆ†ã®ã¿ã€admin/managerã¯å…¨å“¡ï¼‰
  - [x] JOINã‚¯ã‚¨ãƒªï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ç¾å ´åï¼‰
- [x] å‹¤æ€ ä¸€è¦§ãƒšãƒ¼ã‚¸ï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ï¼‰ âœ…
  - [x] /attendance/records/page.tsx
  - [x] AttendanceRecordsTable.tsx
  - [x] ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ UIï¼ˆã‚¹ã‚¿ãƒƒãƒ•ã€æ—¥ä»˜ç¯„å›²ã€å ´æ‰€ã€ç¾å ´ï¼‰
  - [x] å‹¤å‹™æ™‚é–“è¨ˆç®—ãƒ»è¡¨ç¤º
  - [x] ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ UI
- [x] å‹¤æ€ ä¸€è¦§ãƒšãƒ¼ã‚¸ï¼ˆãƒ¢ãƒã‚¤ãƒ«ï¼‰ âœ…
  - [x] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œãƒ†ãƒ¼ãƒ–ãƒ«
- [x] è‡ªåˆ†ã®å±¥æ­´ãƒšãƒ¼ã‚¸ï¼ˆã‚¹ã‚¿ãƒƒãƒ•ç”¨ï¼‰ âœ…
  - [x] /attendance/my-records/page.tsx
  - [x] MyAttendanceRecordsTable.tsx
  - [x] æœˆæ¬¡é›†è¨ˆè¡¨ç¤ºï¼ˆå‡ºå‹¤æ—¥æ•°ã€ç·å‹¤å‹™æ™‚é–“ã€å¹³å‡æ™‚é–“ï¼‰
  - [x] æ—¥ä»˜ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
  - [x] ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
- [x] ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ  âœ…
  - [x] å‹¤æ€ å±¥æ­´ï¼ˆå…¨å“¡ï¼‰
  - [x] å‹¤æ€ ä¸€è¦§ï¼ˆadmin/managerï¼‰
- [x] ä¼‘æ†©æ™‚é–“ç®¡ç†ï¼ˆsimple/detailed/noneï¼‰ âœ…
  - [x] POST /api/attendance/break/start
  - [x] POST /api/attendance/break/end
  - [x] AttendanceWidgetã«ä¼‘æ†©ãƒœã‚¿ãƒ³è¿½åŠ 
  - [x] break_time_modeã«å¿œã˜ãŸåˆ¶é™ï¼ˆnone/simple/detailedï¼‰
- [x] æ‰‹å‹•ä¿®æ­£æ©Ÿèƒ½ï¼ˆç®¡ç†è€…ç”¨ï¼‰ âœ…
  - [x] PATCH /api/attendance/records/[id]
  - [x] DELETE /api/attendance/records/[id]
  - [x] ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«UIï¼ˆEditAttendanceModal.tsxï¼‰
  - [x] å‹¤æ€ ä¸€è¦§ãƒšãƒ¼ã‚¸ã«ç·¨é›†ãƒœã‚¿ãƒ³è¿½åŠ 
  - [x] ç·¨é›†ç†ç”±ã®è¨˜éŒ²

### Phase 2: QRæ©Ÿèƒ½ï¼ˆ2é€±é–“ï¼‰

#### Week 4: ä¼šç¤¾QR
- [x] ä¼šç¤¾QRã‚³ãƒ¼ãƒ‰è‡ªå‹•ç”Ÿæˆæ©Ÿèƒ½ âœ…
  - [x] POST /api/attendance/qr/office/generateï¼ˆæ‰‹å‹•ç”Ÿæˆï¼‰
  - [x] GET /api/attendance/qr/office/currentï¼ˆè‡ªå‹•ç”Ÿæˆå«ã‚€ï¼‰
  - [x] QRãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: ATT:org_id:token:valid_until
  - [x] æœ‰åŠ¹æœŸé™ç®¡ç†ï¼ˆ1/3/7/30æ—¥ï¼‰
- [x] QRã‚³ãƒ¼ãƒ‰æ¤œè¨¼æ©Ÿèƒ½ âœ…
  - [x] POST /api/attendance/qr/verify
  - [x] ä¼šç¤¾QRæ¤œè¨¼ï¼ˆæœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚¯ï¼‰
  - [x] ç¾å ´QRæ¤œè¨¼ï¼ˆãƒªãƒ¼ãƒ€ãƒ¼ç™ºè¡Œãƒ»å›ºå®šï¼‰
  - [x] çµ„ç¹”IDãƒã‚§ãƒƒã‚¯
- [x] QRã‚¹ã‚­ãƒ£ãƒ³æ‰“åˆ»API âœ…
  - [x] clock-in APIã«QRæ¤œè¨¼çµ±åˆ
  - [x] clock-out APIã«QRæ¤œè¨¼çµ±åˆ
  - [x] location_typeè‡ªå‹•åˆ¤å®š
- [x] QRè¡¨ç¤ºå°‚ç”¨ãƒšãƒ¼ã‚¸ï¼ˆä¼šç¤¾ãƒ»ç¾å ´å…±é€šï¼‰ âœ…
  - [x] GET /api/attendance/terminal/[token]ï¼ˆãƒ‡ãƒ¼ã‚¿å–å¾—APIï¼‰
  - [x] /attendance/terminal/[token]ï¼ˆè¡¨ç¤ºãƒšãƒ¼ã‚¸ï¼‰
  - [x] TerminalDisplay.tsxï¼ˆQRã‚³ãƒ¼ãƒ‰è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰
  - [x] qrcodeãƒ©ã‚¤ãƒ–ãƒ©ãƒªçµ±åˆ
  - [x] 30ç§’ã”ã¨è‡ªå‹•æ›´æ–°
  - [x] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ™‚è¨ˆè¡¨ç¤º
- [x] ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç«¯æœ«ç®¡ç†æ©Ÿèƒ½ âœ…
  - [x] GET /api/attendance/terminalsï¼ˆä¸€è¦§å–å¾—ï¼‰
  - [x] POST /api/attendance/terminalsï¼ˆç«¯æœ«ç™»éŒ²ï¼‰
  - [x] PATCH /api/attendance/terminals/[id]ï¼ˆæ›´æ–°ï¼‰
  - [x] DELETE /api/attendance/terminals/[id]ï¼ˆå‰Šé™¤ï¼‰
  - [x] ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆï¼ˆcryptoï¼‰
- [ ] QRã‚³ãƒ¼ãƒ‰å®šæœŸæ›´æ–°ã‚¸ãƒ§ãƒ–ï¼ˆå°†æ¥å®Ÿè£…ï¼‰

#### Week 5: ç¾å ´QR
- [ ] ãƒªãƒ¼ãƒ€ãƒ¼ç”¨QRç™ºè¡ŒAPI
- [ ] ãƒªãƒ¼ãƒ€ãƒ¼ç”¨QRç™ºè¡Œç”»é¢
- [ ] å›ºå®šQRç”Ÿæˆæ©Ÿèƒ½ï¼ˆç®¡ç†è€…ç”¨ï¼‰
- [ ] QRè¡¨ç¤ºå°‚ç”¨ãƒšãƒ¼ã‚¸ï¼ˆç¾å ´ç”¨ï¼‰
- [ ] ç¾å ´ã”ã¨ã®è¨­å®šç®¡ç†
- [ ] QRç®¡ç†ç”»é¢

### Phase 3: é€šçŸ¥ãƒ»ãƒ¬ãƒãƒ¼ãƒˆï¼ˆ1-2é€±é–“ï¼‰

#### Week 6: ã‚¢ãƒ©ãƒ¼ãƒˆ
- [ ] ã‚¢ãƒ©ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- [ ] å‡ºå‹¤å¿˜ã‚Œé€šçŸ¥ï¼ˆ10:00å®šæœŸå®Ÿè¡Œï¼‰
- [ ] é€€å‹¤å¿˜ã‚Œé€šçŸ¥ï¼ˆ20:00å®šæœŸå®Ÿè¡Œï¼‰
- [ ] ç®¡ç†è€…å‘ã‘æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ
- [ ] QRæœŸé™åˆ‡ã‚Œé€šçŸ¥
- [ ] é•·æ™‚é–“åŠ´åƒã‚¢ãƒ©ãƒ¼ãƒˆ
- [ ] ãƒ¡ãƒ¼ãƒ«é€šçŸ¥æ©Ÿèƒ½

#### Week 7: é›†è¨ˆãƒ»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- [ ] æœˆæ¬¡é›†è¨ˆAPI
- [ ] æœˆæ¬¡é›†è¨ˆãƒšãƒ¼ã‚¸ï¼ˆã‚¹ã‚¿ãƒƒãƒ•åˆ¥ï¼‰
- [ ] æœˆæ¬¡é›†è¨ˆãƒšãƒ¼ã‚¸ï¼ˆç¾å ´åˆ¥ï¼‰
- [ ] CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
- [ ] å‹¤å‹™æ™‚é–“è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
- [ ] æ®‹æ¥­æ™‚é–“è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯

### Phase 4: æ‹¡å¼µæ©Ÿèƒ½ï¼ˆå°†æ¥ï¼‰

- [ ] é¡”èªè¨¼æ‰“åˆ»ï¼ˆã‚¿ãƒ–ãƒ¬ãƒƒãƒˆè¨­ç½®ä¼æ¥­å‘ã‘ï¼‰
- [ ] GPSä½ç½®æƒ…å ±è¨˜éŒ²ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- [ ] ã‚·ãƒ•ãƒˆç®¡ç†ã¨ã®é€£æº
- [ ] çµ¦ä¸è¨ˆç®—ã‚·ã‚¹ãƒ†ãƒ é€£æº
- [ ] ä½œæ¥­å ±å‘Šæ›¸ã¨ã®é€£æº

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶

### 1. QRã‚³ãƒ¼ãƒ‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

#### ä¼šç¤¾QRã‚³ãƒ¼ãƒ‰
- å®šæœŸçš„ã«è‡ªå‹•æ›´æ–°ï¼ˆ1æ—¥/3æ—¥/7æ—¥/30æ—¥ï¼‰
- QRãƒ‡ãƒ¼ã‚¿ã«æœ‰åŠ¹æœŸé™ã‚’å«ã‚ã‚‹
- æœŸé™åˆ‡ã‚ŒQRã¯ä½¿ç”¨ä¸å¯
- æš—å·åŒ–ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨

#### ç¾å ´QRã‚³ãƒ¼ãƒ‰ï¼ˆãƒªãƒ¼ãƒ€ãƒ¼ç™ºè¡Œå‹ï¼‰
- æ¯æ—¥0æ™‚ã«è‡ªå‹•ç”Ÿæˆ
- å½“æ—¥é™å®šã§æœ‰åŠ¹
- ãƒªãƒ¼ãƒ€ãƒ¼IDã‚’å«ã‚ã¦ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ç¢ºä¿

#### ç¾å ´QRã‚³ãƒ¼ãƒ‰ï¼ˆå›ºå®šå‹ï¼‰
- é•·æœŸæœ‰åŠ¹ã ãŒçµ„ç¹”IDã¨ç¾å ´IDã§æ¤œè¨¼
- ç®¡ç†è€…ã®ã¿ç”Ÿæˆå¯èƒ½
- ç„¡åŠ¹åŒ–æ©Ÿèƒ½ã‚ã‚Š

### 2. ä¸æ­£æ‰“åˆ»ã®é˜²æ­¢

- åŒã˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ5åˆ†ä»¥å†…ã«è¤‡æ•°å›æ‰“åˆ»ã§ããªã„ã‚ˆã†ã«ã™ã‚‹
- QRã‚³ãƒ¼ãƒ‰ã¯çµ„ç¹”IDã¨ç´ä»˜ã‘ã¦æ¤œè¨¼
- ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç«¯æœ«ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†
- æ‰“åˆ»æ™‚ã®ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±ã‚’è¨˜éŒ²
- ç•°å¸¸ãªæ‰“åˆ»ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ­ã‚°è¨˜éŒ²

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼

- RLSãƒãƒªã‚·ãƒ¼ã§çµ„ç¹”é–“ã®ãƒ‡ãƒ¼ã‚¿éš”é›¢
- ã‚¹ã‚¿ãƒƒãƒ•ã¯è‡ªåˆ†ã®å‹¤æ€ ã®ã¿é–²è¦§å¯èƒ½
- ç®¡ç†è€…/ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¯çµ„ç¹”å†…å…¨å“¡ã‚’é–²è¦§å¯èƒ½
- æ‰‹å‹•ä¿®æ­£ã®å±¥æ­´ã‚’è¨˜éŒ²ï¼ˆèª°ãŒãƒ»ã„ã¤ãƒ»ãªãœï¼‰

### 4. èªè¨¼ãƒ»èªå¯

- Supabase Authã«ã‚ˆã‚‹èªè¨¼
- ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆRBACï¼‰
- ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç”¨ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ç®¡ç†
- APIå‘¼ã³å‡ºã—æ™‚ã®æ¨©é™ãƒã‚§ãƒƒã‚¯

---

## ãƒ†ã‚¹ãƒˆè¨ˆç”»

### 1. å˜ä½“ãƒ†ã‚¹ãƒˆ

#### APIå±¤
- [ ] å‡ºå‹¤æ‰“åˆ»APIï¼ˆæ­£å¸¸ç³»ãƒ»ç•°å¸¸ç³»ï¼‰
- [ ] é€€å‹¤æ‰“åˆ»APIï¼ˆæ­£å¸¸ç³»ãƒ»ç•°å¸¸ç³»ï¼‰
- [ ] QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ»æ¤œè¨¼
- [ ] å‹¤æ€ è¨˜éŒ²ã®å–å¾—ãƒ»æ›´æ–°ãƒ»å‰Šé™¤
- [ ] æœˆæ¬¡é›†è¨ˆã®è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯

#### ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
- [ ] é‡è¤‡æ‰“åˆ»ã®é˜²æ­¢
- [ ] ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¤‰æ›
- [ ] å‹¤å‹™æ™‚é–“ã®è¨ˆç®—
- [ ] ä¼‘æ†©æ™‚é–“ã®è‡ªå‹•æ§é™¤
- [ ] ã‚¢ãƒ©ãƒ¼ãƒˆæ¡ä»¶ã®åˆ¤å®š

### 2. çµ±åˆãƒ†ã‚¹ãƒˆ

- [ ] å‡ºå‹¤â†’ä¼‘æ†©â†’é€€å‹¤ã®ä¸€é€£ã®æµã‚Œ
- [ ] QRã‚¹ã‚­ãƒ£ãƒ³ã«ã‚ˆã‚‹æ‰“åˆ»
- [ ] æ‰‹å‹•ä¿®æ­£ã«ã‚ˆã‚‹æ›´æ–°
- [ ] æœˆæ¬¡é›†è¨ˆãƒ‡ãƒ¼ã‚¿ã®æ­£ç¢ºæ€§
- [ ] CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

### 3. E2Eãƒ†ã‚¹ãƒˆ

#### ã‚¹ã‚¿ãƒƒãƒ•æ“ä½œ
- [ ] ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰æ‰‹å‹•å‡ºå‹¤
- [ ] QRã‚¹ã‚­ãƒ£ãƒ³ã§å‡ºå‹¤
- [ ] ä¼‘æ†©é–‹å§‹ãƒ»çµ‚äº†
- [ ] é€€å‹¤æ‰“åˆ»
- [ ] è‡ªåˆ†ã®å±¥æ­´é–²è¦§

#### ç®¡ç†è€…æ“ä½œ
- [ ] è¨­å®šå¤‰æ›´
- [ ] å‹¤æ€ ä¸€è¦§é–²è¦§
- [ ] æ‰‹å‹•ä¿®æ­£
- [ ] æœˆæ¬¡é›†è¨ˆé–²è¦§
- [ ] CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

#### ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ
- [ ] QRè¡¨ç¤ºç”»é¢ã®è¡¨ç¤º
- [ ] è‡ªå‹•æ›´æ–°æ©Ÿèƒ½
- [ ] ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®æŒ™å‹•

### 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

- [ ] 100äººåŒæ™‚æ‰“åˆ»
- [ ] 1ä¸‡ä»¶ã®å‹¤æ€ ãƒ‡ãƒ¼ã‚¿æ¤œç´¢
- [ ] æœˆæ¬¡é›†è¨ˆã®å®Ÿè¡Œé€Ÿåº¦
- [ ] QRã‚³ãƒ¼ãƒ‰æ¤œè¨¼ã®é€Ÿåº¦

### 5. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ

- [ ] RLSãƒãƒªã‚·ãƒ¼ã®ãƒã‚¤ãƒ‘ã‚¹ãƒ†ã‚¹ãƒˆ
- [ ] æœŸé™åˆ‡ã‚ŒQRã®ä½¿ç”¨ãƒ†ã‚¹ãƒˆ
- [ ] ä»–çµ„ç¹”ã®ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆ
- [ ] æ¨©é™æ˜‡æ ¼ã®è©¦è¡Œ

---

## ä»˜éŒ²

### A. QRãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

#### ä¼šç¤¾QRã‚³ãƒ¼ãƒ‰
```
ATT:${organization_id}:${random_token}:${valid_until}
ä¾‹: ATT:org-123:abc789xyz:2025-12-10T23:59:59Z
```

#### ãƒªãƒ¼ãƒ€ãƒ¼ç™ºè¡Œç¾å ´QRã‚³ãƒ¼ãƒ‰
```
SITE:${site_id}:${leader_id}:${date}
ä¾‹: SITE:site-456:user-789:2025-12-04
```

#### å›ºå®šç¾å ´QRã‚³ãƒ¼ãƒ‰
```
SITE_FIXED:${site_id}:${secret_hash}
ä¾‹: SITE_FIXED:site-456:def456uvw
```

### B. å‹¤å‹™æ™‚é–“è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯

```typescript
function calculateWorkHours(record: AttendanceRecord): {
  work_hours: number;      // ç·å‹¤å‹™æ™‚é–“ï¼ˆåˆ†ï¼‰
  break_minutes: number;   // ä¼‘æ†©æ™‚é–“ï¼ˆåˆ†ï¼‰
  actual_work_hours: number; // å®ŸåŠ´åƒæ™‚é–“ï¼ˆåˆ†ï¼‰
} {
  if (!record.clock_out_time) {
    return { work_hours: 0, break_minutes: 0, actual_work_hours: 0 };
  }

  // ç·å‹¤å‹™æ™‚é–“
  const work_hours = differenceInMinutes(
    new Date(record.clock_out_time),
    new Date(record.clock_in_time)
  );

  // ä¼‘æ†©æ™‚é–“
  let break_minutes = record.auto_break_deducted_minutes || 0;

  if (record.break_records && Array.isArray(record.break_records)) {
    for (const br of record.break_records) {
      if (br.start && br.end) {
        break_minutes += differenceInMinutes(
          new Date(br.end),
          new Date(br.start)
        );
      }
    }
  }

  // å®ŸåŠ´åƒæ™‚é–“
  const actual_work_hours = work_hours - break_minutes;

  return { work_hours, break_minutes, actual_work_hours };
}
```

### C. ã‚¢ãƒ©ãƒ¼ãƒˆå®Ÿè¡Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| ã‚¢ãƒ©ãƒ¼ãƒˆ | å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚° | å®Ÿè£…æ–¹æ³• |
|---------|--------------|----------|
| å‡ºå‹¤å¿˜ã‚Œï¼ˆæœ¬äººï¼‰ | æ¯æ—¥10:00 | Supabase Edge Function + Cron |
| é€€å‹¤å¿˜ã‚Œï¼ˆæœ¬äººï¼‰ | æ¯æ—¥20:00 | Supabase Edge Function + Cron |
| ç®¡ç†è€…æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ | æ¯æ—¥10:00 | Supabase Edge Function + Cron |
| QRæœŸé™åˆ‡ã‚Œ | QRæ›´æ–°ã®24æ™‚é–“å‰ | Supabase Edge Function + Cron |
| é•·æ™‚é–“åŠ´åƒ | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ  | APIå‘¼ã³å‡ºã—æ™‚ã«ãƒã‚§ãƒƒã‚¯ |

### D. æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹

| æ©Ÿèƒ½ | admin | manager | leader | staff |
|------|-------|---------|--------|-------|
| è‡ªåˆ†ã®å‡ºé€€å‹¤æ‰“åˆ» | âœ“ | âœ“ | âœ“ | âœ“ |
| è‡ªåˆ†ã®å±¥æ­´é–²è¦§ | âœ“ | âœ“ | âœ“ | âœ“ |
| å…¨å“¡ã®å±¥æ­´é–²è¦§ | âœ“ | âœ“ | âœ— | âœ— |
| æ‰‹å‹•ä¿®æ­£ï¼ˆå…¨å“¡ï¼‰ | âœ“ | âœ“ | âœ— | âœ— |
| æ‰‹å‹•è¿½åŠ  | âœ“ | âœ“ | âœ— | âœ— |
| æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆé–²è¦§ | âœ“ | âœ“ | âœ— | âœ— |
| CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ | âœ“ | âœ“ | âœ— | âœ— |
| è¨­å®šå¤‰æ›´ | âœ“ | âœ— | âœ— | âœ— |
| ä¼šç¤¾QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ | âœ“ | âœ“ | âœ— | âœ— |
| ç¾å ´QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆãƒªãƒ¼ãƒ€ãƒ¼ï¼‰ | âœ“ | âœ“ | âœ“ | âœ— |
| ç¾å ´QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆå›ºå®šï¼‰ | âœ“ | âœ“ | âœ— | âœ— |

---

**ä½œæˆæ—¥**: 2025-12-04
**æœ€çµ‚æ›´æ–°**: 2025-12-04
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
