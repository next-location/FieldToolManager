# 見積書提出・承認マニュアル

**最終更新日**: 2026-01-21
**対象**: Leader（提出）、Manager/Admin（承認）

---

## 目次

1. [承認フローの概要](#承認フローの概要)
2. [見積書の提出（Leader）](#見積書の提出leader)
3. [見積書の承認（Manager/Admin）](#見積書の承認manageradmin)
4. [見積書の差し戻し（Manager/Admin）](#見積書の差し戻しmanageradmin)
5. [顧客への送付（Manager/Admin/Leader）](#顧客への送付manageradminleader)
6. [顧客の判断記録（Manager/Admin）](#顧客の判断記録manageradmin)
7. [承認の取り消し（Manager/Admin）](#承認の取り消しmanageradmin)
8. [ステータス一覧と操作権限](#ステータス一覧と操作権限)

---

## 承認フローの概要

ザイロクの見積書は、作成から顧客承認まで以下のフローで管理されます。

### ステータスフロー

```
【通常フロー】
下書き → 提出済み → 顧客送付済 → 顧客承認
  ↓         ↓                         ↓
編集可能  承認待ち                 受注確定
          ↓
       差し戻し（下書きに戻る）

【却下の場合】
顧客送付済 → 顧客却下（終了）

【期限切れ】
すべてのステータス → 期限切れ（自動）
```

### 役割と権限

| 役割 | 作成 | 提出 | 承認 | 差し戻し | 顧客送付 | 顧客判断記録 |
|------|------|------|------|---------|----------|-------------|
| **Staff** | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ |
| **Leader** | ✅ | ✅ | ❌ | ❌ | ✅※ | ❌ |
| **Manager** | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **Admin** | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |

※ Leader は自分が作成した見積書のみ送付可能

---

## 見積書の提出（Leader）

Leaderが作成した見積書を、Manager/Adminに提出して承認を依頼します。

### 提出の流れ

**ステップ1: 見積書を作成**

1. 「見積管理 > 新規見積書」をクリック
2. 見積書の基本情報を入力
   - 見積番号（自動生成）
   - 顧客
   - プロジェクト（任意）
   - 件名
   - 見積日
   - 有効期限
3. 明細を追加
4. **「下書き保存」**をクリック

**ステップ2: 見積書を提出**

1. 見積書一覧から、提出したい見積書をクリック
2. 見積書詳細画面を開く
3. 右上の**「編集」**ボタンをクリック
4. 内容を最終確認
5. 画面下部の**「提出する」**ボタン（青色）をクリック

**提出完了**:
```
✓ 見積書を提出しました
ステータス: 提出済み（オレンジ色）
```

### 提出後の状態

**見積書のステータス**: 「提出済み」（オレンジ色）

**表示内容**:
```
見積書詳細
[提出済み] ← オレンジ色のバッジ

※この見積書は提出済みです。
承認されるまでお待ちください。
```

**注意事項**:
- ✅ 提出後は**編集できません**
- ✅ Manager/Adminが承認またはそ差し戻しを行います
- ✅ 差し戻された場合は、再度編集して提出できます

### 提出時の確認ポイント

提出前に以下を確認してください：

**基本情報**:
- ✅ 顧客名が正しいか
- ✅ 件名が適切か
- ✅ 見積日が正しいか
- ✅ 有効期限が適切か（通常30日）

**明細**:
- ✅ 品目名・数量・単価が正しいか
- ✅ 金額が正しいか（自動計算）
- ✅ 税率が正しいか（通常10%）

**合計金額**:
- ✅ 小計・消費税・合計が正しいか

---

## 見積書の承認（Manager/Admin）

Manager/Adminは、Leaderが提出した見積書を承認します。

### 承認の流れ

**ステップ1: 提出済み見積書を確認**

1. 「見積管理」を開く
2. **未読の提出済み見積書**が赤い通知バッジで表示される
   ```
   [提出済み] 見積書#EST-20260121-0001 🔴 未読
   ```
3. 見積書をクリックして詳細画面を開く

**自動既読**:
- Manager/Adminが見積書詳細画面を開くと、自動的に**既読**になります
- 赤い通知バッジが消えます

**ステップ2: 見積書の内容を確認**

以下の内容を確認します：

**基本情報の確認**:
- 顧客名・件名・見積日・有効期限

**明細の確認**:
- 品目名・数量・単価・金額
- 単価が適正か
- 数量が適切か

**合計金額の確認**:
- 小計・消費税・合計
- 予算内か
- 利益率は適切か

**ステップ3: 承認する**

1. 画面右上の**「承認する」**ボタン（緑色）をクリック
2. 承認モーダルが開く
3. **承認メモ**を入力（任意）
   ```
   承認メモ（任意）
   ┌────────────────────┐
   │ 金額・内容とも問題なし│
   │ 承認します           │
   └────────────────────┘
   ```
4. **「承認する」**ボタンをクリック

**承認完了**:
```
✓ 見積書を承認しました
ステータス: 提出済み（承認済み）
```

**承認後の表示**:
```
見積書詳細
[提出済み] ← オレンジ色（変わらない）

✓ 承認済み ← 緑色の承認情報
承認者: 山田太郎
承認日時: 2026-01-21 14:30:00
メモ: 金額・内容とも問題なし。承認します
```

### 承認後の状態

**できること**:
- ✅ **「送付済みにする」**ボタンが表示される
- ✅ **PDF出力**が可能になる
- ✅ **承認取り消し**が可能（Manager/Admin のみ）

**できないこと**:
- ❌ 編集（承認後は編集不可）
- ❌ 削除（承認済みは削除不可）

---

## 見積書の差し戻し（Manager/Admin）

Manager/Adminは、内容に問題がある見積書を差し戻して修正を依頼できます。

### 差し戻しの流れ

**ステップ1: 見積書を確認**

1. 「見積管理」を開く
2. 提出済み見積書をクリック
3. 見積書詳細画面で内容を確認

**ステップ2: 差し戻す**

1. 画面右上の**「差し戻し」**ボタン（オレンジ色）をクリック
2. 差し戻しモーダルが開く
3. **差し戻し理由を入力**（必須）
   ```
   差し戻し理由（必須）
   ┌────────────────────────┐
   │ 単価が高すぎます。      │
   │ 再見積もりをお願いします│
   └────────────────────────┘
   ```
4. **「差し戻す」**ボタンをクリック

**差し戻し完了**:
```
✓ 見積書を差し戻しました
ステータス: 下書き（差し戻し理由付き）
```

### 差し戻し後の状態

**見積書のステータス**: 「下書き」（灰色）

**Leaderの画面表示**:
```
見積書詳細
[下書き]

⚠ 差し戻されました
差し戻し理由:
単価が高すぎます。再見積もりをお願いします

差し戻し日時: 2026-01-21 14:35:00
差し戻し者: 山田太郎（Manager）
```

**Leaderの対応**:
1. 差し戻し理由を確認
2. **「編集」**ボタンで見積書を修正
3. 修正後、再度**「提出する」**をクリック

### 差し戻しの理由例

**よくある差し戻し理由**:

1. **金額の問題**
   - 「単価が高すぎます。○○円以下に調整してください」
   - 「合計金額が予算オーバーです。見直してください」

2. **明細の問題**
   - 「明細に不要な項目が含まれています。削除してください」
   - 「数量が多すぎます。再確認してください」

3. **内容の問題**
   - 「件名が不明確です。より具体的に記載してください」
   - 「顧客名が間違っています。修正してください」

4. **有効期限の問題**
   - 「有効期限が短すぎます。60日に延長してください」

**差し戻し理由は具体的に**:
- ❌ 悪い例: 「修正してください」
- ✅ 良い例: 「品目Aの単価を5,000円から4,500円に変更してください」

---

## 顧客への送付（Manager/Admin/Leader）

承認済みの見積書を顧客に送付したことを記録します。

### 送付の流れ

**ステップ1: 顧客に見積書を送付**

実際に顧客へ見積書を送付します（システム外の操作）：

**送付方法（例）**:
- メール添付（PDFをダウンロードして送信）
- 郵送（印刷して郵送）
- FAX
- 手渡し

**ステップ2: システムで送付済みに変更**

1. 見積書詳細画面を開く
2. **「送付済みにする」**ボタン（青色）をクリック
3. 確認ダイアログが表示される
   ```
   見積書を顧客に送付しましたか？

   このボタンは、実際に顧客へ見積書を送付した後に、
   ステータスを「顧客送付済」に変更するためのものです。

   ※このボタンを押してもメール送信等は行われません。

   [OK] [キャンセル]
   ```
4. **「OK」**をクリック

**送付済み完了**:
```
✓ ステータスを「顧客送付済」に変更しました
ステータス: 顧客送付済（青色）
```

### 送付済み後の状態

**見積書のステータス**: 「顧客送付済」（青色）

**できること**:
- ✅ PDF出力
- ✅ **顧客承認**ボタン（顧客が承認した場合）
- ✅ **顧客却下**ボタン（顧客が却下した場合）

**できないこと**:
- ❌ 編集
- ❌ 削除

### 送付時の注意事項

**重要**:
- ⚠️ **必ず承認済みの見積書を送付してください**
- ⚠️ **実際に送付した後**にボタンを押してください
- ⚠️ このボタンを押しても、自動でメール送信されません

**Leader権限の制限**:
- Leader は**自分が作成した見積書のみ**送付可能
- 他のLeaderが作成した見積書は送付できません

---

## 顧客の判断記録（Manager/Admin）

顧客が見積書を承認または却下したことを記録します。

### 顧客承認の記録

**ステップ1: 顧客から承認の連絡を受ける**

顧客から以下のような連絡があった場合：
- 「見積書の内容で進めてください」
- 「承認します」
- 「この金額で発注します」

**ステップ2: システムで顧客承認を記録**

1. 見積書詳細画面を開く
2. **「顧客承認」**ボタン（青色）をクリック
3. 確認ダイアログが表示される
   ```
   顧客が見積書を承認したことを記録しますか？

   [OK] [キャンセル]
   ```
4. **「OK」**をクリック

**顧客承認完了**:
```
✓ 顧客承認を記録しました
ステータス: 顧客承認（緑色）
```

### 顧客却下の記録

**ステップ1: 顧客から却下の連絡を受ける**

顧客から以下のような連絡があった場合：
- 「見積もりをお断りします」
- 「金額が合わないので見送ります」
- 「他社に依頼します」

**ステップ2: システムで顧客却下を記録**

1. 見積書詳細画面を開く
2. **「顧客却下」**ボタン（赤色）をクリック
3. 確認ダイアログが表示される
   ```
   顧客が見積書を却下したことを記録しますか？

   [OK] [キャンセル]
   ```
4. **「OK」**をクリック

**顧客却下完了**:
```
✓ 顧客却下を記録しました
ステータス: 顧客却下（赤色）
```

### 顧客判断後の状態

**顧客承認の場合**:
- ステータス: 「顧客承認」（緑色）
- 受注確定
- 請求書作成が可能

**顧客却下の場合**:
- ステータス: 「顧客却下」（赤色）
- 案件終了
- 編集・削除不可

---

## 承認の取り消し（Manager/Admin）

Manager/Adminは、承認済みの見積書の承認を取り消すことができます。

### 承認取り消しの流れ

**取り消しが必要な場合**:
- 承認後に重大な誤りを発見した
- 顧客に送付する前に修正が必要になった
- 承認を誤って実行した

**ステップ1: 見積書詳細画面を開く**

1. 「見積管理」を開く
2. 承認済みの見積書をクリック

**ステップ2: 承認を取り消す**

1. 画面右上の**「承認取り消し」**ボタン（灰色）をクリック
2. 確認ダイアログが表示される
   ```
   承認を取り消しますか？

   [OK] [キャンセル]
   ```
3. **「OK」**をクリック

**承認取り消し完了**:
```
✓ 承認を取り消しました
ステータス: 提出済み（未承認）
```

### 承認取り消し後の状態

**見積書のステータス**: 「提出済み」（未承認）

**できること**:
- ✅ 再度承認
- ✅ 差し戻し

**できないこと**:
- ❌ 編集（下書きに戻さないと編集不可）
- ❌ 顧客送付（承認が必要）

**注意事項**:
- ⚠️ 承認取り消し後、**「差し戻し」**で下書きに戻せば編集可能になります
- ⚠️ 顧客送付済み（sent）の見積書は承認取り消しできません

---

## ステータス一覧と操作権限

### ステータス一覧

| ステータス | 色 | 意味 | 次のアクション |
|-----------|-----|------|---------------|
| **下書き** | 灰色 | 作成中・差し戻し後 | 編集、提出、削除 |
| **提出済み** | オレンジ色 | 承認待ち | 承認、差し戻し |
| **提出済み（承認済み）** | オレンジ色（✓付き） | 承認済み・送付待ち | 顧客送付、承認取り消し |
| **顧客送付済** | 青色 | 顧客に送付済み・判断待ち | 顧客承認、顧客却下 |
| **顧客承認** | 緑色 | 受注確定 | 請求書作成 |
| **顧客却下** | 赤色 | 失注 | なし（終了） |
| **期限切れ** | 黄色 | 有効期限切れ | なし（編集・承認不可） |

### ステータス別の操作可能な権限

#### 下書き

| 操作 | Staff | Leader | Manager | Admin |
|------|-------|--------|---------|-------|
| 編集 | ✅※ | ✅※ | ✅※ | ✅ |
| 提出 | ❌ | ✅※ | ✅※ | ✅ |
| 削除 | ❌ | ✅※ | ✅※ | ✅ |

※ 自分が作成した見積書のみ

#### 提出済み（未承認）

| 操作 | Staff | Leader | Manager | Admin |
|------|-------|--------|---------|-------|
| 閲覧 | ✅ | ✅ | ✅ | ✅ |
| 承認 | ❌ | ❌ | ✅ | ✅ |
| 差し戻し | ❌ | ❌ | ✅ | ✅ |

#### 提出済み（承認済み）

| 操作 | Staff | Leader | Manager | Admin |
|------|-------|--------|---------|-------|
| 閲覧 | ✅ | ✅ | ✅ | ✅ |
| PDF出力 | ❌ | ❌ | ✅ | ✅ |
| 顧客送付 | ❌ | ✅※ | ✅ | ✅ |
| 承認取り消し | ❌ | ❌ | ✅ | ✅ |

※ 自分が作成した見積書のみ

#### 顧客送付済

| 操作 | Staff | Leader | Manager | Admin |
|------|-------|--------|---------|-------|
| 閲覧 | ✅ | ✅ | ✅ | ✅ |
| PDF出力 | ❌ | ❌ | ✅ | ✅ |
| 顧客承認記録 | ❌ | ❌ | ✅ | ✅ |
| 顧客却下記録 | ❌ | ❌ | ✅ | ✅ |

#### 顧客承認 / 顧客却下 / 期限切れ

| 操作 | Staff | Leader | Manager | Admin |
|------|-------|--------|---------|-------|
| 閲覧 | ✅ | ✅ | ✅ | ✅ |
| PDF出力 | ❌ | ❌ | ✅ | ✅ |
| その他の操作 | ❌ | ❌ | ❌ | ❌ |

### 期限切れについて

**自動的に期限切れになる条件**:
- 有効期限を過ぎた見積書
- すべてのステータスが対象

**期限切れ後の制限**:
- ❌ 編集不可
- ❌ 承認不可
- ❌ 差し戻し不可
- ❌ 顧客送付不可
- ✅ 閲覧のみ可能

**対応方法**:
- 新しい見積書を作成し直す
- または、有効期限を延長した見積書を複製して作成

---

## 関連マニュアル

- [見積書作成マニュアル](./estimates_create.md) - 見積書の新規作成方法
- [請求書作成マニュアル](./invoices_create.md) - 見積書から請求書への変換
- [顧客管理マニュアル](./clients.md) - 顧客の登録と管理
- [プロジェクト管理マニュアル](./projects.md)（将来追加予定） - プロジェクトの登録と管理

---

**承認フローを適切に運用して、見積書管理をスムーズに行いましょう！**
