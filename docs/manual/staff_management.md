# スタッフ管理マニュアル

**最終更新日**: 2026-01-21
**対象**: 管理者、マネージャー

---

## 目次

1. [概要](#概要)
2. [スタッフ一覧の確認](#スタッフ一覧の確認)
3. [新規スタッフの追加](#新規スタッフの追加)
4. [スタッフ情報の編集](#スタッフ情報の編集)
5. [アカウントの有効化・無効化](#アカウントの有効化無効化)
6. [パスワードリセット](#パスワードリセット)
7. [スタッフの削除](#スタッフの削除)
8. [CSV一括登録](#csv一括登録)
9. [検索・フィルター機能](#検索フィルター機能)
10. [権限マトリックスの確認](#権限マトリックスの確認)
11. [変更履歴の確認](#変更履歴の確認)

---

## 概要

スタッフ管理機能では、組織内のスタッフ（従業員）のアカウントを一元管理できます。スタッフの追加、編集、削除、権限設定など、ライフサイクル全体を管理します。

**主な用途**
- 新入社員のアカウント登録
- 異動や昇進に伴う権限変更
- 退職者のアカウント無効化
- 部署ごとのスタッフ管理

**アクセス権限**
- **管理者（admin）**: すべての操作が可能
- **マネージャー（manager）**: 管理者・スーパー管理者以外のスタッフを操作可能
- **リーダー（leader）**: 閲覧のみ
- **スタッフ（staff）**: 閲覧のみ

**プラン別の人数上限**
- **スタート**: 10人まで
- **スタンダード**: 30人まで
- **ビジネス**: 100人まで
- **プロ/エンタープライズ**: 契約時に個別設定

---

## スタッフ一覧の確認

### 一覧画面へのアクセス

サイドメニューから「スタッフ管理」をクリックすると、スタッフ一覧画面が表示されます。

### 表示内容

一覧画面では、各スタッフについて以下の情報が表示されます。

**PC版表示**
- 名前
- メールアドレス
- 役割（スタッフ/リーダー/マネージャー/管理者）
- 部署
- 社員番号
- 電話番号
- ステータス（有効/無効）
- 最終ログイン日時

**モバイル版表示**
- 名前
- 役割バッジ
- メールアドレス
- 部署
- ステータス

### プラン使用状況

画面上部に現在のスタッフ数とプラン上限が表示されます。

```
スタッフ: 8/10人 (スタートプラン)
[進捗バー表示]
```

- 80%以上で黄色表示
- 100%到達で赤色表示
- 上限到達時は「+ スタッフを追加」ボタンが無効化されます

---

## 新規スタッフの追加

### 追加手順

1. スタッフ一覧画面の右上にある「+ スタッフを追加」ボタンをクリック（PCのみ表示）
2. モバイルの場合は、画面右下のFABボタン（+アイコン）をタップ
3. スタッフ登録フォームが表示されます

### 入力項目

| 項目 | 必須 | 説明 |
|------|------|------|
| 名前 | ✅ | スタッフのフルネーム（最大50文字） |
| メールアドレス | ✅ | ログイン用のメールアドレス（最大100文字、一意） |
| 初期パスワード | ✅ | 初回ログイン時のパスワード（最大100文字） |
| 役割 | ✅ | スタッフ / リーダー / マネージャー / 管理者 から選択 |
| 部署 | - | 所属部署名（最大50文字） |
| 社員番号 | - | 組織内の社員番号（最大20文字） |
| 電話番号 | - | 連絡先電話番号 |

### 役割について

| 役割 | 説明 |
|------|------|
| スタッフ | 一般ユーザー。道具の移動や作業報告書の作成が可能 |
| リーダー | 現場責任者。作業報告書の承認などが可能 |
| マネージャー | 管理職。見積書・請求書・発注書の承認などが可能 |
| 管理者 | システム管理者。すべての設定と管理機能にアクセス可能 |

詳細な権限の違いは[権限マトリックス](#権限マトリックスの確認)をご確認ください。

### 初期パスワードの生成

「自動生成」ボタンをクリックすると、セキュアなランダムパスワードが自動生成されます。

**自動生成されるパスワードの特徴**
- 12文字
- 大文字、小文字、数字、記号を含む
- パスワードポリシーを満たす

**重要**: 生成されたパスワードは必ずメモして、スタッフに安全な方法で伝えてください。

### 部署の入力

部署フィールドにはオートコンプリート（入力補助）機能があります。既存の部署名が候補として表示されます。

### 登録の完了

すべての必須項目を入力後、「追加」ボタンをクリックするとスタッフが登録され、一覧画面に戻ります。

---

## スタッフ情報の編集

### 編集手順

1. スタッフ一覧から編集したいスタッフの行にある「...」メニューボタンをクリック
2. 「編集」を選択
3. 編集フォームが表示されます
4. 変更したい項目を修正
5. 「保存」ボタンをクリック

### 編集可能な項目

- 名前
- メールアドレス
- 役割
- 部署
- 社員番号
- 電話番号

**注意事項**
- パスワードは編集できません。パスワード変更は「パスワードリセット」機能を使用してください
- 部署や役割の変更は変更履歴に記録されます
- 自分自身の管理者権限は削除できません（最低1人の管理者が必要）

### 権限による制限

**管理者の場合**
- すべてのスタッフを編集可能

**マネージャーの場合**
- 管理者とスーパー管理者以外のスタッフを編集可能
- 自分より上位の権限を持つスタッフは編集不可

---

## アカウントの有効化・無効化

### 無効化の目的

- 退職者のアカウントを無効化（ログイン不可にする）
- 休職者の一時的なアクセス停止
- 不正アクセスが疑われるアカウントの緊急停止

### 無効化手順

1. スタッフ一覧から対象スタッフの「...」メニューボタンをクリック
2. 「無効化」を選択
3. 確認ダイアログで「はい」をクリック

### 有効化手順

1. ステータスフィルターで「無効」を選択して無効化されたスタッフを表示
2. 対象スタッフの「...」メニューボタンをクリック
3. 「有効化」を選択
4. 確認ダイアログで「はい」をクリック

### 無効化の影響

**できなくなること**
- ログインができなくなる
- すべての機能へのアクセスが不可

**影響しないこと**
- 過去の移動履歴や作業報告書などのデータは保持される
- 他のスタッフからスタッフ一覧での閲覧は可能（ステータスは「無効」と表示）

**重要**: 無効化しても、過去にそのスタッフが行った操作の履歴（道具移動、作業報告書作成など）は削除されません。

---

## パスワードリセット

### リセット手順

1. スタッフ一覧から対象スタッフの「...」メニューボタンをクリック
2. 「パスワードリセット」を選択
3. 確認ダイアログで「はい」をクリック
4. リセットトークンが発行され、スタッフのメールアドレスに送信されます

### リセットトークンの有効期限

- 発行から24時間
- 期限が切れた場合は、再度リセット操作を行ってください

### リセット後の流れ

1. スタッフがメールで受信したリンクをクリック
2. 新しいパスワードを設定
3. 新しいパスワードでログイン可能になります

---

## スタッフの削除

### 削除手順

1. スタッフ一覧から削除したいスタッフの「...」メニューボタンをクリック
2. 「削除」を選択
3. 削除確認ダイアログで「削除する」をクリック

### 削除の注意事項

**論理削除について**
- スタッフは物理的には削除されず、「論理削除」されます
- `deleted_at`フィールドに削除日時が記録されます
- 一覧画面には表示されなくなりますが、データベースには残ります

**理由**
- 過去の移動履歴や作業報告書などで参照されているため
- データの整合性を保つため
- 監査ログとしての記録保持のため

**削除できないケース**
- 自分自身のアカウント
- 組織内の最後の管理者

**削除後の影響**
- スタッフ数のカウントから除外されます
- ログインができなくなります
- 過去の履歴データは保持されます

---

## CSV一括登録

複数のスタッフをまとめて登録できる機能です。

### 一括登録手順

1. スタッフ一覧画面の右上にある「...」メニューボタンをクリック
2. 「CSV一括登録」を選択
3. 「テンプレートをダウンロード」をクリックしてCSVテンプレートを取得
4. テンプレートに従ってスタッフ情報を入力
5. 「ファイルを選択」で入力済みのCSVファイルを選択
6. 「プレビュー」をクリックしてデータを確認
7. 問題がなければ「インポート」をクリック

### CSVフォーマット

**必須カラム**
- `name`: 名前
- `email`: メールアドレス
- `password`: 初期パスワード
- `role`: 役割（staff / leader / manager / admin）

**オプションカラム**
- `department`: 部署
- `employee_id`: 社員番号
- `phone`: 電話番号

### CSVテンプレート例

```csv
name,email,password,role,department,employee_id,phone
山田太郎,yamada@example.com,password123,staff,工事部,E001,090-1234-5678
佐藤花子,sato@example.com,password123,leader,営業部,E002,080-2345-6789
```

### 注意事項

- CSVファイルはUTF-8エンコーディングで保存してください
- メールアドレスは一意である必要があります（重複不可）
- プラン上限を超える場合、超過分は登録されません
- バリデーションエラーがある場合、エラー内容が表示されます

### インポート結果

インポート完了後、以下の情報が表示されます。

```
インポート完了
成功: 8人
失敗: 2人

エラー詳細:
- 行3: メールアドレスが重複しています
- 行5: パスワードが要件を満たしていません
```

---

## 検索・フィルター機能

### キーワード検索

画面上部の検索ボックスに、名前・メールアドレス・部署・社員番号で検索できます。

**検索例**
- 「山田」で検索 → 山田太郎、山田花子などが該当
- 「工事部」で検索 → 部署が「工事部」のスタッフが該当

### フィルター機能

#### PC版

検索ボックスの右側にあるフィルターボタンをクリックすると、以下のフィルターが利用できます。

| フィルター項目 | 選択肢 |
|---------------|--------|
| 部署 | すべて / 既存の部署名 |
| 役割 | すべて / スタッフ / リーダー / マネージャー / 管理者 |
| ステータス | すべて / 有効 / 無効 |

#### モバイル版

画面上部のフィルターアイコンをタップすると、フィルターモーダルが開きます。

### フィルタークリア

「クリア」ボタンをクリックすると、すべてのフィルター条件がリセットされます。

---

## 権限マトリックスの確認

各役割でできることを一覧で確認できます。

### 確認方法

1. スタッフ一覧画面の右上にある「...」メニューボタンをクリック
2. 「権限マトリックス」を選択
3. 権限マトリックスモーダルが表示されます

### マトリックス内容

権限マトリックスには以下の情報が表示されます。

| 機能カテゴリ | スタッフ | リーダー | マネージャー | 管理者 |
|-------------|---------|---------|-------------|--------|
| 道具管理 | ✅ | ✅ | ✅ | ✅ |
| 作業報告書作成 | ✅ | ✅ | ✅ | ✅ |
| 作業報告書承認 | - | ✅ | ✅ | ✅ |
| 見積書作成 | - | ✅ | ✅ | ✅ |
| 見積書承認 | - | - | ✅ | ✅ |
| 請求書作成 | - | ✅ | ✅ | ✅ |
| 請求書承認 | - | - | ✅ | ✅ |
| 発注書作成 | - | ✅ | ✅ | ✅ |
| 発注書承認 | - | - | ✅ | ✅ |
| スタッフ管理 | - | - | 一部 | ✅ |
| 運用設定 | - | - | - | ✅ |

**注**: マネージャーのスタッフ管理権限は、管理者・スーパー管理者以外のスタッフに限定されます。

---

## 変更履歴の確認

スタッフの変更履歴（部署異動、権限変更など）を確認できます。

### 確認方法

1. スタッフ一覧から対象スタッフの「...」メニューボタンをクリック
2. 「履歴」を選択
3. 変更履歴モーダルが表示されます

### 記録される変更内容

- 部署変更
- 役割変更
- アカウント有効化/無効化
- パスワードリセット
- スタッフ情報の編集

### 履歴表示内容

各履歴エントリには以下の情報が表示されます。

- 変更日時
- 変更内容（変更前→変更後）
- 変更実行者
- 変更理由（入力されている場合）

---

## FAQ・トラブルシューティング

よくある質問やトラブルシューティングについては、[スタッフ管理のよくある質問（Q&A）](../qa/admin/staff_management_issues.md)をご覧ください。
