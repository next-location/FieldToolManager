# 作業報告書管理

## 概要

作業報告書機能は、現場での作業内容を記録・報告するための機能です。
日々の作業内容、使用した資材・道具、作業者、写真などを記録し、承認フローを経て正式な報告書として管理できます。

**主な機能**:
- 作業内容の詳細記録（日付、天候、作業時間、内容）
- 作業写真の添付（作業前・作業中・作業後・問題点・その他）
- 作業者の記録（作成者＋同行者）
- 進捗率、使用資材・道具の記録
- 承認フロー（下書き→提出→承認/却下）
- PDF出力

---

## 対象者

### 作成・編集
- **スタッフ（Staff）**: 自分が作成した報告書のみ作成・編集
- **リーダー（Leader）**: 自分が作成した報告書のみ作成・編集
- **マネージャー（Manager）**: 自分が作成した報告書のみ作成・編集
- **管理者（Admin）**: 自分が作成した報告書のみ作成・編集

### 承認
- **リーダー（Leader）**: 提出された報告書を承認・却下できる
- **管理者（Admin）**: 提出された報告書を承認・却下できる

※ マネージャーは承認権限がありません。

---

## 前提条件

作業報告書を作成する前に、以下のマスタデータが登録されている必要があります。

1. **現場マスタ**: 報告対象の現場が登録されている
2. **スタッフマスタ**: 作業者として選択するスタッフが登録されている

---

## 作業報告書の作成

### 基本的な作成手順

1. サイドメニューから **作業報告書** をクリック
2. 右上の **+ 新規作成** ボタンをクリック
3. 必須項目と任意項目を入力
4. **下書き保存** または **提出** をクリック

### 入力項目の詳細

#### 必須項目

| 項目 | 説明 |
|------|------|
| **現場** | 報告対象の現場を選択 |
| **報告日** | 作業を行った日付 |
| **天候** | 晴れ、曇り、雨、雪から選択 |
| **作業内容** | 具体的な作業内容を記述（テキストエリア） |

#### 任意項目

| 項目 | 説明 |
|------|------|
| **作業開始時刻** | 作業を開始した時刻 |
| **作業終了時刻** | 作業を終了した時刻 |
| **休憩時間（分）** | 休憩時間を分単位で入力 |
| **作業場所** | 現場内の具体的な作業場所 |
| **進捗率（%）** | 0〜100%で入力 |
| **使用資材** | 使用した資材の記録 |
| **使用道具** | 使用した道具の記録 |
| **同行者** | 一緒に作業したスタッフを複数選択 |
| **残業時間（時間）** | 残業時間を時間単位で入力 |

#### 写真添付

複数枚の写真を添付できます。各写真には以下の分類を設定できます：

- **作業前**: 作業開始前の状態
- **作業中**: 作業中の様子
- **作業後**: 作業完了後の状態
- **問題点**: 問題が発生した箇所
- **その他**: 上記以外の写真

**写真添付手順**:
1. **写真を追加** ボタンをクリック
2. 画像ファイルを選択（複数選択可）
3. 各写真の分類を選択
4. 必要に応じてキャプション（説明文）を入力

#### カスタム項目

組織の設定により、独自の入力項目が追加されている場合があります。
カスタム項目は管理者が設定で追加したものです。

---

## 下書き保存と提出

### 下書き保存

作成途中の報告書を保存する場合は **下書き保存** をクリックします。

**下書き状態の特徴**:
- いつでも編集・削除が可能
- 承認者には表示されない
- 一覧画面でステータス「下書き」として表示

### 提出

報告書を完成させて提出する場合は **提出** をクリックします。

**提出時の注意**:
- 必須項目が未入力の場合、提出できません
- 提出後は編集できません（却下された場合のみ再編集可能）
- 提出すると承認者に通知が届きます

---

## 作業報告書の閲覧

### 一覧画面

作業報告書一覧では、以下の情報が表示されます：

- 報告日
- 現場名
- 作成者
- ステータス（下書き/提出済み/承認済み/却下）

**フィルタリング**:
- 現場で絞り込み
- ステータスで絞り込み
- 日付範囲で絞り込み
- 作成者で絞り込み

### 詳細画面

作業報告書をクリックすると、詳細画面が開きます。

**表示内容**:
- 基本情報（現場、日付、天候、作業時間）
- 作業内容
- 作業場所、進捗率、使用資材・道具
- 作業者情報（作成者＋同行者）
- 添付写真（分類別に表示）
- 承認履歴（提出日時、承認/却下日時、コメント）

---

## 承認フロー

### 承認者の操作（リーダー・管理者）

提出された作業報告書は、リーダーまたは管理者の権限を持つユーザーが承認または却下できます。

#### 承認手順

1. 作業報告書一覧から「提出済み」の報告書を開く
2. 内容を確認
3. 画面下部の **承認** ボタンをクリック
4. 必要に応じてコメントを入力
5. **確定** をクリック

#### 却下手順

1. 作業報告書一覧から「提出済み」の報告書を開く
2. 内容を確認
3. 画面下部の **却下** ボタンをクリック
4. 却下理由を入力（必須）
5. **確定** をクリック

**却下された場合**:
- 報告書のステータスが「却下」に変更
- 作成者に通知が届く
- 作成者は報告書を再編集して再提出できる

---

## PDF出力

承認済みの作業報告書は、PDF形式でダウンロードできます。

### PDF出力手順

1. 作業報告書の詳細画面を開く
2. 右上の **PDF出力** ボタンをクリック
3. PDFファイルがダウンロードされる

**PDF出力内容**:
- 組織情報（会社名、住所、電話番号）
- 現場情報
- 報告日、天候
- 作業時間、休憩時間
- 作業内容
- 作業場所、進捗率
- 使用資材・道具
- 作業者情報
- 添付写真（各写真の分類とキャプション付き）
- 承認情報（承認日時、承認者）

---

## トラブルシューティング

### 提出ボタンが押せない場合

必須項目が未入力の可能性があります。以下を確認してください：

1. **現場** が選択されているか
2. **報告日** が入力されているか
3. **天候** が選択されているか
4. **作業内容** が入力されているか

フォーム内に赤字でエラーメッセージが表示されている項目がないか確認してください。

### 写真がアップロードできない場合

以下を確認してください：

1. **ファイル形式**: JPEG、PNG、GIF形式に対応
2. **ファイルサイズ**: 1枚あたり最大10MB
3. **インターネット接続**: アップロードにはインターネット接続が必要

大きなファイルサイズの写真の場合、アップロードに時間がかかることがあります。
アップロード中は画面を閉じずにお待ちください。

### 下書きが見つからない場合

一覧画面のフィルタで「下書き」のみを表示する設定になっているか確認してください。

1. 作業報告書一覧を開く
2. **ステータス** フィルタで「下書き」を選択
3. 対象の報告書を探す

### PDF出力ボタンが表示されない場合

PDF出力は承認済みの報告書のみ可能です。
報告書のステータスが「承認済み」になっているか確認してください。

---

## 関連機能

- [現場管理](./sites.md)
- [スタッフ管理](./staff_management.md)
- [設定](./settings.md)

---

**作業報告書機能で、現場の作業内容を正確に記録・共有しましょう！**
