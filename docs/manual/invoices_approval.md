# 請求書提出・承認マニュアル

## 📋 概要

請求書提出・承認機能では、作成された請求書をリーダーが提出し、マネージャー以上が承認するワークフローを実現します。承認・差し戻しの履歴が記録され、適切な承認プロセスを管理できます。

## 👥 対象者と権限

| 役割 | 提出 | 承認 | 差し戻し |
|------|------|------|---------|
| スタッフ | × | × | × |
| リーダー | ○ | × | × |
| マネージャー | ○ | ○ | ○ |
| 管理者 | ○ | ○ | ○ |

## 📍 アクセス方法

1. 左メニューから「請求書」をクリック
2. 対象の請求書をクリック
3. 詳細画面でアクションボタンを使用

## 🔄 請求書のステータスフロー

```
下書き ─提出→ 提出済み ─承認→ 承認済み
  ↑                ↓
  └────差し戻し─────┘
```

### ステータスの説明

| ステータス | 説明 | 編集可否 | 次のアクション |
|-----------|------|---------|---------------|
| 下書き | 作成中または差し戻し後 | ○ 可能 | 提出 |
| 提出済み | リーダーが提出済み | × 不可 | 承認または差し戻し |
| 承認済み | マネージャーが承認済み | × 不可 | なし（確定） |

## 📤 請求書の提出（リーダー）

### 1️⃣ 提出の流れ

1. 請求書一覧から「下書き」ステータスの請求書を選択
2. 詳細画面で内容を確認
3. 「提出」ボタンをクリック
4. 確認メッセージが表示される
   - 「この請求書を提出してもよろしいですか？」
   - 「提出後は編集できなくなります。」
5. 「OK」をクリック
6. ステータスが「提出済み」に変更される

### 2️⃣ 提出前の確認事項

- **取引先**: 正しい取引先が選択されているか
- **請求日・支払期日**: 日付が正しいか
- **明細**: 数量・単価・金額が正確か
- **合計金額**: 請求金額が妥当か
- **備考**: 必要な情報が記載されているか

### 3️⃣ 提出後の注意

- 提出後は編集できません
- 修正が必要な場合は、マネージャーに差し戻しを依頼してください

## ✅ 請求書の承認（マネージャー以上）

### 1️⃣ 承認の流れ

1. 請求書一覧から「提出済み」ステータスの請求書を選択
2. 詳細画面で内容を確認
3. 「承認」ボタンをクリック
4. 承認モーダルが表示される
5. **承認コメント（任意）** を入力
   - 例: 内容を確認しました。承認します。
   - 例: 問題ありません。
6. 「承認する」ボタンをクリック
7. 確認メッセージ「この請求書を承認しますか？」が表示される
8. 「OK」をクリック
9. ステータスが「承認済み」に変更される

### 2️⃣ 承認時の確認事項

#### 基本情報の確認

- **取引先**: 正しい顧客に請求しているか
- **請求日・支払期日**: 日付が適切か
- **件名**: 内容を適切に表しているか
- **工事**: 正しい工事に紐づいているか

#### 明細の確認

- **種別**: 適切な種別が選択されているか
- **項目名**: 分かりやすく記載されているか
- **数量・単価**: 見積書や契約内容と一致しているか
- **金額**: 計算が正しいか
- **税率**: 適切な税率が適用されているか

#### 金額の確認

- **小計**: 明細の合計が正しいか
- **消費税**: 税額が適切に計算されているか
- **合計**: 最終的な請求金額が妥当か

#### その他の確認

- **備考**: 必要な情報が記載されているか
- **社内メモ**: 特記事項がないか

### 3️⃣ 承認コメント

承認コメントは任意ですが、以下のような場合に記載すると有効です：

| 場面 | コメント例 |
|------|-----------|
| 通常の承認 | 内容を確認しました。承認します。 |
| 金額が大きい場合 | 金額を確認しました。問題ありません。 |
| 特別な条件がある場合 | 特別割引を確認しました。承認します。 |
| 早急な処理が必要 | 至急対応が必要なため承認します。 |

承認コメントは履歴として記録され、後から確認できます。

### 4️⃣ 承認後の処理

承認後は以下の処理が可能になります：

- 請求書PDFの発行
- 取引先への送付
- 入金記録
- 請求書のエクスポート

## ↩️ 請求書の差し戻し（マネージャー以上）

### 1️⃣ 差し戻しの流れ

1. 請求書一覧から「提出済み」ステータスの請求書を選択
2. 詳細画面で内容を確認
3. 「差し戻し」ボタンをクリック
4. 差し戻しモーダルが表示される
5. **差し戻し理由（必須）** を入力
   - 例: 明細の数量に誤りがあります。10個→20個に修正してください。
   - 例: 取引先が間違っています。A社→B社に変更してください。
6. 「差し戻す」ボタンをクリック
7. 確認メッセージ「この請求書を差し戻しますか？」が表示される
8. 「OK」をクリック
9. ステータスが「下書き」に戻る
10. リーダーに通知が送られる（システム通知）

### 2️⃣ 差し戻し理由の書き方

差し戻し理由は**必須**です。リーダーが修正内容を理解できるように、具体的に記載してください。

#### ❌ 悪い例（不明確）

- 内容に誤りがあります。
- 修正してください。
- 確認してください。

#### ✅ 良い例（具体的）

- 明細1の数量が誤っています。10個→20個に修正してください。
- 取引先が間違っています。A社ではなくB社に請求してください。
- 支払期日が契約書と異なります。2月末→3月末に変更してください。
- 明細2の単価が見積書と一致しません。50,000円→45,000円に修正してください。

**ポイント**:
- 何が間違っているか
- どう修正すべきか
- 理由や根拠（契約書、見積書など）

### 3️⃣ 差し戻し後の処理

差し戻し後は以下の処理が行われます：

1. ステータスが「下書き」に戻る
2. リーダーが再編集可能になる
3. リーダーに通知が送られる
4. 差し戻し理由が履歴として記録される
5. リーダーは修正後、再度提出できる

### 4️⃣ 差し戻しの注意事項

- **差し戻し理由は必須**: 空白では差し戻しできません
- **具体的に記載**: リーダーが理解できるように詳細に書く
- **履歴に残る**: 差し戻し理由は履歴として永続的に記録されます

## 📊 承認履歴の確認

### 承認履歴タイムライン

請求書詳細画面では、承認履歴をタイムライン形式で確認できます：

```
【2026年1月21日 15:30】リーダー A が提出
↓
【2026年1月21日 16:00】マネージャー B が差し戻し
理由: 明細の数量に誤りがあります。10個→20個に修正してください。
↓
【2026年1月21日 16:30】リーダー A が再提出
↓
【2026年1月21日 17:00】マネージャー B が承認
コメント: 修正内容を確認しました。承認します。
```

履歴には以下の情報が記録されます：

- 操作日時
- 操作者
- 操作内容（提出、承認、差し戻し）
- コメント・理由

## 🔐 権限別の操作一覧

### リーダー

| 操作 | 条件 | 結果 |
|------|------|------|
| 提出 | ステータスが「下書き」 | 「提出済み」に変更 |
| 編集 | ステータスが「下書き」 | 内容を修正可能 |
| 削除 | ステータスが「下書き」 | 削除可能 |

**できないこと**:
- 承認
- 差し戻し
- 提出済み・承認済みの編集

### マネージャー・管理者

| 操作 | 条件 | 結果 |
|------|------|------|
| 提出 | ステータスが「下書き」 | 「提出済み」に変更 |
| 承認 | ステータスが「提出済み」 | 「承認済み」に変更 |
| 差し戻し | ステータスが「提出済み」 | 「下書き」に戻す |
| 編集 | ステータスが「下書き」 | 内容を修正可能 |
| 削除 | ステータスが「下書き」または「提出済み」 | 削除可能 |

**できないこと**:
- 承認済みの編集
- 承認済みの削除（システム管理者のみ可能）

## ⚠️ 注意事項

### 提出について

- **提出後は編集不可**: 提出前に必ず内容を確認してください
- **提出＝承認依頼**: マネージャーに承認を依頼する意味です
- **未読バッジ**: マネージャーに未読バッジが表示されます

### 承認について

- **承認＝確定**: 承認後は編集・削除できません
- **承認コメント**: 任意ですが、記録として残すことを推奨
- **慎重に確認**: 金額や明細を十分に確認してから承認してください

### 差し戻しについて

- **理由は必須**: 具体的な修正内容を記載してください
- **履歴に残る**: 差し戻し理由は永続的に記録されます
- **再提出可能**: 差し戻し後、リーダーが修正して再提出できます

### 承認済み後の変更

承認済みの請求書は原則として編集・削除できません。修正が必要な場合は以下の対応をしてください：

| 場面 | 対応方法 |
|------|---------|
| 金額の誤り | 修正請求書を新規作成 |
| 取引先の誤り | 管理者に相談（システム管理者が対応） |
| キャンセル | 管理者に相談（削除フラグで対応） |

## 🔗 関連機能

- [請求書作成マニュアル](invoices_create.md)
- [請求書入金記録マニュアル](invoices_payment.md)（次に作成予定）
- [取引先マスタマニュアル](clients.md)
- [工事管理マニュアル](projects.md)

---

**最終更新**: 2026-01-21
