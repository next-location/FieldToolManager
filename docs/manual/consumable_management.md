# 消耗品登録（在庫調整）マニュアル

## 1. 概要

消耗品（ボルト、ネジ、ケーブルなど）の登録と在庫調整を行う機能です。消耗品マスタを登録後、数量の追加・減少・設定ができます。

**主な機能**:
- 消耗品マスタの新規登録（名称、型番、メーカー、単位、最小在庫など）
- 初期在庫の設定（登録時に数量を入力可能）
- 在庫調整（追加・減らす・設定の3種類）
- 権限別の調整制限（一般スタッフ・リーダーは±100個まで）
- 調整理由の記録（監査証跡として保存）

---

## 2. 対象者

| 権限レベル | 消耗品登録 | 在庫調整（±100個まで） | 在庫調整（制限なし※） |
|------------|------------|------------------------|----------------------|
| 一般スタッフ | ❌ | ✅ | ❌ |
| リーダー | ❌ | ✅ | ❌ |
| マネージャー | ✅ | ✅ | ✅ |
| 管理者 | ✅ | ✅ | ✅ |

※ マネージャー・管理者でも±50,000個までの制限があります。

---

## 3. アクセス方法

### 3-1. 消耗品登録ページへのアクセス

1. 左サイドメニューから **「在庫」** をクリック
2. 上部の **「消耗品を登録」** ボタンをクリック
3. 消耗品登録フォームが表示されます

**URL**: `/consumables/new`

### 3-2. 在庫調整ページへのアクセス

1. 左サイドメニューから **「在庫」** をクリック
2. 消耗品一覧から対象の消耗品を探す
3. 右側の **「在庫調整」** ボタンをクリック
4. 在庫調整フォームが表示されます

**URL**: `/consumables/[id]/adjust`

---

## 4. 消耗品登録の詳細手順

### 4-1. 基本情報の入力

| 項目 | 必須 | 説明 | 例 |
|------|------|------|-----|
| **消耗品名** | ✅ | 消耗品の名称 | M8ボルト、LANケーブル |
| **型番** | - | メーカー型番（任意） | BT-M8-20、CAT6-100 |
| **メーカー** | - | 製造元（任意） | トラスコ中山、サンワサプライ |
| **単位** | ✅ | 数量の単位 | 個、本、枚、箱、袋、巻、セット、ケース |
| **最小在庫数** | ✅ | 在庫アラートの閾値（デフォルト: 10） | 10、50、100 |
| **初期在庫数** | - | 登録時の初期数量（任意） | 100、500 |
| **備考** | - | 自由記述欄 | 保管場所、注意事項など |

### 4-2. 単位の選択肢

登録時に以下の単位から選択できます：

- **個** （デフォルト）
- **本** （ケーブル、パイプなど）
- **枚** （板材、シートなど）
- **箱** （箱単位で管理）
- **袋** （袋単位で管理）
- **巻** （テープ、ロープなど）
- **セット** （組み合わせ品）
- **ケース** （ケース単位で管理）

### 4-3. 初期在庫の設定

- **初期在庫数を入力した場合**: 登録と同時に「本社倉庫」に在庫が作成されます
- **初期在庫数を空欄にした場合**: マスタのみ登録され、在庫は0のままです（後から在庫調整で追加可能）

### 4-4. 登録の実行

1. 必須項目（消耗品名、単位、最小在庫数）を入力
2. 任意項目（型番、メーカー、初期在庫数、備考）を必要に応じて入力
3. **「登録」** ボタンをクリック
4. 成功メッセージが表示され、在庫一覧ページにリダイレクトされます

---

## 5. 在庫調整の詳細手順

### 5-1. 調整方法の選択

在庫調整には **3つの調整タイプ** があります：

| 調整タイプ | 説明 | 使用例 |
|------------|------|--------|
| **追加** | 現在の在庫に数量を加算 | 新規購入、倉庫から補充 |
| **減らす** | 現在の在庫から数量を減算 | 使用、廃棄 |
| **設定** | 在庫数を指定した値に直接設定 | 実地棚卸後の修正 |

### 5-2. 調整数量の入力

#### 一般スタッフ・リーダーの場合
- **制限**: ±100個まで
- 「設定」タイプの場合、現在数との差分が100以内である必要があります
- 例: 現在100個 → 「設定」で150個にする場合、差分50なので可能

#### マネージャー・管理者の場合
- **制限**: ±50,000個まで
- より大きな調整が可能ですが、上限は設定されています

### 5-3. 調整理由の入力（必須）

在庫調整には **理由の記入が必須** です。これは監査証跡として記録されます。

**理由の例**:
- 「新規購入 50個」
- 「A現場で使用 20個」
- 「破損品を廃棄 5個」
- 「実地棚卸による修正」
- 「倉庫から現場へ移動 100個」

### 5-4. 単価の入力（任意）

追加調整の場合、**単価（円）** を入力できます。これは原価管理に使用されます。

- 例: 単価100円、数量50個 → 合計5,000円

### 5-5. 調整の実行

1. 調整タイプ（追加/減らす/設定）を選択
2. 数量を入力（権限に応じた制限内）
3. 調整理由を入力（必須）
4. 追加の場合、必要に応じて単価を入力
5. **「調整を実行」** ボタンをクリック
6. 確認ダイアログで **「OK」** をクリック
7. 成功メッセージが表示され、在庫詳細ページにリダイレクトされます

---

## 6. 在庫アラート機能

### 6-1. 最小在庫数とは

最小在庫数（minimum_stock）は、在庫が少なくなったときにアラートを表示するための閾値です。

- 登録時のデフォルト値: **10**
- 在庫数が最小在庫数を下回ると、一覧画面で **赤色のアラート** が表示されます

### 6-2. 最小在庫数の設定例

| 消耗品 | 推奨最小在庫数 | 理由 |
|--------|----------------|------|
| よく使うボルト | 100 | 頻繁に使用するため多めに確保 |
| 特殊なケーブル | 10 | 使用頻度が低いため最小限 |
| 安全帯用部品 | 50 | 安全に関わるため余裕を持たせる |

---

## 7. 在庫調整の制限一覧

| 権限レベル | 調整制限 | 制限理由 |
|------------|----------|----------|
| 一般スタッフ | ±100個まで | 誤操作防止、日常的な使用範囲 |
| リーダー | ±100個まで | 誤操作防止、日常的な使用範囲 |
| マネージャー | ±50,000個まで | 大規模な入出庫にも対応 |
| 管理者 | ±50,000個まで | 大規模な入出庫にも対応 |

**制限を超えた場合のエラーメッセージ**:
- 一般スタッフ・リーダー: 「一般スタッフ・リーダーは±100個までの調整に制限されています」
- マネージャー・管理者: 「±50,000個以内で入力してください」

---

## 8. 在庫履歴の確認

すべての在庫調整は **在庫履歴（inventory_adjustments）** として記録されます。

記録される情報:
- 調整日時
- 調整者
- 調整タイプ（追加/減らす/設定）
- 調整前の数量
- 調整後の数量
- 調整理由
- 単価（追加の場合）

---

## 9. 注意事項とベストプラクティス

### 9-1. 注意事項

1. **在庫調整は取り消せません**: 誤って調整した場合、逆方向の調整で修正してください
2. **理由は必ず具体的に記入**: 監査証跡として重要です（「修正」だけでなく「実地棚卸で10個不足していたため修正」など）
3. **権限に応じた制限**: 大きな調整が必要な場合、マネージャー・管理者に依頼してください
4. **マイナス在庫は作れません**: 「減らす」で現在数を超える数量を入力してもマイナスにはなりません（0になります）

### 9-2. ベストプラクティス

1. **定期的な実地棚卸**: 月1回など定期的に実在庫を確認し、「設定」で修正
2. **理由の統一**: 組織内で理由の記載ルールを統一すると履歴が見やすくなります
   - 例: 「購入」「使用」「移動」「廃棄」「棚卸修正」など
3. **最小在庫数の見直し**: 使用頻度に応じて最小在庫数を定期的に見直しましょう
4. **単価の記録**: 追加時に単価を記録しておくと原価管理に役立ちます

---

## 10. トラブルシューティング

| 問題 | 原因 | 解決方法 |
|------|------|----------|
| 在庫調整ボタンが表示されない | 権限不足（消耗品登録の権限のみでは調整不可） | マネージャー・管理者に依頼 |
| 「制限を超えています」エラー | 一般スタッフ・リーダーで100個以上の調整 | マネージャー・管理者に依頼するか、複数回に分けて調整 |
| 消耗品が登録できない | 必須項目が未入力 | 消耗品名、単位、最小在庫数を確認 |
| 初期在庫が反映されない | 初期在庫数を空欄にした | 登録後、在庫調整で「追加」を実行 |
| 在庫がマイナスになってしまう | 在庫数は0未満にはなりません | 「減らす」で現在数を超える数量を入力しても0になります |

---

## 11. 関連ドキュメント

- [在庫管理一覧マニュアル](./inventory_list.md)（作成予定）
- [消耗品発注マニュアル](./consumable_ordering.md)（作成予定）
- [実地棚卸マニュアル](./physical_inventory.md)（作成予定）

---

**最終更新**: 2026-01-21
