# システム健全性チェックマニュアル

## 1. 概要

ザイロクの動作が正常か、データに不整合がないかを定期的にチェックすることで、トラブルを未然に防ぎます。月次または四半期ごとに実施することで、システムの健全性を維持します。

**このマニュアルで解決できること**:
- データの不整合を早期発見
- システムの動作不良を検知
- セキュリティリスクを確認
- パフォーマンスの劣化を検知

**対象者**: Admin（管理者）のみ

**推奨頻度**: 月1回

---

## 2. 健全性チェックの種類

### 2-1. チェックの3レベル

| レベル | 頻度 | 所要時間 | 内容 |
|--------|------|----------|------|
| **レベル1: 日常チェック** | 毎日 | 5分 | ログイン状況、エラー発生の確認 |
| **レベル2: 月次チェック** | 月1回 | 30分 | データ整合性、権限確認 |
| **レベル3: 四半期チェック** | 3ヶ月に1回 | 1時間 | 監査ログ、パフォーマンス確認 |

---

## 3. レベル1: 日常チェック（毎日5分）

### 3-1. ログイン状況の確認

#### 目的
- スタッフが正常にログインできているか確認
- 無効化すべきスタッフがログインしていないか確認

#### 確認方法

1. **スタッフ一覧で最終ログイン日時を確認**
   - 左サイドメニュー **「スタッフ」** をクリック
   - 各スタッフの「最終ログイン」列を確認

2. **異常パターン**

| パターン | 原因 | 対応 |
|---------|------|------|
| **1週間以上ログインしていないスタッフがいる** | パスワード忘れ、またはシステムトラブル | 本人に確認、パスワードリセット |
| **無効化したスタッフがログインしている** | 無効化が正しく反映されていない | 再度無効化、システム管理者に連絡 |
| **深夜にログインしている** | 不正アクセスの可能性 | 本人に確認、パスワード変更 |

---

### 3-2. エラー発生の確認

#### 目的
- システムエラーが発生していないか確認

#### 確認方法

**方法1: スタッフからの報告**
- 「ログインできない」「画面が表示されない」などの報告がないか確認

**方法2: 監査ログで確認**（Admin専用）
1. 右上のアイコン → **「管理者メニュー」** → **「監査ログ」** をクリック
2. **「アクション」** で「失敗」を検索
3. エラーが多発していないか確認

**異常パターン**:
- 同じエラーが複数回発生している
- 特定のスタッフのみエラーが発生している

**対応**:
- エラーメッセージを記録
- システム管理者に連絡

---

## 4. レベル2: 月次チェック（月1回30分）

### 4-1. データ整合性の確認

#### チェック1: 道具の在庫数が正しいか

**目的**: システム上の在庫数と個別アイテム数が一致しているか確認

**確認方法**:

1. **道具一覧ページを開く**
   - 左サイドメニュー **「道具」** をクリック

2. **各道具の在庫数を確認**
   - 道具をクリックして詳細画面を開く
   - 「個別アイテム一覧」の数と「在庫数」が一致しているか確認

**異常パターン**:
```
道具マスタの在庫数: 5個
個別アイテム一覧: 3個

→ 不整合あり
```

**原因**:
- 個別アイテムが削除されたが、在庫数が更新されていない
- データベースの不整合

**対応**:
- システム管理者に連絡
- 棚卸しで実物を確認

---

#### チェック2: 現在位置が不明な道具がないか

**目的**: 「現在位置」が設定されていない道具を発見

**確認方法**:

1. 道具一覧ページで各道具をクリック
2. 個別アイテム一覧で「現在位置」が空白のアイテムがないか確認

**異常パターン**:
```
個別アイテム #001
現在位置: （空白）

→ 移動登録が漏れている
```

**対応**:
- 実物を確認して、正しい場所に移動登録

---

#### チェック3: 削除されたが実物が残っている道具

**目的**: 削除された道具が倉庫に残っていないか確認

**確認方法**:

1. 棚卸し時に、QRコードをスキャンしても「道具が見つかりません」と表示される道具を記録
2. 削除された道具の可能性

**対応**:
- 削除理由を確認（紛失、廃棄など）
- 実物が残っている場合、再登録を検討

---

### 4-2. 権限の確認

#### チェック1: Admin権限者が適切か

**目的**: Admin権限を持つべきでないスタッフが権限を持っていないか確認

**確認方法**:

1. **スタッフ一覧ページを開く**
   - 左サイドメニュー **「スタッフ」** をクリック

2. **「フィルタ」で「Admin」を選択**
   - Admin権限を持つスタッフのリストが表示されます

3. **確認すべき点**
   - Admin権限を持つスタッフの人数（推奨: 2〜3名）
   - Admin権限を持つスタッフが信頼できる人物か

**異常パターン**:
- Admin権限者が1名しかいない → 退職時にトラブルのリスク
- Admin権限者が10名以上いる → セキュリティリスク

**対応**:
- 適切な人数（2〜3名）に調整
- 不要なAdmin権限を剥奪

---

#### チェック2: 無効化されたスタッフが残っていないか

**目的**: 退職者のアカウントが正しく無効化されているか確認

**確認方法**:

1. スタッフ一覧ページで「状態」列を確認
2. 「無効」となっているスタッフを確認
3. 退職した社員がすべて無効化されているか確認

**異常パターン**:
- 退職者が「有効」のままになっている

**対応**:
- 退職者を無効化

---

### 4-3. セキュリティの確認

#### チェック1: パスワードポリシーの遵守

**目的**: スタッフが弱いパスワードを使用していないか確認

**確認方法**:

現在、ザイロクにはパスワード強度チェック機能がありません。以下の方法で代替してください。

1. **朝礼で周知**
   - 「パスワードは8文字以上、大文字・小文字・数字を含む」ことを周知
   - 定期的にパスワード変更を推奨

2. **初期パスワードの使い回しを防ぐ**
   - 新入社員に「初回ログイン後すぐにパスワード変更」を徹底

---

#### チェック2: 不審なログインがないか

**目的**: 不正アクセスの兆候を早期発見

**確認方法**:

1. **監査ログを確認**（Admin専用）
   - 右上のアイコン → **「管理者メニュー」** → **「監査ログ」** をクリック

2. **不審なパターン**

| パターン | 原因 | 対応 |
|---------|------|------|
| **深夜（22:00〜6:00）のログイン** | 不正アクセスまたは残業 | 本人に確認 |
| **短時間に大量のログイン失敗** | パスワード総当たり攻撃 | IPアドレスをブロック（システム管理者） |
| **退職者のログイン** | 無効化が漏れている | 即座に無効化 |

---

## 5. レベル3: 四半期チェック（3ヶ月に1回1時間）

### 5-1. 監査ログの全件確認

#### 目的
- 過去3ヶ月間の操作履歴をレビュー
- 不正操作や誤操作を発見

#### 確認方法

1. **監査ログページを開く**（Admin専用）
   - 右上のアイコン → **「管理者メニュー」** → **「監査ログ」** をクリック

2. **期間を設定**
   - **「開始日」**: 3ヶ月前の日付（例: 2025-10-01）
   - **「終了日」**: 今日の日付（例: 2026-01-22）

3. **アクション別に確認**

| アクション | 確認内容 |
|-----------|----------|
| **作成** | 新規登録された道具、スタッフなどが適切か |
| **更新** | 更新された内容が適切か（価格、権限など） |
| **削除** | 削除された道具が紛失・廃棄理由か |

4. **異常パターン**

| パターン | 原因 | 対応 |
|---------|------|------|
| **特定のスタッフが大量に削除操作** | 誤操作または不正操作 | 本人に確認、権限を見直し |
| **深夜に大量の更新操作** | 不正アクセス | パスワード変更、IP制限 |
| **同じエラーが頻発** | システムバグ | システム管理者に報告 |

---

### 5-2. パフォーマンスの確認

#### 目的
- システムの動作が遅くなっていないか確認
- データ量の増加によるパフォーマンス劣化を検知

#### 確認方法

**方法1: 体感で確認**
1. 道具一覧ページを開く
2. フィルタ機能を使ってみる
3. 動作が遅くないか確認

**方法2: データ量を確認**
1. **道具の総数を確認**
   - 道具一覧ページで総件数を確認
   - 1000件を超えるとパフォーマンスが劣化する可能性

2. **移動履歴の総数を確認**
   - 移動履歴ページで総件数を確認
   - 10000件を超えるとページ読み込みが遅くなる可能性

**異常パターン**:
- ページ読み込みに10秒以上かかる
- フィルタ検索に5秒以上かかる

**対応**:
- システム管理者に連絡
- データベースの最適化を依頼

---

### 5-3. バックアップの確認

#### 目的
- データが正しくバックアップされているか確認

#### 確認方法

**注意**: ザイロクはSupabase（クラウドデータベース）を使用しているため、自動でバックアップが取られています。

**確認すべき点**:
1. **Supabaseの設定を確認**（システム管理者）
   - 自動バックアップが有効になっているか
   - バックアップの保存期間（推奨: 30日以上）

2. **手動でデータをエクスポート**（推奨）
   - 重要なデータ（スタッフ情報、道具マスタなど）をExcelにエクスポート
   - 月1回、ローカルに保存

**バックアップがない場合のリスク**:
- データベース障害時に全データが消失
- 誤操作による削除データを復旧できない

---

## 6. システムトラブルの早期発見

### 6-1. スタッフからの報告を集約

#### 目的
- スタッフからの「おかしい」「エラーが出る」という報告を記録
- パターンを見つけて早期対応

#### 報告の記録方法

**Excelで記録簿を作成**:

| 報告日 | 報告者 | 問題内容 | 再現性 | 対応 | 解決日 |
|--------|--------|---------|--------|------|--------|
| 2026-01-15 | 山田 | ログインできない | 1回のみ | パスワードリセット | 2026-01-15 |
| 2026-01-18 | 佐藤 | 道具一覧が表示されない | 3回 | ブラウザキャッシュクリア | 2026-01-18 |
| 2026-01-20 | 鈴木 | QRスキャンが反応しない | 頻繁 | カメラ権限の確認 | 2026-01-20 |

**パターンの発見**:
- 同じ問題が複数回報告される → システムバグの可能性
- 特定のスタッフのみ問題が発生 → 端末の問題

---

### 6-2. ブラウザの互換性確認

#### 目的
- 推奨ブラウザ以外でアクセスしているスタッフを発見

#### 確認方法

**スタッフにアンケート**:
```
【ザイロクアクセス状況アンケート】
1. 使用しているブラウザは？
   □ Chrome   □ Edge   □ Safari   □ その他（　　　）

2. スマートフォンでアクセスしていますか？
   □ はい（Android）   □ はい（iPhone）   □ いいえ

3. 動作に問題はありますか？
   □ 問題なし   □ たまに遅い   □ よくエラーが出る
```

**推奨ブラウザ**:
- Chrome（最新版）
- Edge（最新版）
- Safari（最新版）

**非推奨**:
- Internet Explorer（サポート終了）
- 古いバージョンのブラウザ

**対応**:
- 推奨ブラウザへの切り替えを依頼
- スマートフォンアプリの使用を推奨（将来的に提供予定）

---

## 7. トラブルシューティング

### Q1. 道具の在庫数が実物と合いません

**A.** 以下を確認してください：

1. **棚卸しを実施**
   - [棚卸し作業マニュアル](./inventory_audit.md) を参照
   - 実物とシステムを照合

2. **移動登録漏れを確認**
   - 移動履歴で最新の記録を確認
   - 漏れている場合は移動登録を追加

3. **削除された道具を確認**
   - 過去に削除された道具が実物として残っている可能性
   - 再登録を検討

**詳細**: [棚卸し作業マニュアル](./inventory_audit.md)

---

### Q2. システムが遅いです。どうすればいいですか？

**A.** 以下を試してください：

**即座にできる対応**:
1. **ブラウザのキャッシュをクリア**
   - Ctrl + Shift + Delete（Windows）/ Cmd + Shift + Delete（Mac）

2. **別のブラウザを試す**
   - Chrome、Edge、Safari

3. **インターネット接続を確認**
   - Wi-Fiの速度を確認
   - 有線LANに切り替え

**それでも遅い場合**:
- システム管理者に連絡
- データベースの最適化を依頼

---

### Q3. 監査ログで不審なログインを見つけました

**A.** 以下の手順で対応してください：

1. **本人に確認**
   - 該当するスタッフに「○月○日○時にログインしましたか？」と確認

2. **本人が身に覚えがない場合**
   - 不正アクセスの可能性
   - 即座にパスワードを変更
   - 監査ログで他の不審な操作がないか確認

3. **IPアドレスを記録**
   - 監査ログにIPアドレスが記録されている場合、記録
   - システム管理者に報告

4. **全スタッフにパスワード変更を依頼**
   - 朝礼で「不正アクセスの兆候があるため、全員パスワード変更してください」と周知

---

## 8. チェックリスト

### 月次健全性チェックリスト

**データ整合性の確認**:
- [ ] 道具の在庫数と個別アイテム数が一致しているか
- [ ] 現在位置が不明な道具がないか
- [ ] 削除されたが実物が残っている道具がないか

**権限の確認**:
- [ ] Admin権限者が適切か（2〜3名推奨）
- [ ] 無効化されたスタッフが残っていないか
- [ ] 退職者がすべて無効化されているか

**セキュリティの確認**:
- [ ] 不審なログインがないか（深夜、大量のログイン失敗）
- [ ] パスワードポリシーの遵守（朝礼で周知）

**スタッフからの報告**:
- [ ] 問題報告を記録簿に記録
- [ ] パターンがないか確認（同じ問題が複数回）

---

### 四半期健全性チェックリスト

**監査ログの全件確認**:
- [ ] 過去3ヶ月間の監査ログをレビュー
- [ ] 不正操作や誤操作がないか確認
- [ ] 異常パターンを発見（大量削除、深夜の操作など）

**パフォーマンスの確認**:
- [ ] 道具一覧の読み込み速度を確認
- [ ] フィルタ検索の速度を確認
- [ ] 道具の総数を確認（1000件以上で注意）

**バックアップの確認**:
- [ ] Supabaseの自動バックアップが有効か確認
- [ ] 手動でデータをExcelにエクスポート

**ブラウザの互換性確認**:
- [ ] スタッフにアンケート実施
- [ ] 推奨ブラウザ以外を使用しているスタッフを発見
- [ ] 推奨ブラウザへの切り替えを依頼

---

## 9. 関連ドキュメント

- [スタッフ管理マニュアル](../../staff_management.md) - スタッフ管理全般
- [棚卸し作業マニュアル](./inventory_audit.md) - データ整合性の確認
- [新入社員の受け入れマニュアル](./new_employee_onboarding.md) - 新入社員登録
- [退職者の対応マニュアル](./employee_offboarding.md) - 退職者の無効化

---

**最終更新**: 2026-01-22
