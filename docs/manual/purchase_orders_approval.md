# 発注書承認フロー（金額別）マニュアル

## 📋 概要

発注書承認フロー機能では、作成された発注書をリーダーが提出し、金額に応じて適切な承認者が承認するワークフローを実現します。10万円未満は自動承認、10万円以上は段階的な承認フローが適用されます。

## 👥 対象者と権限

| 役割 | 提出 | 承認（10万円未満） | 承認（10万円以上） | 差し戻し |
|------|------|-----------------|-----------------|---------|
| スタッフ | × | × | × | × |
| リーダー | ○ | ○ | × | × |
| マネージャー | ○ | ○ | ○ | ○ |
| 管理者 | ○ | ○ | ○ | ○ |

**重要**:
- 作成者は自分が作成した発注書を承認できません
- 10万円未満の発注書はリーダーが承認可能です（自動承認）
- 10万円以上の発注書はマネージャー以上の承認が必要です

## 📍 アクセス方法

1. 左メニューから「発注書」をクリック
2. 対象の発注書をクリック
3. 詳細画面でアクションボタンを使用

## 🔄 発注書のステータスフロー

```
下書き ─提出→ 承認申請中 ─承認→ 承認済み ─送付→ 発注済み ─受領→ 納品済み ─支払→ 支払済み
  ↑                ↓
  └─────差し戻し─────┘
```

### ステータスの説明

| ステータス | 説明 | 編集可否 | 次のアクション |
|-----------|------|---------|---------------|
| 下書き | 作成中 | ○ 可能 | 提出 |
| 承認申請中 | 提出済み、承認待ち | × 不可 | 承認または差し戻し |
| 承認済み | 承認完了 | × 不可 | 送付 |
| 差戻し | 修正が必要 | ○ 可能 | 再提出 |
| 発注済み | 仕入先に送付済み | × 不可 | 受領登録 |
| 納品済み | 商品・サービス受領済み | × 不可 | 支払登録 |
| 支払済み | 支払完了 | × 不可 | なし（完了） |

## 💰 金額別承認フロー

発注金額により、承認フローが自動的に決定されます：

### 1️⃣ 10万円未満：自動承認

```
リーダー提出 → 自動承認 → 承認済み
```

**特徴**:
- 承認フローをスキップ
- 提出と同時に「承認済み」ステータスになる
- 少額発注の迅速化

**対象**:
- 消耗品の発注
- 少額の材料費
- 小規模な外注作業

### 2️⃣ 10万円以上100万円未満：マネージャー承認

```
リーダー提出 → マネージャー承認 → 承認済み
```

**特徴**:
- マネージャーが承認
- 1段階の承認フロー
- 中額発注の管理

**対象**:
- 中規模な材料費
- 機材のレンタル・購入
- 中規模な外注作業

### 3️⃣ 100万円以上：マネージャー＋管理者承認

```
リーダー提出 → マネージャー承認 → 管理者承認 → 承認済み
```

**特徴**:
- マネージャーと管理者の2段階承認
- 高額発注のリスク管理
- 慎重な審査

**対象**:
- 大規模な材料費
- 高額な機材の購入
- 大規模な外注工事

**注意**: 現在のシステムでは、100万円以上もマネージャー1段階承認です。将来的に2段階承認に対応予定です。

## 📤 発注書の提出（リーダー）

### 1️⃣ 提出の流れ

1. 発注書一覧から「下書き」ステータスの発注書を選択
2. 詳細画面で内容を確認
3. 「提出」ボタンをクリック
4. 確認メッセージが表示される
   - 「承認申請を送信しますか？」
5. 「OK」をクリック
6. 金額に応じてステータスが変更される
   - **10万円未満**: 「承認済み」（自動承認）
   - **10万円以上**: 「承認申請中」（承認待ち）

### 2️⃣ 提出前の確認事項

- **仕入先**: 正しい仕入先が選択されているか
- **発注日・希望納期**: 日付が正しいか
- **明細**: 品名・数量・単価・金額が正確か
- **合計金額**: 発注金額が妥当か（承認フローに影響）
- **納品場所**: 納品先が正しいか
- **備考**: 必要な情報が記載されているか

### 3️⃣ 提出後の動作

#### 10万円未満の場合
- 自動承認される
- ステータスが「承認済み」になる
- 承認者に通知は送られない
- 即座に仕入先への送付が可能

#### 10万円以上の場合
- 承認申請中になる
- ステータスが「承認申請中」になる
- マネージャー以上に通知が送られる
- 承認待ちになる

## ✅ 発注書の承認（マネージャー以上）

### 1️⃣ 承認の流れ

1. 発注書一覧から「承認申請中」ステータスの発注書を選択
2. 詳細画面で内容を確認
3. 「承認」ボタンをクリック
4. 承認モーダルが表示される（現在は即座に承認）
5. 確認メッセージ「発注書を承認しました」が表示される
6. ステータスが「承認済み」に変更される

### 2️⃣ 承認時の確認事項

#### 基本情報の確認

- **仕入先**: 正しい仕入先に発注しているか
- **発注日・希望納期**: 日付が適切か
- **納品場所**: 納品先が正しいか
- **支払条件**: 支払条件が適切か

#### 明細の確認

- **種別**: 適切な種別が選択されているか
- **品名**: 分かりやすく記載されているか
- **数量・単価**: 妥当な数量と単価か
- **金額**: 計算が正しいか
- **税率**: 適切な税率が適用されているか

#### 金額の確認

- **小計**: 明細の合計が正しいか
- **消費税**: 税額が適切に計算されているか
- **合計**: 最終的な発注金額が妥当か
- **予算**: 予算内に収まっているか

#### その他の確認

- **発注備考**: 仕入先への伝達事項が記載されているか
- **社内メモ**: 特記事項がないか
- **工事**: 正しい工事に紐づいているか

### 3️⃣ 承認権限の制限

以下の場合、承認ボタンは表示されません：

1. **作成者本人**: 自分が作成した発注書は承認できない
2. **権限不足**: リーダーは承認できない（マネージャー以上のみ）
3. **既に承認済み**: 承認済みの発注書は再承認不可

### 4️⃣ 承認後の処理

承認後は以下の処理が可能になります：

- 発注書PDFの発行
- 仕入先への送付
- 受領登録
- 支払登録

## ↩️ 発注書の差し戻し（マネージャー以上）

### 1️⃣ 差し戻しの流れ

1. 発注書一覧から「承認申請中」ステータスの発注書を選択
2. 詳細画面で内容を確認
3. 「差し戻し」ボタンをクリック
4. 差し戻しモーダルが表示される
5. **差し戻し理由（必須）** を入力
   - 例: 仕入先が間違っています。A社→B社に変更してください。
   - 例: 数量が多すぎます。10個→5個に修正してください。
6. 「差し戻す」ボタンをクリック
7. 確認メッセージ「発注書を差し戻しました」が表示される
8. ステータスが「下書き」に戻る
9. 作成者に通知が送られる

### 2️⃣ 差し戻し理由の書き方

差し戻し理由は**必須**です。作成者が修正内容を理解できるように、具体的に記載してください。

#### ❌ 悪い例（不明確）

- 内容に誤りがあります。
- 修正してください。
- 確認してください。

#### ✅ 良い例（具体的）

- 仕入先が間違っています。A社ではなくB社に発注してください。
- 明細1の数量が多すぎます。10個→5個に修正してください。
- 希望納期が早すぎます。1週間後→2週間後に変更してください。
- 納品場所が間違っています。本社倉庫ではなく現場に納品してください。

**ポイント**:
- 何が間違っているか
- どう修正すべきか
- 理由や根拠

### 3️⃣ 差し戻し後の処理

差し戻し後は以下の処理が行われます：

1. ステータスが「差戻し」に変更される
2. 作成者が再編集可能になる
3. 作成者に通知が送られる
4. 差し戻し理由が履歴として記録される
5. 作成者は修正後、再度提出できる

### 4️⃣ 差し戻しの注意事項

- **差し戻し理由は必須**: 空白では差し戻しできません
- **具体的に記載**: 作成者が理解できるように詳細に書く
- **履歴に残る**: 差し戻し理由は履歴として永続的に記録されます

## 🔐 マネージャーの自動承認

### マネージャー以上が作成した場合

マネージャー以上が発注書を作成し「提出」ボタンをクリックした場合：

```
マネージャー作成 → 提出 → 自動承認 → 承認済み
```

**特徴**:
- 金額に関わらず自動承認
- 承認フローをスキップ
- 自己承認が可能

**理由**:
- マネージャー以上は承認権限を持つため
- 承認フローを省略して業務を効率化

## 📊 承認履歴の確認

### 承認履歴タイムライン

発注書詳細画面では、承認履歴をタイムライン形式で確認できます：

```
【2026年1月21日 15:30】リーダー A が確定・提出
↓
【2026年1月21日 16:00】マネージャー B が差し戻し
理由: 仕入先が間違っています。A社→B社に変更してください。
↓
【2026年1月21日 16:30】リーダー A が確定・提出（再提出）
↓
【2026年1月21日 17:00】マネージャー B が承認
コメント: 修正内容を確認しました。承認します。
```

履歴には以下の情報が記録されます：

- 操作日時
- 操作者
- 操作内容（作成、下書き保存、確定・提出、承認、差し戻し）
- コメント・理由

### 履歴アイコンの意味

| アイコン | 操作内容 | 色 |
|---------|---------|-----|
| 📝 | 作成 | グレー |
| 💾 | 下書き保存 | グレー |
| 📤 | 確定・提出 | オレンジ |
| ✅ | 承認 | グリーン |
| ↩️ | 差し戻し | レッド |
| 📧 | 仕入先送付 | パープル |
| 📦 | 発注 | ブルー |
| ✓ | 受領 | ブルー |
| 💰 | 支払い | ブルー |

## 🔐 権限別の操作一覧

### リーダー

| 操作 | 条件 | 結果 |
|------|------|------|
| 提出 | ステータスが「下書き」または「差戻し」 | 金額に応じて「承認申請中」または「承認済み」 |
| 編集 | ステータスが「下書き」または「差戻し」 | 内容を修正可能 |
| 削除 | ステータスが「下書き」 | 削除可能 |

**できないこと**:
- 承認
- 差し戻し
- 承認申請中・承認済みの編集

### マネージャー・管理者

| 操作 | 条件 | 結果 |
|------|------|------|
| 提出 | ステータスが「下書き」または「差戻し」 | 自動承認で「承認済み」 |
| 承認 | ステータスが「承認申請中」かつ作成者が自分以外 | 「承認済み」に変更 |
| 差し戻し | ステータスが「承認申請中」 | 「差戻し」に変更 |
| 編集 | ステータスが「下書き」または「差戻し」 | 内容を修正可能 |
| 削除 | ステータスが「下書き」または「承認申請中」 | 削除可能 |

**できないこと**:
- 自分が作成した発注書の承認
- 承認済みの編集
- 承認済みの削除（システム管理者のみ可能）

## ⚠️ 注意事項

### 提出について

- **提出後は編集不可**: 提出前に必ず内容を確認してください
- **金額により承認フローが変わる**: 10万円未満は自動承認、10万円以上は承認待ち
- **未読バッジ**: マネージャーに未読バッジが表示されます（10万円以上の場合）

### 承認について

- **承認＝確定**: 承認後は編集・削除できません
- **自己承認不可**: 作成者は自分の発注書を承認できません
- **慎重に確認**: 金額や明細を十分に確認してから承認してください

### 差し戻しについて

- **理由は必須**: 具体的な修正内容を記載してください
- **履歴に残る**: 差し戻し理由は永続的に記録されます
- **再提出可能**: 差し戻し後、作成者が修正して再提出できます

### 金額別承認フロー

- **10万円未満**: 自動承認（即座に承認済み）
- **10万円以上**: マネージャー承認が必要
- **100万円以上**: 現在はマネージャー承認（将来的に2段階承認予定）

### 承認済み後の変更

承認済みの発注書は原則として編集・削除できません。修正が必要な場合は以下の対応をしてください：

| 場面 | 対応方法 |
|------|---------|
| 金額の誤り | 修正発注書を新規作成 |
| 仕入先の誤り | 管理者に相談（システム管理者が対応） |
| キャンセル | 管理者に相談（削除フラグで対応） |

## 🔗 関連機能

- [発注書作成マニュアル](purchase_orders_create.md)
- [消耗品発注管理マニュアル](consumable_orders.md)
- [取引先マスタマニュアル](clients.md)
- [工事管理マニュアル](projects.md)

---

**最終更新**: 2026-01-21
