# 倉庫位置管理マニュアル

## 対象者

このマニュアルは、倉庫位置の設定・管理を行う以下の権限のユーザーを対象としています。

- **Admin（管理者）**: 全機能が利用可能（倉庫位置の登録・編集・削除、階層設定を含む）

※ Staff、Leader、Managerは倉庫位置情報の閲覧のみ可能です。

---

## 前提条件

倉庫位置管理を始める前に、以下を確認してください。

1. **契約プラン**: 現場資産パック、または フル機能統合パックが契約済みであること
2. **倉庫の構造を把握**: 実際の倉庫の構造（エリア、棚、段など）を確認

---

## 倉庫位置管理とは

### 1. 倉庫位置管理の目的

倉庫位置管理は、**倉庫内のどこに道具があるか**を正確に記録する機能です。

**課題:**
```
❌ 倉庫のどこかにあるが、見つからない
❌ 「Aエリアにある」までは分かるが、具体的な場所が不明
❌ 棚卸しに時間がかかる
```

**解決:**
```
✅ 「Aエリア 3番棚 上段」と具体的な位置を記録
✅ QRコードをスキャンして位置を確認
✅ 位置から道具を逆引き検索
```

### 2. 階層構造とは

倉庫の構造を階層的に管理します。

**例1: 3階層の倉庫**
```
レベル1: エリア（A、B、C）
  └── レベル2: 棚（1番、2番、3番）
      └── レベル3: 段（上段、中段、下段）

具体的な位置:
- Aエリア 1番棚 上段
- Aエリア 1番棚 中段
- Bエリア 2番棚 上段
```

**例2: 1階層の倉庫**
```
レベル1: 場所のみ
- 北側壁掛け1
- 南側壁掛け2
- 作業台横
```

**例3: 4階層の倉庫**
```
レベル1: フロア（1F、2F）
  └── レベル2: エリア（工具、消耗品、重機部品）
      └── レベル3: 保管方法（棚、壁掛け、床置き）
          └── レベル4: 番号（1、2、3...）

具体的な位置:
- 1F 工具エリア 棚 5番
- 2F 消耗品エリア 壁掛け 3番
```

### 3. QRコードの活用

各倉庫位置にQRコードを貼り付けることで、以下が可能になります：

- **位置の確認**: QRコードをスキャンして、現在地を確認
- **道具の移動登録**: QRコードをスキャンして、その位置に道具を移動
- **位置から道具を検索**: その位置にある道具の一覧を表示

---

## 初期設定（Admin限定）

### ステップ1: 倉庫階層の設定

倉庫位置を登録する前に、倉庫の階層構造を設定します。

1. **設定 > 倉庫位置設定 > 階層設定** を開く
2. **階層レベル**を選択（1階層〜5階層）
3. 各レベルの名称を入力

**設定例（3階層の場合）:**
- レベル1: エリア
- レベル2: 棚
- レベル3: 段

**設定例（4階層の場合）:**
- レベル1: フロア
- レベル2: エリア
- レベル3: 保管方法
- レベル4: 番号

4. **「保存」** をクリック

**注意:**
- 階層設定は、倉庫位置を登録する前に行ってください
- 階層設定を変更すると、既存の倉庫位置の表示が変わる可能性があります

---

## 倉庫位置の登録

### ステップ1: 位置コードと表示名の決定

倉庫位置を登録する前に、以下を決めます。

- **位置コード**: システム内で使用する短いコード（例: A-1-上）
- **表示名**: ユーザーに表示する名前（例: Aエリア 1番棚 上段）

**位置コードの命名規則（推奨）:**
```
3階層の場合: [エリア]-[棚番号]-[段]
- A-1-上（Aエリア 1番棚 上段）
- A-1-中（Aエリア 1番棚 中段）
- B-2-下（Bエリア 2番棚 下段）

4階層の場合: [フロア]-[エリア]-[保管方法]-[番号]
- 1F-工具-棚-5（1F 工具エリア 棚 5番）
- 2F-消耗品-壁掛け-3（2F 消耗品エリア 壁掛け 3番）
```

### ステップ2: 倉庫位置の登録

1. **倉庫位置管理 > 位置マスタ** を開く
2. **「+ 位置を追加」** をクリック
3. 以下の情報を入力

#### 基本情報（必須）
- **位置コード**: 短いコード（例: A-1-上）
- **表示名**: 分かりやすい名前（例: Aエリア 1番棚 上段）

#### 階層情報（オプション）
- **親位置**: 親の位置を選択（階層構造の場合）
  - 例: 「Aエリア 1番棚」の親は「Aエリア」
- **階層レベル**: 0（ルート）、1、2、3...

#### 詳細情報（オプション）
- **説明**: 位置の詳細説明（例: 入口から左手2番目の棚）
- **表示順**: 一覧での表示順序

4. **「登録」** をクリック

### ステップ3: QRコードの印刷と貼り付け

倉庫位置登録時に、自動的にQRコードが生成されます。

1. 位置詳細画面を開く
2. **「QR印刷」** をクリック
3. PDFをダウンロードして印刷
4. 実際の倉庫の位置に貼り付け

**推奨貼付位置:**
- 棚の前面
- 壁掛けフックの近く
- 床置きエリアの床または壁

**ラベルサイズ:** 5cm x 5cm 以上（見やすいサイズ）

---

## 階層構造の登録例

### 3階層の倉庫の場合

**階層設定:**
- レベル1: エリア
- レベル2: 棚
- レベル3: 段

**登録手順:**

#### 1. レベル1（エリア）を登録
```
位置コード: A
表示名: Aエリア
親位置: なし
階層レベル: 1
```

```
位置コード: B
表示名: Bエリア
親位置: なし
階層レベル: 1
```

#### 2. レベル2（棚）を登録
```
位置コード: A-1
表示名: Aエリア 1番棚
親位置: Aエリア
階層レベル: 2
```

```
位置コード: A-2
表示名: Aエリア 2番棚
親位置: Aエリア
階層レベル: 2
```

#### 3. レベル3（段）を登録
```
位置コード: A-1-上
表示名: Aエリア 1番棚 上段
親位置: Aエリア 1番棚
階層レベル: 3
```

```
位置コード: A-1-中
表示名: Aエリア 1番棚 中段
親位置: Aエリア 1番棚
階層レベル: 3
```

**結果:**
```
Aエリア
├── 1番棚
│   ├── 上段
│   ├── 中段
│   └── 下段
└── 2番棚
    ├── 上段
    ├── 中段
    └── 下段

Bエリア
├── 1番棚
│   ├── 上段
│   └── 下段
└── 2番棚
    └── 上段
```

---

## 倉庫位置を使った道具の配置

### 道具を倉庫位置に配置する方法

#### 方法1: QRスキャンで配置

1. スマートフォンで **QRスキャン** を開く
2. 倉庫位置のQRコードをスキャン
3. 配置したい道具のQRコードをスキャン
4. **「この位置に配置」** をクリック

#### 方法2: 手動で配置

1. **道具管理 > 道具一覧** で対象の道具をクリック
2. **「編集」** をクリック
3. **倉庫位置**を選択（例: Aエリア 1番棚 上段）
4. **「保存」** をクリック

### 位置から道具を検索

特定の倉庫位置にある道具を確認できます。

1. **倉庫位置管理 > 位置マスタ** を開く
2. 対象の位置をクリック
3. **「この位置の道具」** タブを開く
4. 現在その位置にある道具の一覧が表示されます

**活用例:**
- 棚卸し時に、特定の位置の道具をチェック
- 位置別の在庫確認
- 空いている位置の確認

---

## 倉庫位置の編集

### 編集手順

1. **倉庫位置管理 > 位置マスタ** を開く
2. 編集したい位置をクリック
3. **「編集」** をクリック
4. 情報を修正
5. **「保存」** をクリック

**編集可能な項目:**
- 位置コード
- 表示名
- 親位置
- 説明
- 表示順

---

## 倉庫位置の削除

### 削除の制限事項

倉庫位置を削除する際は、以下の条件を確認してください：

- **道具が配置されている位置は削除できません**
- **子位置がある位置は削除できません**（階層構造の場合）

誤って登録した位置で、まだ使用していないもののみ削除可能です。

### 削除手順

1. **倉庫位置管理 > 位置マスタ** を開く
2. 削除したい位置をクリック
3. **「削除」** をクリック
4. 確認ダイアログで **「削除」** をクリック

**注意:**
- 削除は論理削除（データは残るが非表示）です
- 復元が必要な場合は、管理者に連絡してください

---

## 検索とフィルタリング

### 基本的な検索

1. **倉庫位置管理 > 位置マスタ** を開く
2. 画面上部の検索ボックスにキーワードを入力
3. 位置コード、表示名で検索できます

### フィルタリング

**「フィルタ」** ボタンをクリックすると、以下の条件で絞り込みができます：

- **階層レベル**: レベル1、レベル2、レベル3で絞り込み
- **親位置**: 特定の親位置の子位置のみ表示
- **使用状況**: 道具が配置されている位置のみ / 空いている位置のみ

---

## 活用例

### 1. 棚卸し時の活用

棚卸し時に、位置別に道具をチェックできます。

**手順:**
1. **倉庫位置管理 > 位置マスタ** で位置を選択
2. **「この位置の道具」** タブで道具一覧を表示
3. 実際の倉庫でその位置の道具をチェック
4. 不足や過剰があれば在庫調整

### 2. 倉庫レイアウト変更時

倉庫のレイアウトを変更する際、位置情報を更新できます。

**手順:**
1. 新しいレイアウトに合わせて倉庫位置を追加
2. 道具を新しい位置に移動
3. 古い位置を削除（道具が0になったら）

### 3. 位置別の在庫管理

位置ごとの在庫数を確認できます。

**手順:**
1. **倉庫位置管理 > 在庫レポート** を開く
2. 位置別の道具数をグラフ表示
3. 過密な位置や空いている位置を確認
4. 道具の再配置を検討

---

## トラブルシューティング

### 倉庫位置が見つからない場合の検索方法

倉庫位置一覧で目的の位置が見つからない場合は、以下の手順で検索してください。

1. **検索ボックスを使用**
   - 画面上部の検索ボックスに位置コードまたは表示名を入力
   - 部分一致で検索可能

2. **フィルタリング機能を使用**
   - **「フィルタ」** ボタンをクリック
   - 階層レベル、親位置で絞り込み

3. **削除済み位置の確認**
   - 削除された倉庫位置は一覧に表示されません
   - 管理者に確認を依頼してください

### 階層構造の変更方法

階層設定を変更したい場合の手順：

1. **設定 > 倉庫位置設定 > 階層設定** を開く
2. 階層レベルまたは名称を変更
3. **「保存」** をクリック

**注意:**
- 既存の倉庫位置の階層レベルは変わりません
- 必要に応じて、倉庫位置を個別に編集してください

### QRコードの再印刷方法

QRコードが汚れて読めなくなった場合や、破損した場合は再印刷できます。

1. 倉庫位置詳細画面を開く
2. **「QR印刷」** をクリック
3. PDFをダウンロードして印刷
4. 新しいQRコードを貼り直す

**注意:** QRコード（UUID）自体は変わらないため、既存のデータは保持されます。

---

## 注意事項

### 登録時の注意

- **位置コードは短く**: 入力しやすいように短いコードを使用
- **表示名は分かりやすく**: 誰が見ても分かる名前にする
- **階層構造は慎重に**: 一度作成すると変更が大変

### 運用上の注意

- **QRコードは必ず貼る**: 位置管理の基本です
- **定期的に見直し**: 使わない位置は削除または統合
- **位置コードの命名規則を統一**: 複数人で管理する場合は重要

### セキュリティ

- **削除は慎重に**: 論理削除ですが、復元には管理者権限が必要
- **他社の位置情報は見えません**: マルチテナント型のため、他社データは完全分離

---

## 関連機能

- [道具管理](./tool_management.md) - 道具を倉庫位置に配置
- [消耗品管理](./consumable_management.md) - 消耗品を倉庫位置に配置
- [QRスキャン](./qr_scan.md) - 位置のQRコードをスキャン

---

**倉庫位置管理で、倉庫内の道具を正確に把握！**
