# 実装状況マップ

最終更新: 2025-12-05

## 🎉 重要な更新

**super_admin管理画面が完全実装済みであることを確認しました！**
- 📍 実装場所: `~/fieldtool-admin/` (別プロジェクト)
- 🌐 アクセス: http://localhost:3001
- 詳細は下記「Phase 4: SaaS化準備」を参照

## ✅ 完了した機能

### Phase 1: 基本機能

#### 認証システム
- [x] ログイン機能 (Supabase Auth)
- [x] ログアウト機能
- [x] セッション管理
- [x] パスワードリセット（Supabase組み込み）

#### ユーザー管理
- [x] ユーザー登録
- [x] 組織との紐付け
- [x] ロール管理（admin, staff）

#### 道具管理
- [x] 道具マスタ登録
- [x] 道具一覧表示
- [x] 道具詳細表示
- [x] 道具編集
- [x] 道具削除
- [x] 管理タイプ選択（個別管理 / 消耗品管理）
- [x] QRコード自動生成（UUID v4）

#### 道具アイテム管理（個別管理用）
- [x] 道具登録時に個別アイテム作成
- [x] 各アイテムにQRコード割り当て
- [x] アイテム一覧表示

#### 現場管理
- [x] 現場登録
- [x] 現場一覧表示
- [x] 現場詳細表示
- [x] 現場編集
- [x] 現場ステータス管理（進行中/完了/中断）
- [x] 現場削除

#### 移動履歴管理（個別管理道具）
- [x] 持ち出し記録
- [x] 返却記録
- [x] 移動履歴一覧表示
- [x] 現在地追跡

#### 倉庫位置管理
- [x] 倉庫位置マスタ登録
- [x] 階層構造（レベル1〜5）
- [x] 倉庫位置一覧表示
- [x] 倉庫位置編集
- [x] 倉庫位置削除
- [x] 道具返却時の位置登録

#### 組織設定
- [x] 組織設定ページ
- [x] 倉庫階層有効/無効切り替え
- [x] 消耗品記録方式の選択
  - [x] パターンA: 数量を記録
  - [x] パターンB: 移動のみ記録
  - [x] パターンC: 記録不要

#### 消耗品管理 ⭐NEW
- [x] 消耗品の登録（道具登録時に管理タイプで選択）
- [x] 単位のカスタマイズ（8種類）
- [x] 消耗品一覧表示
- [x] 在庫調整機能
  - [x] 追加（入庫）
  - [x] 削除（廃棄）
  - [x] 設定（棚卸）
- [x] 移動管理機能
  - [x] 倉庫 → 現場（持ち出し）
  - [x] 現場 → 倉庫（返却）
  - [x] 組織設定に応じた記録方式
- [x] 在庫アラート機能
- [x] ダッシュボードへのアラート表示
- [x] 低在庫の視覚的表示（赤背景）

---

## 🚧 未完了の機能

### Phase 1: 基本機能の残り

#### QRスキャン機能 🔴 重要度: 高
- [ ] `/scan` ページの実装
- [ ] カメラアクセス許可処理
- [ ] QRコード読み取り機能
- [ ] スキャン後の道具詳細表示
- [ ] スキャン後の即時移動登録

**優先度**: 最高（現場での実用性に直結）

#### QRコード印刷機能 🔴 重要度: 高
- [ ] 個別QRコード印刷（PDF出力）
- [ ] 複数選択による一括印刷
- [ ] ラベルサイズのカスタマイズ
- [ ] 道具情報の印刷オプション（名前、型番、QRコード）

**優先度**: 最高（運用開始に必須）

#### 道具セット機能
- [ ] 道具セット登録
- [ ] 道具セット一覧表示
- [ ] 道具セット編集
- [ ] セットによる一括出庫
- [ ] セットによる一括返却

**優先度**: 中

#### 倉庫位置階層テンプレートUI 🟡 重要度: 中
- [ ] 組織設定画面でのビジュアル設定
- [ ] レベル名のカスタマイズ
- [ ] 階層のプレビュー表示
- [ ] SQLなしでの設定変更

**優先度**: 中（現在はSQLで直接設定が必要）

---

### Phase 2: ユーザビリティ向上

#### モバイル対応強化 🟡
- [ ] レスポンシブデザインの最適化
- [ ] タッチ操作の改善
- [ ] モバイル専用メニュー
- [ ] スマホ画面での一覧表示最適化

**優先度**: 中

#### PWA化 🟢
- [ ] Service Worker実装
- [ ] オフライン対応
- [ ] ホーム画面追加機能
- [ ] プッシュ通知（将来）

**優先度**: 低

#### 通知機能 🟢
- [ ] 在庫アラートのメール通知
- [ ] 道具返却期限通知
- [ ] メンテナンス期日通知

**優先度**: 低

#### レポート機能 🟢
- [ ] 利用状況レポート
- [ ] コスト分析レポート
- [ ] PDF出力機能

**優先度**: 低

---

### Phase 3: 管理機能拡張

#### 権限管理強化
- [ ] リーダー権限の実装
- [ ] 現場リーダーの承認フロー
- [ ] カスタム権限設定

**優先度**: 中

#### 現場管理強化
- [ ] 現場の予算管理
- [ ] 現場の完了処理フロー
- [ ] 道具の一括返却チェック
- [ ] 現場の統計情報

**優先度**: 低

#### メンテナンス機能
- [ ] メンテナンス記録
- [ ] 点検スケジュール
- [ ] 修理履歴
- [ ] 次回点検日の自動計算

**優先度**: 低

---

### Phase 4: SaaS化準備 ✅ 完全実装済み

#### super_admin管理画面（fieldtool-admin プロジェクト）
- [x] **認証・セキュリティ**
  - [x] 2FA認証（speakeasy）
  - [x] JWT セッション管理
  - [x] IP制限機能
  - [x] セッションタイムアウト（2時間）
  - [x] アイドルタイムアウト（10分）

- [x] **組織管理**
  - [x] 組織一覧（統計付き）
  - [x] 組織詳細ページ
  - [x] 組織新規登録
  - [x] 組織編集
  - [x] 組織の有効化/無効化
  - [x] サブドメイン重複チェック

- [x] **契約管理**
  - [x] 契約一覧・詳細
  - [x] 契約新規作成・編集
  - [x] 契約自動更新（cron）

- [x] **請求書管理**
  - [x] 請求書一覧・詳細
  - [x] 請求書新規発行
  - [x] 請求書PDF生成（@react-pdf/renderer）
  - [x] 請求書メール送信（resend）
  - [x] 入金記録機能
  - [x] 請求書自動生成（cron）

- [x] **ダッシュボード**
  - [x] MRR/ARR計算
  - [x] 顧客統計
  - [x] 請求書統計

- [x] **監査ログ・レポート**
  - [x] 監査ログ表示
  - [x] レポート機能

📍 **実装場所**: `~/fieldtool-admin/`
🌐 **アクセス**: http://localhost:3001
📦 **APIエンドポイント**: 19個実装済み

**優先度**: ✅ 完了

#### マルチテナント機能（メインアプリ側）
- [x] データ分離の強化（RLS完全化）
- [ ] 組織登録フロー（現在は管理画面から）
- [ ] 組織切り替え機能（現在は不要）

**優先度**: 低

#### Stripe統合（顧客30社以降）
- [ ] Stripe連携
- [ ] 自動課金システム
- [ ] サブスクリプション管理
- [ ] 請求書の自動送信

**優先度**: 最低（顧客規模に応じて）

---

### Phase 5: 高度な機能

#### カスタムフィールド
- [ ] カスタムフィールド定義UI
- [ ] JSONB型での保存
- [ ] 動的フォーム生成
- [ ] 業種別テンプレート

**優先度**: 低

#### AI機能
- [ ] 需要予測
- [ ] 異常検知
- [ ] 最適配置提案

**優先度**: 最低

#### 外部連携
- [ ] 会計ソフト連携
- [ ] カレンダー連携
- [ ] Slack/Teams通知

**優先度**: 最低

---

## 🎯 次に実装すべき機能（推奨順）

### 1. QRスキャン機能 🔴
**理由**: 現場での実用性に直結する最重要機能

**実装内容**:
- カメラアクセス
- QRコード読み取り
- 道具情報表示
- 即時移動登録

**工数**: 2-3日

---

### 2. QRコード印刷機能 🔴
**理由**: 道具にQRコードを貼る必要があるため運用開始に必須

**実装内容**:
- PDF生成
- 一括印刷
- ラベルフォーマット

**工数**: 2日

---

### 3. 倉庫位置階層テンプレートUI 🟡
**理由**: 現在SQLで直接設定が必要で使いにくい

**実装内容**:
- ビジュアル設定画面
- レベル名カスタマイズ
- プレビュー機能

**工数**: 1-2日

---

### 4. 道具の写真登録 🟡
**理由**: 視覚的な管理のため

**実装内容**:
- Supabase Storage統合
- 画像アップロード
- サムネイル表示

**工数**: 1日

---

### 5. モバイルUI最適化 🟡
**理由**: 現場作業者の使いやすさ向上

**実装内容**:
- レスポンシブデザイン改善
- タッチ操作最適化
- 大きなボタン

**工数**: 2-3日

---

## 📊 実装完了率

### Phase 1: 基本機能
- 完了: 85%
- 残り: QRスキャン、QR印刷、道具セット

### Phase 2: ユーザビリティ
- 完了: 10%
- 残り: ほぼ全て

### Phase 3: 管理機能
- 完了: 20%
- 残り: 権限強化、メンテナンス機能

### Phase 4: SaaS化
- 完了: 0%
- 残り: 全て（顧客増加後に着手）

### Phase 5: 高度な機能
- 完了: 0%
- 残り: 全て（将来的に検討）

---

## 🗂️ 関連ドキュメント

- [SPECIFICATION_SAAS_FINAL.md](./SPECIFICATION_SAAS_FINAL.md) - メイン仕様書
- [ADDITIONAL_FEATURES_SPEC.md](./ADDITIONAL_FEATURES_SPEC.md) - 追加機能仕様
- [scripts/github-project-tasks.md](../scripts/github-project-tasks.md) - タスク管理用
- [ARCHITECTURE.md](./ARCHITECTURE.md) - アーキテクチャ設計
- [ENVIRONMENT_SETUP.md](./ENVIRONMENT_SETUP.md) - 環境構築手順
