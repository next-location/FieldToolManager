-- 簡易版テストデータ投入スクリプト（現在のスキーマに対応）

-- ========================================
-- 1. 組織を作成
-- ========================================
INSERT INTO organizations (id, name, created_at)
VALUES ('00000000-0000-0000-0000-000000000001', 'テスト建設株式会社', NOW())
ON CONFLICT (id) DO UPDATE SET name = 'テスト建設株式会社';

-- ========================================
-- 2. ユーザーを作成（Supabase Auth経由）
-- ========================================
-- 管理者ユーザー (admin@test.com / Test1234!)
INSERT INTO auth.users (
  id, instance_id, aud, role, email, encrypted_password, email_confirmed_at,
  created_at, updated_at, confirmation_token, raw_app_meta_data, raw_user_meta_data
) VALUES (
  '10000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000000',
  'authenticated', 'authenticated', 'admin@test.com',
  '$2a$10$XOPbrlUPQdwdJUpSrIF6X.LbE14qsMmKGhM1A8W9iqaG1vRCaP4wa',
  NOW(), NOW(), NOW(), '', '{"provider":"email","providers":["email"]}', '{}'
) ON CONFLICT (id) DO NOTHING;

-- スタッフユーザー (staff@test.com / Test1234!)
INSERT INTO auth.users (
  id, instance_id, aud, role, email, encrypted_password, email_confirmed_at,
  created_at, updated_at, confirmation_token, raw_app_meta_data, raw_user_meta_data
) VALUES (
  '10000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000000',
  'authenticated', 'authenticated', 'staff@test.com',
  '$2a$10$XOPbrlUPQdwdJUpSrIF6X.LbE14qsMmKGhM1A8W9iqaG1vRCaP4wa',
  NOW(), NOW(), NOW(), '', '{"provider":"email","providers":["email"]}', '{}'
) ON CONFLICT (id) DO NOTHING;

-- usersテーブルにユーザー情報を登録
INSERT INTO users (id, organization_id, name, email, role, department, created_at)
VALUES
  ('10000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', '管理者 太郎', 'admin@test.com', 'admin', '管理部', NOW()),
  ('10000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000001', 'スタッフ 花子', 'staff@test.com', 'user', '工事部', NOW())
ON CONFLICT (id) DO UPDATE SET
  name = EXCLUDED.name,
  department = EXCLUDED.department;

-- ========================================
-- 3. 現場を作成
-- ========================================
INSERT INTO sites (id, organization_id, name, address, created_at)
VALUES
  ('30000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', '新宿ビル改修工事', '東京都新宿区西新宿1-1-1', NOW()),
  ('30000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000001', '渋谷マンション建設', '東京都渋谷区道玄坂2-2-2', NOW()),
  ('30000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000001', '横浜駅前開発', '神奈川県横浜市西区高島3-3-3', NOW()),
  ('30000000-0000-0000-0000-000000000004', '00000000-0000-0000-0000-000000000001', '品川オフィス改装', '東京都港区港南4-4-4', NOW()),
  ('30000000-0000-0000-0000-000000000005', '00000000-0000-0000-0000-000000000001', '川崎工場塗装', '神奈川県川崎市川崎区5-5-5', NOW())
ON CONFLICT (id) DO UPDATE SET name = EXCLUDED.name;

-- ========================================
-- 4. 道具を作成
-- ========================================
INSERT INTO tools (id, organization_id, name, model_number, manufacturer, quantity, minimum_stock, created_at)
VALUES
  ('40000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', '電動ドライバー', 'DD-2000', 'マキタ', 5, 2, NOW()),
  ('40000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000001', 'インパクトドライバー', 'TD-171D', 'マキタ', 3, 1, NOW()),
  ('40000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000001', '電動サンダー', 'BO5041', 'マキタ', 4, 1, NOW()),
  ('40000000-0000-0000-0000-000000000004', '00000000-0000-0000-0000-000000000001', 'レーザー距離計', 'GLM50C', 'BOSCH', 2, 1, NOW()),
  ('40000000-0000-0000-0000-000000000005', '00000000-0000-0000-0000-000000000001', '水平器', 'LST-600', 'タジマ', 3, 1, NOW())
ON CONFLICT (id) DO UPDATE SET name = EXCLUDED.name;

-- ========================================
-- 5. 個別道具アイテムを作成
-- ========================================
-- 電動ドライバー (5台)
INSERT INTO tool_items (id, tool_id, organization_id, serial_number, qr_code, current_location, current_site_id, status, created_at)
VALUES
  ('50000000-0000-0000-0000-000000000001', '40000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', 'DD-001', '50000000-0000-0000-0000-000000000001', 'warehouse', NULL, 'available', NOW()),
  ('50000000-0000-0000-0000-000000000002', '40000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', 'DD-002', '50000000-0000-0000-0000-000000000002', 'site', '30000000-0000-0000-0000-000000000001', 'in_use', NOW()),
  ('50000000-0000-0000-0000-000000000003', '40000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', 'DD-003', '50000000-0000-0000-0000-000000000003', 'warehouse', NULL, 'available', NOW()),
  ('50000000-0000-0000-0000-000000000004', '40000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', 'DD-004', '50000000-0000-0000-0000-000000000004', 'site', '30000000-0000-0000-0000-000000000002', 'in_use', NOW()),
  ('50000000-0000-0000-0000-000000000005', '40000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001', 'DD-005', '50000000-0000-0000-0000-000000000005', 'warehouse', NULL, 'available', NOW())
ON CONFLICT (id) DO UPDATE SET serial_number = EXCLUDED.serial_number;

-- インパクトドライバー (3台)
INSERT INTO tool_items (id, tool_id, organization_id, serial_number, qr_code, current_location, current_site_id, status, created_at)
VALUES
  ('50000000-0000-0000-0000-000000000006', '40000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000001', 'TD-001', '50000000-0000-0000-0000-000000000006', 'warehouse', NULL, 'available', NOW()),
  ('50000000-0000-0000-0000-000000000007', '40000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000001', 'TD-002', '50000000-0000-0000-0000-000000000007', 'warehouse', NULL, 'available', NOW()),
  ('50000000-0000-0000-0000-000000000008', '40000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000001', 'TD-003', '50000000-0000-0000-0000-000000000008', 'site', '30000000-0000-0000-0000-000000000001', 'in_use', NOW())
ON CONFLICT (id) DO UPDATE SET serial_number = EXCLUDED.serial_number;

-- 電動サンダー (4台)
INSERT INTO tool_items (id, tool_id, organization_id, serial_number, qr_code, current_location, current_site_id, status, created_at)
VALUES
  ('50000000-0000-0000-0000-000000000009', '40000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000001', 'BO-001', '50000000-0000-0000-0000-000000000009', 'warehouse', NULL, 'available', NOW()),
  ('50000000-0000-0000-0000-000000000010', '40000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000001', 'BO-002', '50000000-0000-0000-0000-000000000010', 'warehouse', NULL, 'available', NOW()),
  ('50000000-0000-0000-0000-000000000011', '40000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000001', 'BO-003', '50000000-0000-0000-0000-000000000011', 'warehouse', NULL, 'available', NOW()),
  ('50000000-0000-0000-0000-000000000012', '40000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000001', 'BO-004', '50000000-0000-0000-0000-000000000012', 'warehouse', NULL, 'available', NOW())
ON CONFLICT (id) DO UPDATE SET serial_number = EXCLUDED.serial_number;

-- レーザー距離計 (2台)
INSERT INTO tool_items (id, tool_id, organization_id, serial_number, qr_code, current_location, current_site_id, status, created_at)
VALUES
  ('50000000-0000-0000-0000-000000000013', '40000000-0000-0000-0000-000000000004', '00000000-0000-0000-0000-000000000001', 'GLM-001', '50000000-0000-0000-0000-000000000013', 'warehouse', NULL, 'available', NOW()),
  ('50000000-0000-0000-0000-000000000014', '40000000-0000-0000-0000-000000000004', '00000000-0000-0000-0000-000000000001', 'GLM-002', '50000000-0000-0000-0000-000000000014', 'site', '30000000-0000-0000-0000-000000000003', 'in_use', NOW())
ON CONFLICT (id) DO UPDATE SET serial_number = EXCLUDED.serial_number;

-- 水平器 (3台)
INSERT INTO tool_items (id, tool_id, organization_id, serial_number, qr_code, current_location, current_site_id, status, created_at)
VALUES
  ('50000000-0000-0000-0000-000000000015', '40000000-0000-0000-0000-000000000005', '00000000-0000-0000-0000-000000000001', 'LST-001', '50000000-0000-0000-0000-000000000015', 'warehouse', NULL, 'available', NOW()),
  ('50000000-0000-0000-0000-000000000016', '40000000-0000-0000-0000-000000000005', '00000000-0000-0000-0000-000000000001', 'LST-002', '50000000-0000-0000-0000-000000000016', 'warehouse', NULL, 'available', NOW()),
  ('50000000-0000-0000-0000-000000000017', '40000000-0000-0000-0000-000000000005', '00000000-0000-0000-0000-000000000001', 'LST-003', '50000000-0000-0000-0000-000000000017', 'warehouse', NULL, 'available', NOW())
ON CONFLICT (id) DO UPDATE SET serial_number = EXCLUDED.serial_number;

-- ========================================
-- 完了メッセージ
-- ========================================
SELECT 'テストデータの投入が完了しました！' as message;
SELECT '管理者: admin@test.com / Test1234!' as admin_account;
SELECT 'スタッフ: staff@test.com / Test1234!' as staff_account;
